($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.viator-review",d:["vendor-babel","vendor-react-libs","lithium-platform","vendor-urql","@ta/reviews.layout","vendor-react-dom-server","lithium-common","@ta/reviews.context","@ta/platform.interactions","@ta/reviews.filters-ui","@ta/core-ui.avatar","@ta/attractions.util-decode"],e:["./packages/attractions/viator-review/viator-review.jsx"],m:{"./packages/attractions/viator-review/viator-review.jsx":function(e,i,a){"use strict";a.r(i);var t=a("@babel/runtime/helpers/esm/slicedToArray"),n=a.n(t),l=a("react"),r=a("@ta/lithium.context"),d=a("urql"),o=a("@ta/reviews.layout"),s=a("react-dom/server"),m=a.n(s),u=a("@ta/platform.i18n"),c=a.n(u),v=a("@ta/core-ui.button"),k=a.n(v),f=a("@ta/reviews.context"),g=a("@ta/platform.interactions"),N=function e(i){var a=Object(f.useHasDraftReview)({locationId:i.locationId}),t=Object(g.useGARecorder)(),n=l.createElement("img",{src:"/img2/attractions/apd/apd_logo_16.png",className:"_2B3ldk94",alt:""}),r=l.useCallback(function(){t({module:"war_button_from_viator_review",action:"click",context:"Product|Location"})},[t]);return l.createElement(l.Fragment,null,l.createElement("div",{className:"fR4XfRaj"},l.createElement("div",{className:"_2R19kkZZ"},l.createElement("div",{className:"KrjEQnJo"},l.createElement(c.a,{id:"common_Reviews"})),l.createElement("div",{className:"_3coGRUNM"},l.createElement(u.UnsafeLocalize,{id:"attraction_reviews_collected_by_viator",args:{0:"_3VEWWKIS",1:m.a.renderToString(n),2:"_1mkOMBpo"}}))),l.createElement("a",{className:"_2CetWdwa",href:i.writeUserReviewUrl,target:"_blank",onClick:r},l.createElement(k.a,{elementType:"button",fullWidth:!0},a?l.createElement(c.a,{id:"attractions_community_content_cta_finish_your_review"}):l.createElement(c.a,{id:"attractions_community_content_cta_write_a_review"})))))},p=a("@ta/reviews.filters-ui"),b=function e(i){if(!i.ratingCounts)return null;var a={alertStatusCount:0,languageCounts:null,ratingCounts:i.ratingCounts};return l.createElement("div",{className:"_3G9CPjcn"},l.createElement(p.ReviewRatingFilter,{displayType:"list",reviewAggregations:a,rating:[],placeType:"ACTIVITY",toggleRating:function e(){},staticOnly:!0}))},S=a("@ta/core-ui.bubble-rating"),_=a("@ta/core-ui.avatar"),w=a("@ta/attractions.util-decode"),y=function e(i){var a=Object(u.useIntlFormatter)(),t=i.username,n=i.text,r=i.rating,d=i.reviewDate,o=i.photoSizes;if(!(t&&n&&r&&d&&o))return null;var s=a.formatDate("date_full_month_year",new Date(d)),m={encodedValue:n};return l.createElement("div",{className:"_3Fdl-hVO"},l.createElement("div",{className:"_3jDMpgbv"},l.createElement("div",{className:"_3D7PMJjt"},l.createElement(_.Avatar,{sources:o,size:"large"})),l.createElement("div",{className:"_3Hj3T29z"},l.createElement("div",{className:"_2-NGUs1Z"},t),l.createElement("div",{className:"_3QNSFqx4"},"A Viator Reviewer"))),l.createElement("div",{className:"_1YAdU3Vb"},l.createElement("div",{className:"_1hM7u7a-"},l.createElement(S.BubbleRatingWithLabel,{rating:r,fontSize:14,hoverable:!1,bubbleRatingVerticalAlign:null,isFilterComponent:!1,useAffiliateStars:!1,label:l.createElement(c.a,{id:"attractions.booking.viator.reviewed_date",args:{0:s}})})),l.createElement("div",{className:"_3uOMX0F_"},l.createElement(w.DecodedValueSafe,{content:m},function(e){return e&&e.replace(/(<([^>]+)>)/gi,"")}))))},E=function e(i){var a,t=Object(g.useGARecorder)(),r=l.useState(!1),d=n()(r,2),o=d[0],s=d[1],m=l.useCallback(function(){s(!0),t({module:"viator_show_more_reviews_click",action:"click",context:"Product|Location"})},[t]);if(!i.reviews)return null;var u=i.reviews.slice(0,4).map(function(e){return l.createElement(y,{key:e.id,rating:e.rating,photoSizes:e.photoSizes,reviewDate:e.reviewDate,text:e.text,username:e.username})}),v=null===(a=i.reviews)||void 0===a?void 0:a.slice(4);if(!v||0===v.length)return l.createElement(l.Fragment,null,u);var f=v.map(function(e){return l.createElement(y,{key:e.id,rating:e.rating,photoSizes:e.photoSizes,reviewDate:e.reviewDate,text:e.text,username:e.username})}),N=l.createElement("div",{className:"_2Z26vZFh"},l.createElement(k.a,{elementType:"button",theme:"secondary",onClick:m},l.createElement(c.a,{id:"attractions.see_more_reviews"})," "));return l.createElement(l.Fragment,null,u,!o&&N,o&&f)},F=JSON.parse('{"kind":"Document","definitions":[{"kind":"FragmentDefinition","name":{"kind":"Name","value":"ViatorRatingFields"},"typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ExpPresentationService_FullProductDetails"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"reviewSummary"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"viatorRatingCounts"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":130}}');F.__key=0xf96042123727,F.loc.source={body:"f96042123727"};var V=F,h=JSON.parse('{"kind":"Document","definitions":[{"kind":"FragmentDefinition","name":{"kind":"Name","value":"ViatorReviewFields"},"typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ReviewListPage"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"reviews"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"id"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"username"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"rating"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"text"},"arguments":[],"directives":[{"kind":"Directive","name":{"kind":"Name","value":"encode"},"arguments":[]}]},{"kind":"Field","name":{"kind":"Name","value":"createdDate"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"userProfile"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"avatar"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"photoSizes"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"url"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"width"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"height"},"arguments":[],"directives":[]}]}}]}}]}}]}}]}}],"loc":{"start":0,"end":263}}');h.__key=0xdaeb5b5f6cc5,h.loc.source={body:"daeb5b5f6cc5"};var D=h,R=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"ViatorReviewQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"filters"}},"type":{"kind":"ListType","type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"FilterConditionInput"}}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"prefs"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"ReviewListPrefsInput"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"offset"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"limit"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"locations"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"locationIds"},"value":{"kind":"ListValue","values":[{"kind":"Variable","name":{"kind":"Name","value":"locationId"}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"writeUserReviewUrl"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"reviewListPage"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"page"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"offset"},"value":{"kind":"Variable","name":{"kind":"Name","value":"offset"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"limit"},"value":{"kind":"Variable","name":{"kind":"Name","value":"limit"}}}]}},{"kind":"Argument","name":{"kind":"Name","value":"filters"},"value":{"kind":"Variable","name":{"kind":"Name","value":"filters"}}},{"kind":"Argument","name":{"kind":"Name","value":"prefs"},"value":{"kind":"Variable","name":{"kind":"Name","value":"prefs"}}},{"kind":"Argument","name":{"kind":"Name","value":"initialPrefs"},"value":{"kind":"NullValue"}},{"kind":"Argument","name":{"kind":"Name","value":"filterCacheKey"},"value":{"kind":"NullValue"}},{"kind":"Argument","name":{"kind":"Name","value":"prefsCacheKey"},"value":{"kind":"NullValue"}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"FragmentSpread","name":{"kind":"Name","value":"ViatorReviewFields"},"directives":[]}]}}]}},{"kind":"Field","alias":{"kind":"Name","value":"fullProduct"},"name":{"kind":"Name","value":"ExpPresentationService_getFullProductDetailsBulk"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"activityIds"},"value":{"kind":"ListValue","values":[{"kind":"Variable","name":{"kind":"Name","value":"locationId"}}]}},{"kind":"Argument","name":{"kind":"Name","value":"currency"},"value":{"kind":"StringValue","value":"","block":false}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"FragmentSpread","name":{"kind":"Name","value":"ViatorRatingFields"},"directives":[]}]}}]}}],"loc":{"start":0,"end":681}}');R.__key=5127711878491,R.loc.source={body:"04a9e371ed5b"};var I={};function C(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!I[i]&&(I[i]=!0,!0)})}R.definitions=R.definitions.concat(C(V.definitions)),R.definitions=R.definitions.concat(C(D.definitions));var T=R;i.default=function e(){var i,a,t,s,m,u,c,v,k=l.useContext(r.Route),f=n()(k,1)[0].params,g=f.detailId||-1,p=f.geoId||-1,S={locationId:g,filters:[],prefs:{providerTier:"VIATOR"},offset:0,limit:20},_=Object(d.useQuery)({query:T,variables:S}),w=n()(_,1)[0],y=w.fetching,F=w.data,V=null==F?void 0:null===(i=F.locations)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:null===(t=a.reviewListPage)||void 0===t?void 0:t.reviews,h=null==F?void 0:null===(s=F.fullProduct)||void 0===s?void 0:null===(m=s[0])||void 0===m?void 0:null===(u=m.reviewSummary)||void 0===u?void 0:u.viatorRatingCounts,D=(null==F?void 0:null===(c=F.locations)||void 0===c?void 0:null===(v=c[0])||void 0===v?void 0:v.writeUserReviewUrl)||"",R=null==V?void 0:V.map(function(e){var i,a;return{id:null==e?void 0:e.id,rating:null==e?void 0:e.rating,username:null==e?void 0:e.username,photoSizes:null==e?void 0:null===(i=e.userProfile)||void 0===i?void 0:null===(a=i.avatar)||void 0===a?void 0:a.photoSizes,text:null==e?void 0:e.text,reviewDate:null==e?void 0:e.createdDate}});return!y&&R&&h&&D?l.createElement("div",{className:"_3w3y1jsi","data-tab":"TABS_REVIEWS"},l.createElement(o.Section,{section:"reviews",theme:"none",joinable:!1},l.createElement(N,{geoId:p,locationId:g,hasDraftReview:!1,isLoggedIn:!1,writeUserReviewUrl:D})),l.createElement(b,{ratingCounts:h}),l.createElement(E,{reviews:R})):null}}}});
//# sourceMappingURL=attractions.viator-review.33c1f6901c.js.map