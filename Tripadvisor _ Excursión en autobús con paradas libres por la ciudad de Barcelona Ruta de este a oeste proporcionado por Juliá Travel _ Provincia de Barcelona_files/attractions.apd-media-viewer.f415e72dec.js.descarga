($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.apd-media-viewer",d:["vendor-babel","vendor-react-libs","lithium-platform","lithium-common","@ta/platform.interactions","@ta/media-viewer.detail-view-controls","@ta/media-viewer.responsive-viewer","@ta/media-viewer.mw-detail-viewer","vendor-urql","@ta/events.keyboard-event-listener"],e:["./packages/attractions/apd-media-viewer/media-viewer.jsx"],m:{"./packages/attractions/apd-media-viewer/media-viewer.jsx":function(e,i,n){"use strict";n.r(i);var t=n("@babel/runtime/helpers/esm/slicedToArray"),a=n.n(t),r=n("react"),l=n("@ta/common.throttle"),d=n.n(l),o=n("@ta/common.is-visible"),s=n("@ta/platform.interactions"),u=n("@ta/media-viewer.detail-view-controls"),c=n("@ta/media-viewer.responsive-viewer"),m=n("@ta/media-viewer.mw-detail-viewer"),v=n("@ta/media.image"),k=n("urql"),f=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"PromotedReviewQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"reviewId"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"reviews"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"reviewIds"},"value":{"kind":"ListValue","values":[{"kind":"Variable","name":{"kind":"Name","value":"reviewId"}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"id"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"title"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"url"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"locationId"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"rating"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"isPhotoOnly"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"text"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"photos"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"id"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"photoSizes"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"url"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"width"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"height"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"caption"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"uploadDate"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"thumbsUpVotes"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"supplierCategory"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"provider"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"isLocalProvider"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"name"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"attributionUrl"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"userProfile"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"username"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"displayName"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"avatar"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"photoSizes"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"url"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","name":{"kind":"Name","value":"contributionCounts"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"sumAllUgc"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"hometown"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"location"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"additionalNames"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"long"},"arguments":[],"directives":[]}]}}]}}]}}]}}]}}]}}],"loc":{"start":0,"end":713}}');f.__key=0x5fce1524d27e,f.loc.source={body:"5fce1524d27e"};var p=f,g=r.memo(function e(i){var n=i.locationId,t=i.titleText,f=i.media,g=i.totalCount,S=i.onLoadLast,N=i.onModalClose,b=i.promotedReviewId,w=i.focusedIndex,F=Object(s.useGARecorder)(),C=r.useRef(0),h=r.useState(0),y=a()(h,2),I=y[0],x=y[1],_=r.useRef(0),E=r.useRef(0),L=r.useState(!0),R=a()(L,2),V=R[0],O=R[1],M=function e(i,n,t){var l,d={reviewId:n},o=Object(k.useQuery)({query:p,variables:d,pause:n<=0}),s=a()(o,1)[0].data,u=null==s?void 0:null===(l=s.reviews)||void 0===l?void 0:l[0],c=r.useMemo(function(){var e=new Map;if(u&&u.locationId===i){var n={id:u.id,title:u.title,url:u.url,rating:u.rating,isPhotoOnly:u.isPhotoOnly,text:u.text},t=null==u?void 0:u.userProfile;((null==u?void 0:u.photos)||[]).filter(Boolean).forEach(function(i){var a={mediaId:i.id,type:"p",photoSizes:i.photoSizes,caption:i.caption,supplierCategory:i.supplierCategory,thumbsUpVotes:i.thumbsUpVotes,uploadDate:i.uploadDate,provider:i.provider,providerAttributionUrl:i.attributionUrl,review:n,userProfile:t};a.mediaId&&e.set(a.mediaId,a)})}return e},[i,u]);return r.useMemo(function(){var e=t.filter(function(e){return!c.has(e.mediaId)});return(Array.from(c.values())||[]).concat(e)},[t,c])}(n,b||0,f),P=r.useCallback(function(){return F({module:"mediaviewer",action:"grid_view",value:n})},[F,n]),U=M.length;r.useEffect(function(){S&&I>U&&S()},[S,I,U]);var A=r.useCallback(function(e){return e<0?"supplier:".concat(-1*e-1):String(e)},[]),D=r.useCallback(d()(function(){x(C.current)},200,!0),[C]),T=r.useCallback(function(){D()},[D]),j=r.useCallback(function(){F({module:"media_viewer",action:"detail_view_dismiss",context:"caret_click",value:n})},[F,n]),z=Object(l.useDebouncedCallback)(function(){E.current>_.current&&(F({module:"media_viewer",action:"grid_view_photos_seen",context:"".concat(E.current),value:n}),_.current=E.current)},500),B=r.useCallback(function(){D(),z()},[z,D]),q=r.useCallback(function(e){var i=M[e],t=(null==i?void 0:i.mediaId)||0;t&&F({module:"media_viewer",action:"grid_view_thumbnail_click",context:A(t),value:n})},[F,M,A,n]),G=r.useCallback(function(){F({module:"media_viewer",action:"mediaviewer_close_click",value:n}),N()},[F,n,N]),W=r.useCallback(function(e){e.setSelectedIndex&&null!=w&&!isNaN(w)&&V&&(e.setSelectedIndex(w),O(!1))},[w,V,O]),H=r.useCallback(function(e){"FULLSCREEN_NAV"===e.type?T():"FULLSCREEN_CLOSE"===e.type?j():"SCROLL"===e.type?B():"GALLERY_CLICK"===e.type?q(e.selectedIndex):"CLOSE"===e.type&&G()},[T,j,B,q,G]),$=r.useCallback(function(e){C.current<e&&(C.current=e)},[C]),Q=r.useCallback(function(e,i){$(e);var n=M[e];return!!n&&i(n)},[$,M]),J=r.useCallback(function(e){E.current=Math.max(E.current,e+1)},[E]),K=r.useCallback(function(e,i,n){return Q(e,function(t){return r.createElement(o.HasBeenVisible,{onVisible:function i(){return J(e)}},function(e){return r.createElement("div",{className:"_1LroA7Cd",ref:e},r.createElement(v.ResponsiveImage,{sources:t.photoSizes,width:"".concat(i,"px"),height:"".concat(n,"px"),fitStrategy:"cover"}))})})},[Q,J]),Y=r.useCallback(function(e){return Q(e,function(i){return r.createElement(m.MWDetailViewer,{key:"".concat(i.mediaId),locationId:n,media:i,shareUrl:null,totalMediaInfo:{selectedIndex:e,totalCount:g},onFullscreenMedia:function e(){},onSwipeRight:function e(){},onSwipeLeft:function e(){},innateTranslations:!1,businessContact:function e(){return!1}})})},[Q,n,g]);return r.createElement(o.HasBeenVisible,{onVisible:P},function(e){return r.createElement("div",{className:"_1-5fxpM-",ref:e},r.createElement(c.ResponsiveViewer,{titleText:t,galleryRenderer:K,fullRenderer:Y,totalCount:g,actionHandler:H,onTileGalleryControls:W,close:G,detailCloseButton:r.createElement(u.GalleryButton,null)}))})}),S=n("@ta/lithium.context"),N=n("@ta/events.keyboard-event-listener"),b=n.n(N),w=function e(i){var n=i.renderMediaViewer,t=i.close,l=r.useContext(S.Route),d=a()(l,1)[0];if(d.fragment&&d.fragment.indexOf("/media/")>=0){var o=d.fragment.substring(d.fragment.indexOf("?")),s=new URLSearchParams(o),u=s.get("reviewId"),c=u?Number(u):void 0,m=s.get("focusedIndex"),v=m?Number(m):void 0;return r.createElement(r.Fragment,null,n(c,v),r.createElement(b.a,{keyName:"Escape",callback:t}))}return null};n.d(i,"MediaViewer",function(){return g}),n.d(i,"MVOpener",function(){return w})}}});
//# sourceMappingURL=attractions.apd-media-viewer.f415e72dec.js.map