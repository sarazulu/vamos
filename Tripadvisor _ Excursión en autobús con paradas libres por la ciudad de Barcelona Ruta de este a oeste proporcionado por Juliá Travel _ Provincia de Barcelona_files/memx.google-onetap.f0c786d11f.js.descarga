($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.google-onetap",d:["vendor-babel","vendor-react-libs","vendor-urql","@ta/common.features","@ta/cpm.gpt-slots-raw","@ta/memx.registration-dialog-utils","@ta/platform.interactions","@ta/login.login","@ta/memx.google-onetap-config","lithium-platform","@ta/common.localstorage","lithium-common"],e:["./packages/memx/google-onetap/GoogleOneTapLoader.jsx"],m:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":function(e,t,a){"use strict";a.r(t);var n=a("@babel/runtime/helpers/esm/slicedToArray"),i=a.n(n),o=a("react"),l=a.n(o),r=a("urql"),s=a("@ta/common.features"),c=a("@ta/cpm.gpt-slots-raw"),u=a.n(c),d=a("@ta/memx.registration-dialog-utils"),m=a("@ta/platform.interactions"),_=a("@ta/login.login"),p=a.n(_),g=a("@ta/memx.google-onetap-config"),b=a("@ta/lithium.context"),f=a("@babel/runtime/helpers/esm/defineProperty"),h=a.n(f),v=a("@ta/common.classnames"),E=a.n(v),O=a("@ta/core-ui.icon"),k=a.n(O),N=a("@ta/platform.i18n"),R=a.n(N),T=a("@ta/common.localstorage"),y=a.n(T),C=["Restaurant_Review","Hotel_Review","Attraction_Review","Restaurants","Hotels","Home","Attractions","ShowTopic","Profile","LocationPhotoDirectLink","SmartDeals","RestaurantsNear","HotelHighlight","HotelsNear","Tourism","ShowUserReviews","VacationRentalReview","HotelsList","AttractionsNear","Search","ShowForum","Attraction_Products","CheapFlightsSearchResults","AttractionProductReview","Flights","CheapFlightsSearchDeals","LocationPhotos","VacationRentals","FAQ_Answers","members","FlightsRoute","Airline_Review","Vacation_Packages","LocalMapsRedesign","RestaurantsLander","Travel","SiteIndex","CheapFlightsHome","FlightsFrom","FAQ","NewTopic","Trips","LastMinute","RentalCars","AttractionsLander","TravelersChoice","VacationRentalsLander","Guide","Travel_Guide"],A=["Restaurant_Review","MobileAttraction_Review","MobileRestaurants","Home","MobileAttractions","MobileShowTopic","Profile","MobileRestaurantsNear","MobileTourism","MobileShowUserReviews","MobileVacationRentalReview","MobileAttractionsNear","MobileRestaurantSearch","MobileSearch","MobileShowForum","MobileAttraction_Products","MobileCheapFlightsSearchResults","MobileAttractionProductReview","MobileFlights","CheapFlightsSearchDeals","MobileVacationRentals","MobileFAQ_Answers","FlightsRoute","Airline_Review","MobileVacation_Packages","MobileVacationRentalSearch","RestaurantsLander","MobileTravel","SiteIndex","CheapFlightsHome","FlightsFrom","MobileFAQ","MobileNearbyRestaurants","NewTopic","Trips","RentalCars","AttractionsLander","TravelersChoice","MobileVacationRentalsLander","Guide","Travel_Guide","MobileAttractionToursAndTickets","Hotels","Hotel_Review","MobileSmartDeals","HotelsNear","MobileHotelHighlight","HotelsList","LastMinute","LocalMapsRedesign","MobileLocalMaps"],j=["CheapFlightsSearchResults","CheapFlightsSearchDeals","MobileCheapFlightsSearchResults"];function S(e,t){return t?Object(s.featureIsEnabled)("google_onetap_contextual_message_desktop_lithium")&&!j.includes(e):Object(s.featureIsEnabled)("google_onetap_contextual_message_desktop")}function P(e,t){return t?Object(s.featureIsEnabled)("google_onetap_contextual_message_mobile_lithium")&&!j.includes(e):Object(s.featureIsEnabled)("google_onetap_contextual_message_mobile")}function M(e,t){return S(e,t)||P(e,t)}var w=function e(t){return Object(s.featureIsEnabled)("google_onetap_animated_spotlight_master")&&!function e(){return y.a.get("oneTapSpotlightShown")||!1}()&&"Home"!==t},x=function e(t){var a=o.useContext(b.Environment).locale.isRtl,n={headline:o.createElement(R.a,{id:"onetap_message_unlock"}),subhead:o.createElement(R.a,{id:"onetap_message_subhead_to_get_the_most"})},l=o.useState(""),r=i()(l,2),s=r[0],c=r[1],d=o.useCallback(function(){c("_3fP0f_VW")},[]);u()({size:"5x1",position:"sky",callback:d});var m=t.bottomPosition||0;return P(t.servletName,t.lithium)&&m?o.createElement("div",{className:E()("_2QFCJM0i","_3ab7a5mV"),style:{bottom:"".concat(m,"px")}},o.createElement("div",{className:"_3GqiEClx"},o.createElement("h3",{className:"_2u-o_uSy"},o.createElement("span",{className:"_3-TQ25c-"},o.createElement(k.a,{name:"membership"})),n.headline))):o.createElement("div",{className:E()("_2QFCJM0i","_2sQ6n36z",s,h()({},"_2WsDxfJ-",a))},o.createElement("div",{className:"_3GqiEClx"},o.createElement("h3",{className:"_2u-o_uSy"},o.createElement("span",{className:"_3-TQ25c-"},o.createElement(k.a,{name:"membership"})),n.headline),o.createElement("p",{className:"_3gzK4xdI"},n.subhead)))},G=a("@ta/common.cdn"),F=Object(s.featureIsEnabled)("google_onetap_animated_spotlight_backdrop_3s")?3e3:6e3,I=function e(t){var a,n,r=t.onDisplay,c=Object(o.useState)(!Object(s.featureIsEnabled)("google_onetap_animated_spotlight_no_backdrop")),u=i()(c,2),d=u[0],m=u[1],_=Object(o.useState)(!1),p=i()(_,2),g=p[0],f=p[1],v=Object(o.useState)(!1),O=i()(v,2),k=O[0],N=O[1],T=Object(o.useRef)(null),y=Object(o.useContext)(b.Environment).locale.isRtl;return Object(o.useEffect)(function(){var e=setTimeout(function(){return f(!0)},F+500),t=setTimeout(function(){return m(!1)},F+500+500),a=function e(t){T.current&&!T.current.contains(t.target)&&N(!0)},n=setTimeout(function(){window.addEventListener("click",a)},1500);return function(){clearTimeout(e),clearTimeout(t),clearTimeout(n),window.removeEventListener("click",a)}},[]),Object(o.useEffect)(r,[]),l.a.createElement(l.a.Fragment,null,d&&l.a.createElement("div",{onClick:function e(){return m(!1)},className:E()("_3sJYROXf",(a={},h()(a,"OP9ufMQP",!g),h()(a,"_6gWwlakt",g),a))}),l.a.createElement("div",{className:E()("uGVymV24",(n={},h()(n,"_3crrpnEb",!k),h()(n,"_3P5KNZpY",k),h()(n,"_2sj8xG49",y),n)),ref:T},l.a.createElement("div",{className:E()("_1RqjmT5x",h()({},"_2sj8xG49",y))},l.a.createElement(G.CdnImage,{src:"/img2/brand_refresh/Tripadvisor_logoset_solid_green.svg",className:"_38GK0eKX"}),l.a.createElement(G.CdnImage,{src:"/img2/memx/KeyIcon.svg",className:"_38GK0eKX"}),l.a.createElement("div",{className:"_2Qbz2lxz"},l.a.createElement(R.a,{id:"onetap_message_unlock"})),l.a.createElement("div",{className:"_1tP8yH_S"},Object(s.featureIsEnabled)("google_onetap_animated_spotlight_copy_test")?l.a.createElement(R.a,{id:"onetap_message_subhead_to_get_the_most"}):l.a.createElement(R.a,{id:"got_test_generic_copy"})," "))))},L=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"HintForPromptEligibility"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"promptType"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"PromptEligibility_PromptType"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"eligible"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Boolean"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"PromptEligibility_hintForPromptEligibility"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"promptType"},"value":{"kind":"Variable","name":{"kind":"Name","value":"promptType"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"eligible"},"value":{"kind":"Variable","name":{"kind":"Name","value":"eligible"}}}]}}],"directives":[]}]}}],"loc":{"start":0,"end":223}}');L.__key=0x96622fd80dc8,L.loc.source={body:"96622fd80dc8"};var D=L,V=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"DismissDialogForPrompt"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"promptType"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"PromptEligibility_PromptType"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"PromptEligibility_dismissDialogForPrompt"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"promptType"},"value":{"kind":"Variable","name":{"kind":"Name","value":"promptType"}}}]}}],"directives":[]}]}}],"loc":{"start":0,"end":169}}');V.__key=0xa6d7797d57cf,V.loc.source={body:"a6d7797d57cf"};var H=V,Q=Object(s.featureIsEnabled)("review_detail_hard_gate_dt_dynamic_pv")||Object(s.featureIsEnabled)("detail_hard_gate_dt_1_pv_per_servlet")?"_16LgDXrl":"_21TBNpm5";t.default=function e(t){var a=o.useRef(!1),n=o.useRef(0),l=o.useState(!1),c=i()(l,2),_=c[0],f=c[1],h=o.useState(!1),v=i()(h,2),E=v[0],O=v[1],k=o.useState(!1),N=i()(k,2),R=N[0],T=N[1],j=o.useReducer(function(e){return e+1},0),P=i()(j,2)[1],G=Object(m.useGARecorder)(),F=o.useRef(!1),L=o.useContext(b.Environment).locale.isRtl,V=Object(r.useMutation)(H),q=i()(V,2)[1],W=Object(r.useMutation)(D),X=i()(W,2)[1],K=o.useCallback(function(){F.current=!0,t.googleApi.reevaluateStylePredicates()},[t.googleApi]);u()({size:"5x1",position:"sky",callback:K});var J=Object(s.featureIsEnabled)("post_signup_attr_promo_onetap")&&("Home"===t.servletName||Object(s.featureIsEnabled)("onetap_onboarding"))||Object(s.featureIsEnabled)("post_signup_attr_promo_explicit_preferences"),z=g.GOOGLE_PID;t.enhancedGoogleOneTapGate?z=g.ENHANCED_GOOGLE_GATE_PID:J&&(z=40666);var U=o.useCallback(function(e){G({module:g.LOADER_TRACKING_MODULE,action:e,context:"".concat(e.replace(/^google_onetap_/,""),"_unknown_").concat(g.GOOGLE_FLOW),value:z})},[G,z]),B=o.useCallback(function(){G({module:"signup_promo_prompt",action:"eligible_promo_test"})},[G]),Y=o.useCallback(function(){a.current&&0===n.current||(a.current=!1,n.current=0,P())},[]),$=p()(),Z=o.useCallback(function(e){var a=J?"GOOGLE_ONETAP_EMAIL_PROMO":g.GOOGLE_FLOW;$({flow:a,pid:z,extraQueryParams:{google_id_token:e.idToken},deferShowOverlay:!0,onSuccess:function e(a){if(a&&a.hasCreatedMember&&t.trackWouldOpenExplicitPreferences&&t.trackWouldOpenExplicitPreferences(),a&&a.hasCreatedMember&&t.explicitPreferencesEnabled&&t.openExplicitPreferences)t.openExplicitPreferences();else if(a&&a.userId&&a.hasCreatedMember)if("Home"===t.servletName||Object(s.featureIsEnabled)("onetap_onboarding")){if(Object(s.featureIsEnabled)("post_signup_attr_promo_onetap"))return B(),void t.setShouldFire(!1,"SIGN_UP_AND_SAVE");Object(s.featureIsEnabled)("post_signup_attr_promo_control")&&B(),t.setShouldFire(!1,"GOOGLE_ONETAP")}else Object(s.featureIsEnabled)("app_dl_for_got_and_fbot")&&t.setShouldFire(!1,"GOOGLE_ONETAP_NON_HOME")}})},[$,t,B,z,J]),ee=o.useCallback(function(e){Y(),e.idToken&&(Object(d.moveAdCloseX)(!0),Z(e))},[Y,Z]),te=t.onDismiss,ae=o.useCallback(function(){te&&te(),q({promptType:"GOOGLE_ONETAP"})},[te,q]),ne=t.triggerNext,ie=o.useCallback(function(){Y(),ne()},[Y,ne]),oe=o.useCallback(function(e){Object(d.moveAdCloseX)(!0),Y(),"noCredentialsAvailable"===e.type&&X({promptType:"GOOGLE_ONETAP",eligible:!1}),"userCanceled"===e.type&&ae?ae():(Object(d.setOneTapEligibility)(!1),ne())},[X,ae,Y,ne]),le=o.useCallback(function(){return a.current=!0,P(),t.googleApi.hint().then(ee,oe).catch(ie)},[oe,ie,ee,t.googleApi]),re=o.useCallback(function(e){Object(d.moveAdCloseX)(!0),Y(),"noCredentialsAvailable"!==e.type?"userCanceled"===e.type?ae():(Object(d.setOneTapEligibility)(!1),ne()):le()},[le,ae,Y,ne]),se=o.useCallback(function(){return t.googleApi.retrieve().then(ee,re).catch(ie)},[re,ie,ee,t.googleApi]),ce=o.useCallback(function(){var e=document.getElementsByClassName(Q);if(e&&0!==e.length){var a=t.adhesionRendered?50:0;e[0].style.bottom="".concat(a,"px")}},[t.adhesionRendered]),ue=o.useCallback(function(e){n.current=e,O(e>0),e>0&&(U("google_onetap_rendered"),t.adhesionRendered&&(ce(),Object(d.moveAdCloseX)(!1),U("google_onetap_modal_moved_above_adhesion"))),P()},[ce,t.adhesionRendered,U]),de=t.onReady,me=o.useCallback(function(){return de&&de(),t.googleApi.captureIframeEvents(ue),(t.adhesionRendered||M(t.servletName,t.lithium)||t.enhancedGoogleOneTapGate||w(t.servletName))&&t.googleApi.addClassName(Q).addClassName("_1ZUi_vcX",function(){return F.current}).addClassName("_2gAJLKqB",function(){return S(t.servletName,t.lithium)&&a.current}).addClassName("_2eqE7yp2",function(){return w(t.servletName)&&!Object(s.featureIsEnabled)("google_onetap_animated_spotlight_ghost")&&a.current}).addClassName("AacXAYJM",function(){return L}),t.adhesionRendered&&U("google_onetap_adhesion_detected"),Object(d.setOneTapEligibility)(!0),Object(d.userSignedOut)()?le():se()},[le,ue,t.adhesionRendered,de,t.enhancedGoogleOneTapGate,t.googleApi,t.lithium,t.servletName,se,U,L]);o.useEffect(function(){if(function e(t,a){return!function e(t,a){return a?Object(s.featureIsEnabled)("google_onetap_web_component_mobile_lithium")&&A.includes(t):Object(s.featureIsEnabled)("google_onetap_web_component_mobile")&&A.includes(t)}(t,a)&&!function e(t,a){return a?Object(s.featureIsEnabled)("google_onetap_web_component_desktop_lithium")&&C.includes(t):Object(s.featureIsEnabled)("google_onetap_web_component_desktop")&&C.includes(t)}(t,a)}(t.servletName,t.lithium))t.triggerNext();else{U("google_onetap_requested"),T(w(t.servletName));var a=Object(s.featureIsEnabled)("mobile_web")?null:"navPopout";t.googleApi.load(a,null).then(me)}},[]),o.useEffect(function(){t.adhesionRendered||ce()},[ce,t.adhesionRendered]),o.useEffect(function(){if(E&&R){var e=setTimeout(function(){return f(!0)},500);return function(){clearTimeout(e)}}return function(){}},[E,t.servletName,R]);var _e=o.useCallback(function(){!function e(){y.a.set("oneTapSpotlightShown",!0,864e5)}(),G({module:"got_spotlight_dw",action:"saw_got_spotlight_dw",context:"".concat(t.servletName||"unknown")})},[t.servletName,G]);return o.useEffect(function(){R&&Object(s.featureIsEnabled)("google_onetap_animated_spotlight_ghost")&&n.current>0&&_&&a.current&&_e()},[t.servletName,_,_e,R]),R&&(n.current<=0||!_||!a.current)?null:R&&!Object(s.featureIsEnabled)("google_onetap_animated_spotlight_ghost")?o.createElement(I,{onDisplay:_e}):!a.current||!M(t.servletName,t.lithium)||t.enhancedGoogleOneTapGate||n.current<=0?null:o.createElement(x,{bottomPosition:function e(){return(t.adhesionRendered?50:0)+n.current-39}(),servletName:t.servletName,lithium:t.lithium})}}}});
//# sourceMappingURL=memx.google-onetap.f0c786d11f.js.map