($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.supplier-trust",d:["vendor-babel","vendor-react-libs","@ta/platform.interactions","@ta/common.features","vendor-urql","@ta/attractions.product-detail-data-loader","lithium-common","lithium-platform","@ta/common.text","@ta/modal.styleguide"],e:["./packages/attractions/supplier-trust/SupplierTrustModule.jsx"],m:{"./packages/attractions/supplier-trust/SupplierTrustModule.jsx":function(e,t,a){"use strict";a.r(t);var r=a("@babel/runtime/helpers/esm/slicedToArray"),n=a.n(r),l=a("react"),c=a("@ta/platform.interactions"),i=a("@ta/common.features"),s=a("@ta/common.is-visible"),o=a("@ta/platform.i18n"),u=a.n(o),m=a("@ta/lithium.context"),d=a("@ta/core-ui.icon"),p=a.n(d),v=a("@ta/common.classnames"),_=a.n(v),f=a("@ta/core-ui.bubble-rating"),E=a("@ta/common.text"),b=a("@ta/common.throttle"),N={"":'<span class="'.concat("_2I8nn40t",'">'),"":"</span>","\n":"<br>","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},g=function e(t){var a=t.replace(/\n/g," ");if(a.length<=115)return a;var r=function e(t){return t.substr(0,115)}(a);if(!t.includes("")||r.includes(""))return r;var n=a.indexOf(""),l=a.substr(n-115,115),c=Math.max(0,l.indexOf(" "));return l=l.substr(c,n-c),"...".concat(l)},k=function e(t){return(t||"").replace(/[&<>"'\n\u0086\u0087]|&#?[0-9a-zA-Z]+;/g,function(e){return N[e]||e})},h=function e(t){var a=t.item,r=t.index,n=t.numReviews,o=t.servletName,m=t.onClick,d=1===n,v=2===n,f=Object(c.useGARecorder)();return l.createElement(s.HasBeenVisible,{onVisible:Object(b.useDebouncedCallback)(function(){f({module:o,action:"supplier_review_scroll",context:(r+1).toString()})},100)},function(e){return l.createElement("div",{className:_()(d?"_2_vicE1M":v?"xuFnScnB":!v&&"_3xs8d-Kj","_3LOx-Yuy","reviewContainer"),key:a.reviewId},l.createElement("img",{src:a.avatarUrl,className:d?"_18T-0Xqz":"o1vliiJv"}),l.createElement("div",{className:_()(d?"_1Jg0C-Qh":v?"_1eVw--Bb":!v&&"_3fHDiY-l")},l.createElement("div",null,a.screenName),l.createElement("div",{className:"_2gdKPr3F"},a.location),l.createElement("span",{className:_()("_3j0VIWg-","_2WPW7ss7")},l.createElement(p.a,{name:"pencil-paper",color:Object(i.featureIsEnabled)("cx_brand_refresh_degreen")?"black":"taGreen"})),a.publishedReviews,l.createElement("span",{className:_()("_22Y9lFKY","_2WPW7ss7")},l.createElement(p.a,{name:"thumbs-up-fill",color:Object(i.featureIsEnabled)("cx_brand_refresh_degreen")?"black":"taGreen"})),a.helpfulVotes),l.createElement("div",{ref:e,className:d?"U6-64NcN":""},l.createElement("div",{className:"_2Dxb-5W3"},a.displayTitle),l.createElement("div",{className:"_3H1FIu_u"},l.createElement(E.DirectionalText,{contentLanguage:"''"},l.createElement("span",{dangerouslySetInnerHTML:{__html:k(g(a.displayText||""))}}),(a.displayText||"").length>115&&l.createElement("span",{dangerouslySetInnerHTML:{__html:"&hellip;"}}))),l.createElement("div",{className:_()(d?"_2tPhHBqa":v?"_271Djix1":!v&&"tnSE8Zss","_2bKiJR8L"),onClick:function e(){return m(a,r)}},l.createElement(u.a,{id:"common_Read_more"}))))})},w=a("@ta/modal.styleguide"),x=a.n(w),O=function e(t){var a=t.avatarUrl,r=t.screenName,n=t.publishedReviews,c=t.helpfulVotes;return l.createElement("div",{className:"_22SSavcA"},l.createElement("img",{src:a,className:"_3lBXeeP7"}),l.createElement("div",{className:"_2OMZli9W"},r,l.createElement("div",null,l.createElement("span",{className:_()("jYrKmCWk","_39gH7ZEn")},l.createElement(p.a,{name:"pencil-paper"})),n,l.createElement("span",{className:_()("_2f-2Dt7y","_39gH7ZEn")},l.createElement(p.a,{name:"thumbs-up-fill"})),c)))},y=function e(t){var a=t.rating,r=t.relativePublishedDate,n=t.dateText,c=t.mobile;return a?l.createElement("div",{className:"_3K4OCAZR"},l.createElement(f.BubbleRating,{rating:a}),l.createElement("span",{className:"mO7JBlnx"},l.createElement(u.a,{id:"relative_dates_reviewed_caps_fffff175",args:{0:r||n||""}})),c&&l.createElement("span",{className:"_11ofpalj"},l.createElement("span",{className:"_1f88dZ2z"},l.createElement(p.a,{name:"mobile-phone"})),l.createElement(u.a,{id:"via_mobile_15d0"}))):null},R=function e(t){var a=t.review;return a?l.createElement("div",{className:"_2Gt-wEQG"},l.createElement(y,{rating:a.rating||0,relativePublishedDate:a.relativePublishedDate||"",dateText:a.dateText||"",mobile:a.mobile||!1}),l.createElement("div",{className:"_3pZ68FJf"},a.displayTitle),a.productName&&l.createElement("div",{className:"_3F_9JuCt"},l.createElement(u.a,{id:"attractions_review_of_activity",args:{activityName:l.createElement("span",{className:"_1huXOZ93"},a.productName||"")}})),l.createElement("div",{className:"_3F_9JuCt"},a.displayText),a.experienceDate&&l.createElement("div",{className:"_320Yxr_3"},l.createElement("span",{className:"_2f6_VnXM"},l.createElement(u.a,{id:"supplier_trust_module_date_of_experience"})),a.experienceDate),(a.photoUrls||[]).map(function(e){return l.createElement("img",{key:e,src:e,className:"_3acJqGOj"})}),l.createElement("div",{className:"ZVWpo6Xt"},l.createElement(u.a,{id:"userreviewbody_26ec"}))):null},C=function e(t){var a=t.onClose,r=t.review;return l.createElement(x.a,{width:"800px",closeIconColor:"TA_GREEN_DARK",onClose:a},l.createElement(O,{avatarUrl:r.avatarUrl||"",screenName:r.screenName||"",publishedReviews:r.publishedReviews||0,helpfulVotes:r.helpfulVotes||0}),l.createElement(R,{review:r}))},j=function e(t){var a=t.count;return a>5?l.createElement("p",{className:"_3x4zY_NI"},l.createElement(u.a,{id:"supplier_trust_module_explanation_more_than_5_reviews"})):0===a?l.createElement("p",{className:"_3x4zY_NI"},l.createElement(u.a,{id:"supplier_trust_module_explanation_no_review"})):l.createElement("p",{className:"_3x4zY_NI"},l.createElement(u.a,{id:"supplier_trust_module_explanation_5_or_less_reviews"}))},S=function e(t){var a=t.supplierData,r=t.servletName,c=t.modalOpen,s=t.clickedReview,o=t.onClick,d=t.onClose,v="MOBILE"===l.useContext(m.Device).viewportCategory,E=l.useRef(null),b=l.useRef(null),N=l.useRef(null),g=l.useState(!1),k=n()(g,2),w=k[0],x=k[1],O=l.useState(!0),y=n()(O,2),R=y[0],S=y[1];return a?l.createElement("div",{className:"_34T51BH2"},l.createElement("div",{className:"_3BxxutEU"},l.createElement(u.a,{id:"supplier_trust_module_title"})),l.createElement("div",{className:"_1_QLUV8J"},l.createElement(j,{count:a.productReviewCount}),l.createElement("div",{className:"zxD2Mq_0"},l.createElement("div",{className:"ehl5I7IE"},l.createElement(u.a,{id:"attractions.merchandising.by_non_imperative",args:{supplier:a.supplierName||""}})),l.createElement("div",{className:"_3O6cjDpn"},l.createElement(f.BubbleRatingWithLinkedReviewCount,{rating:a.overallRating,numReviews:a.totalReviewCount,fontSize:14,url:"#REVIEWS"})),a.hasCertificateOfExcellence&&l.createElement("div",null,l.createElement("span",{className:"_2gBce6DW"},l.createElement(p.a,{name:"certificate-of-excellence",color:Object(i.featureIsEnabled)("cx_brand_refresh_degreen")?"black":"taGreen"})),l.createElement("span",{className:"_2Scor5dx"},l.createElement(u.a,{id:"CertExcellence_ffffdc53"}))),!v&&a.supplierReviews.length>3&&R&&l.createElement("span",{className:"_1WY-RMws",onClick:function e(){E.current&&(E.current.scrollLeft+=245)},ref:b},l.createElement(p.a,{name:"single-chevron-right",color:Object(i.featureIsEnabled)("cx_brand_refresh_degreen")?"black":"taGreen"})),!v&&w&&l.createElement("span",{className:"_2rtQfF6N",onClick:function e(){E.current&&(E.current.scrollLeft-=245)},ref:N},l.createElement(p.a,{name:"single-chevron-left",color:Object(i.featureIsEnabled)("cx_brand_refresh_degreen")?"black":"taGreen"})),l.createElement("div",{onScroll:function e(){if(E.current){E.current.scrollLeft<=0?x(!1):S(!0);var t=Math.ceil(E.current&&E.current.scrollLeft);E.current&&t>=E.current.scrollWidth-E.current.offsetWidth?S(!1):E.current&&E.current.scrollLeft>0&&x(!0)}},className:_()("_3L5vTurR","tourOperatorReviews"),ref:E},(a.supplierReviews||[]).map(function(e,t){return l.createElement(h,{key:e.reviewId,index:t,item:e,numReviews:a.supplierReviews.length,servletName:r,onClick:o})}),c&&l.createElement(C,{onClose:d,review:s}))))):null},D=function e(t){var a=t.servletName,r=t.returnEmpty,n=t.supplierData,i=t.modalOpen,o=t.clickedReview,u=t.onClick,m=t.onClose,d=Object(c.useGARecorder)();return l.createElement(s.HasBeenVisible,{onVisible:function e(){d({module:a,action:"in_view"})}},function(e){return l.createElement("div",{ref:e},!r&&l.createElement(S,{supplierData:n,servletName:a,modalOpen:i,clickedReview:o,onClick:u,onClose:m}))})},I=a("@babel/runtime/helpers/esm/defineProperty"),T=a.n(I),P=a("urql"),V=a("@ta/attractions.product-detail-data-loader"),W=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"COEAwardQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"coeAward"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"requests"},"value":{"kind":"ListValue","values":[{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"locations"},"value":{"kind":"ListValue","values":[{"kind":"Variable","name":{"kind":"Name","value":"locationId"}}]}}]}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"locations"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":124}}');W.__key=0xc5ceb54fc5c9,W.loc.source={body:"c5ceb54fc5c9"};var M=W;function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}t.default=function e(){var t=Object(c.useGARecorder)(),a=l.useState(!1),r=n()(a,2),s=r[0],o=r[1],u=l.useState({}),m=n()(u,2),d=m[0],p=m[1],v=l.useCallback(function(e,a){t({module:"SupplierTrustModule",action:"click_read_more",context:(a+1).toString()}),p(e),o(!0)},[t]),_=l.useCallback(function(){t({module:"SupplierTrustModule",action:"click_close"}),o(!1),p({})},[t]),f=function e(){var t=Object(V.useSupplierTrustData)(),a={query:M,variables:{locationId:(null==t?void 0:t.supplierId)||0}},r=Object(P.useQuery)(a),c=n()(r,1)[0];return l.useMemo(function(){if(!t)return null;var e=c.data,a=e&&e.coeAward&&e.coeAward[0]&&e.coeAward[0].locations&&e.coeAward[0].locations[0];return function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(a,!0).forEach(function(t){T()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},t,{hasCertificateOfExcellence:a===t.supplierId})},[c,t])}();return Object(i.featureIsEnabled)("attractions_supplier_trust_module_v2")?f&&f.supplierId&&f.supplierReviews&&0!==f.supplierReviews.length?l.createElement(D,{servletName:"SupplierTrustModule",returnEmpty:!1,supplierData:f,modalOpen:s,clickedReview:d,onClick:v,onClose:_}):null:l.createElement(D,{servletName:"SupplierTrustModule",returnEmpty:!0,supplierData:f,modalOpen:s,clickedReview:d,onClick:v,onClose:_})}}}});
//# sourceMappingURL=attractions.supplier-trust.8aecc9aa9c.js.map