($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.tour-planner-lithium",d:["vendor-babel","vendor-react-libs","lithium-platform","@ta/attractions.util-tour-planner","@ta/attractions.telesales-number","@ta/common.transitions","@ta/modal.core","@ta/common.features","@ta/attractions.util-datepicker","@ta/platform.interactions","lithium-common","@ta/attractions.product-inactive-alert","@ta/attractions.product-tag","@ta/core-ui.merchandising-pill","@ta/modal.styleguide","@ta/attractions.apd-tracking-util","@ta/attractions.util-decode","@ta/attractions.language-list","@ta/attractions.age-band-list","@ta/attractions.datepicker","@ta/common.text","@ta/attractions.reserve-now-pay-later","@ta/overlays.tooltip","@ta/attractions.attraction-social-proof","@ta/attractions.free-cancellation","@ta/attractions.no-booking-fees","@ta/attractions.low-price-guarantee","@ta/attractions.scroll-util","@ta/attractions.util-availability","@ta/platform.monikers","@ta/attractions.check-availability"],e:["./packages/attractions/tour-planner-lithium/tour-planner-lithium.jsx"],m:{"./packages/attractions/tour-planner-lithium/tour-planner-lithium.jsx":function(e,t,a){"use strict";a.r(t);var n=a("@babel/runtime/helpers/esm/slicedToArray"),r=a.n(n),l=a("react"),c=a.n(l),o=a("@ta/lithium.context"),i=a("@ta/attractions.util-tour-planner"),s=a("@ta/attractions.telesales-number"),u=a.n(s),d=a("@ta/common.transitions"),m=a.n(d),_=a("@ta/modal.core"),E=a("@babel/runtime/helpers/esm/defineProperty"),p=a.n(E),g=a("@ta/common.classnames"),f=a.n(g),C=a("@ta/common.features"),v=a("@ta/common.is-visible"),b=a("@ta/platform.i18n"),T=a.n(b),A=a("@ta/platform.interactions"),D=a("@ta/attractions.product-inactive-alert"),O=a.n(D),x=a("@ta/attractions.product-tag"),h=a.n(x),P=l.createContext({productHeaderModel:null,tourPlannerModel:null,servletName:"",setCheckAvailabilityCallback:function e(){}}),R=l.createContext({isExpanded:!1,planningStep:"DATE",isRNPL:!1,selectedDate:null,hasMadeFirstCheck:!1,hasExpandedTray:!1,hasChangedPax:!1,travelerCount:0,result:null,priceCalendar:null,tourPlannerModel:null,selectedTourGrade:null,cartItemsCount:0,selectedAgeBands:new Map,selectedLanguageFilters:new Map,mainError:null,headerErrorMessage:null,checkAvailabilityAfterFetchingDates:!1}),y=l.createContext({dispatch:function e(){}}),k=function e(t){var a=t.props,n=a.productHeaderModel,r=a.tourPlannerModel,c=a.servletName,o=t.state,i=t.dispatch,s=t.children,u=l.useMemo(function(){return{productHeaderModel:n,tourPlannerModel:r,servletName:c}},[n,r,c]);return l.createElement(P.Provider,{value:u},l.createElement(R.Provider,{value:o},l.createElement(y.Provider,{value:{dispatch:i}},s)))},S=a("@ta/attractions.util-datepicker"),M=function e(t){return Array.from(t).map(function(e){return"ab".concat(e[0],":[").concat(e[1],"]")}).join("|")},N=function e(t){return t.join(",")},L=function e(t,a,n,r,l,c){return"ProductCode:".concat(t).concat(a?"|date:".concat(a):"").concat(r?"|langFilterSelection:".concat(r):"").concat(l?"|tourGradeLang:".concat(l):"").concat(c?"|slot:".concat(c):"").concat(n?"|".concat(n):"")},j=function e(t,a){return"".concat(t,",").concat(a)},I=function e(t){return{module:"AttractionProductDetail",action:"ExpABTestEligible:314|rnpl_ineligible_tour_grade",context:t}},B=function e(t){return"CHECK_TOUR_GRADES"===t||"ADD_TO_CART"===t||"VIEW_CART"===t},G=function e(t,a,n){var r="MOBILE"===l.useContext(o.Device).viewportCategory,c=Object(A.useGARecorder)();return l.useCallback(function(e){Object(S.isDateBlockedFromPriceCalendarMap)(e,t)||(a(r?{type:"CHECK_AVAILABILITY",selectedDate:e}:{type:"UPDATE_DATE_AND_ADVANCE",selectedDate:e}),c(function e(t){return{module:"AttractionProductDetail",action:"click_datepicker_select_date",context:t}}(L(n,Object(S.getDateFormat)(e,"YYYY-MM-DD")))))},[a,r,t,n,c])},F=function e(){var t=Object(b.useLocalize)().localize,a=Object(b.useIntlFormatter)(),n=l.useContext(R),r=n.selectedDate,c=n.selectedAgeBands;if(Object(C.featureIsEnabled)("attractions_apd_sold_out_message_with_additional_availability")&&r){var o=Object(i.getPAXText)(c,t),s=a.formatDate("week_date_long",r);return t.string("attractions.booking.tour_grade_unavailable_for_pax_date",{PAX:o,date:s})}return t.string("attractions.booking.tour_grade_unavailable_try_different")},w=function e(){var t,a,n=l.useContext(R);return Boolean(!(null===(t=n.result)||void 0===t?void 0:t.allTourGrades.length)&&(null===(a=n.availableDatesResult)||void 0===a?void 0:a.length))},H=function e(t){var a=t.groupSize;return l.createElement("div",{className:"_3WvBxnsW"},l.createElement(T.a,{id:"exp_per_group_size",args:{groupSize:a}})," ")},U=function e(t){var a=t.inline,n=l.useContext(R),r=n.selectedTourGrade,c=n.planningStep,o=l.useContext(P).productHeaderModel,i=Object(b.useIntlFormatter)(),s=o&&o.fromPricing||"",u=o&&o.productPromo||null,d=o&&o.maxTravelersPerUnit||null;return a?l.createElement(l.Fragment,null,s,l.createElement("span",{className:"_1P-7XCmL"},u&&u.strikeThruPrice)):l.createElement("div",{className:"_38intmtb"},!r||"RESULTS"!==c&&"ADD_TO_CART"!==c&&"CHECKOUT"!==c&&"VIEW_CART"!==c?l.createElement(l.Fragment,null,l.createElement("div",null,l.createElement("span",{className:"_39dZJtbC"},l.createElement(T.a,{id:"exp_tour_planner_from_price"})),u&&u.strikeThruPrice&&l.createElement("span",{className:"_1P-7XCmL"},u&&u.strikeThruPrice)),l.createElement("div",{className:"_3nF-894k"},s),Object(C.featureIsEnabled)("attractions_apd_show_unit_pricing_for_above_the_fold")&&d&&d>0&&l.createElement(H,{groupSize:d})):l.createElement(l.Fragment,null,l.createElement("div",{className:"_39dZJtbC"},l.createElement(T.a,{id:"exp_tour_planner_total_price"})),l.createElement("div",{className:"_3nF-894k"},i.formatCurrency(r.totalPrice)),Object(C.featureIsEnabled)("attractions_apd_show_unit_pricing_for_tour_grade")&&Object(C.featureIsEnabled)("attractions_apd_show_unit_pricing_for_above_the_fold")&&r.maxTravelersPerUnit&&r.maxTravelersPerUnit>0&&l.createElement(H,{groupSize:r.maxTravelersPerUnit})))};U.defaultProps={inline:!1};var V=U,Y=function e(t){var a=t.inline,n=l.useContext(R),r=n.planningStep,c=n.result,o=w();if(a)return l.createElement(T.a,{id:"exp_booking_options_from",args:{0:l.createElement(V,{inline:!0})}});if("RESULTS"===r&&c&&!o){var i=c.availableTourGrades,s=c.allTourGrades;return s.length>1?l.createElement(T.a,{id:"exp_num_of_num_booking_options_available",args:{numAvailable:i.length,numTotal:s.length}}):l.createElement(T.a,{id:"exp_tour_planner_your_date_is_available"})}return"RESULTS"===r&&o?l.createElement(T.a,{id:"exp_tour_planner_try_a_different_date"}):l.createElement(T.a,{id:"attractions.booking.select_date_and_travelers"})};Y.defaultProps={inline:!1};var K=Y,W=a("@ta/core-ui.button"),X=a.n(W),z=a("@ta/modal.styleguide"),q=a.n(z),Q=a("@ta/styleguide.loading"),J=a("@ta/attractions.apd-tracking-util"),Z=a.n(J),$=a("@ta/attractions.util-decode"),ee=a("@ta/attractions.language-list"),te=a.n(ee),ae=a("@ta/attractions.age-band-list"),ne=a.n(ae),re=function e(){var t="MOBILE"===l.useContext(o.Device).viewportCategory,a=l.useContext(P),n=l.useContext(R),c=l.useContext(y).dispatch,s=Object(A.useGARecorder)(),u=n.selectedAgeBands,d=n.hasChangedPax,m=l.useState(-1),_=r()(m,2),E=_[0],p=_[1],g=l.useCallback(function(e,t){var n=new Map;u.forEach(function(e,t){n.set(t,e)}),n.set(e,u.get(e)+t),!d&&a.tourPlannerModel&&s(function e(t){return{module:"AttractionProductDetail",action:"click_paxpicker_select_pax",context:t}}(L(Object($.getDecodedValue)(a.tourPlannerModel.productCode)))),c({type:"CHANGE_AGE_BAND_SELECTION",selectedAgeBands:n,travelerCount:Object(i.getTotalPaxCount)(n)})},[c,d,u,s,a.tourPlannerModel]),f=l.useCallback(function(e){g(e,1),p(-1)},[g]),C=l.useCallback(function(e){p(e)},[]),v=l.useCallback(function(e){g(e,-1),p(-1)},[g]);if(!a.tourPlannerModel)return null;var b=a.tourPlannerModel,T=b.ageBands,D=b.maxPax,O=function e(t){var a=T.find(function(e){return e.ageBandId===t});return a?a.maxPaxCount:-1};return l.createElement(l.Fragment,null,l.createElement(ne.a,{ageBands:T,ageBandSelections:u,onEnabledPlusClick:f,onDisabledPlusClick:C,onEnabledMinusClick:v,totalAgeBandSelection:n.travelerCount,maxPaxCount:D,styleVersion:t?"SmallText":"Default"}),-1!==E&&-1!==O(E)&&l.createElement("div",{className:"_1Mm7x6Kl"},l.createElement(ae.PaxErrorMessaging,{ageBandId:E,currentlySelectedPaxCount:n.travelerCount,productMaxPax:D,ageBandMaxPax:O(E)})))},le=a("@ta/core-ui.icon"),ce=a.n(le),oe=function e(t){var a;return l.createElement("div",{className:"_1w7pm3OT","data-automation":t.testId,onClick:t.onClick},l.createElement("div",{className:f()("_2tapUpIS",(a={},p()(a,"_2Gk6O0Fk",t.active),p()(a,"_1aHW744O",Object(C.featureIsEnabled)("cx_brand_refresh_degreen")),a))},l.createElement("span",{className:"Jc2Klw9s"},l.createElement(ce.a,{name:t.iconName})),l.createElement("span",{className:"NffSR06n"},t.text)))},ie=function e(t){return"TABLET"===l.useContext(o.Device).viewportCategory?l.createElement(l.Fragment,null,l.createElement("div",{className:"bERvcc29"},l.createElement("div",{className:f()("_3apxG-JX",p()({},"_2l_vOzao",null!==t.optionsButton))},null!==t.dateButton&&l.createElement("div",{className:"_3fdH9N6-"},t.dateButton),l.createElement("div",{className:"_3fdH9N6-"},t.paxButton)),t.optionsButton),t.languageFilterButton):l.createElement(l.Fragment,null,l.createElement("div",{className:"_3apxG-JX"},null!==t.dateButton&&l.createElement("div",{className:"_3fdH9N6-"},t.dateButton),l.createElement("div",{className:"_3fdH9N6-"},t.paxButton),null!==t.optionsButton&&l.createElement("div",{className:"_3fdH9N6-"},t.optionsButton)),t.languageFilterButton)},se=function e(){var t=l.useContext(R),a=t.planningStep,n=t.isExpanded,r=t.hasExpandedTray,c=t.selectedDate,o=l.useContext(P).tourPlannerModel,i=l.useContext(y).dispatch,s=Object(A.useGARecorder)(),u=o&&o.productCode,d=Object(b.useIntlFormatter)(),m=B(a),_=n&&"DATE"===a,E=c&&d.formatDate("date_medium_month",c)||l.createElement(T.a,{id:"airm_date"}),p=l.useCallback(function(){m||_||(i({type:"SET_STEP_DATE"}),u&&(n?s(function e(t){return{module:"AttractionProductDetail",action:"click_date_cta_open",context:t}}(L(Object($.getDecodedValue)(u)))):r||s(Z.a.clickDatePickerOpen(Object($.getDecodedValue)(u),!0,!1))))},[i,r,_,n,m,u,s]);return l.createElement(oe,{iconName:"calendar",text:E,active:_,onClick:p,testId:"date_picker_button"})},ue=function e(){var t="MOBILE"===l.useContext(o.Device).viewportCategory,a=l.useContext(R),n=a.planningStep,c=a.isExpanded,s=a.hasExpandedTray,u=a.selectedAgeBands,d=a.travelerCount,m=a.headerErrorMessage,_=l.useContext(P).tourPlannerModel,E=l.useContext(y).dispatch,p=Object(A.useGARecorder)(),g=_&&_.productCode,f=l.useState(!1),C=r()(f,2),v=C[0],b=C[1],D=l.useCallback(function(){E({type:"CHECK_AVAILABILITY"})},[E]),O=B(n),x=c&&"PAX"===n,h=Object(i.validateOnlyAdults)(u),k=l.useMemo(function(){return h?l.createElement(T.a,{id:"attractions.booking.common_n_adult",args:{0:d}}):l.createElement(T.a,{id:"attractions.booking.common_n_traveler",args:{0:d}})},[h,d]),S=l.useCallback(function(){t&&"CHECK_AVAILABILITY"!==n?b(!0):O||x||(E({type:"SET_STEP_PAX"}),g&&(c?p(function e(t){return{module:"AttractionProductDetail",action:"click_pax_cta_open",context:t}}(L(Object($.getDecodedValue)(g)))):s||p(Z.a.clickPaxPickerOpen(Object($.getDecodedValue)(g)))))},[E,s,c,t,x,n,O,g,p]);return l.useEffect(function(){t&&("PAX"===n&&m&&b(!0),"RESULTS"!==n&&"ERROR"!==n||b(!1))},[m,t,n]),l.createElement(l.Fragment,null,l.createElement(oe,{iconName:"users",text:k,active:x,onClick:S,testId:"traveller_button"}),v&&l.createElement(q.a,{fullscreen:"never",onClose:D,header:l.createElement("div",{className:"_2973AUzK"},l.createElement(T.a,{id:"attractions.booking.travelers"})," ")},m&&l.createElement("div",{className:"_1JdqPdsI"},m),l.createElement(re,null),l.createElement("div",{className:"_2alAdMQG"},l.createElement(X.a,{fullWidth:!0,onClick:D},"CHECK_TOUR_GRADES"===n?l.createElement("div",{className:"_2nHg5t2"},l.createElement(Q.LoadingBubbles,{color:"light"})):l.createElement(T.a,{id:"exp_tour_planner_upate_results"})))))},de=function e(){var t=l.useContext(R),a=t.planningStep,n=t.isExpanded,r=t.hasExpandedTray,c=l.useContext(P).tourPlannerModel,o=l.useContext(y).dispatch,i=Object(A.useGARecorder)(),s=c&&c.productCode,u=B(a),d=n&&("RESULTS"===a||"CHECK_TOUR_GRADES"===a),m=l.useCallback(function(){u||d||(o({type:"CHECK_AVAILABILITY"}),s&&(n?i(function e(t){return{module:"AttractionProductDetail",action:"click_options_cta_open",context:t}}(L(Object($.getDecodedValue)(s)))):r||i(function e(t){return{module:"AttractionProductDetail",action:"click_options_cta_entry",context:t}}(L(Object($.getDecodedValue)(s))))))},[o,r,n,d,u,s,i]);return l.createElement(oe,{iconName:"tickets",text:l.createElement(T.a,{id:"exp_options_for_tours"}),active:d,onClick:m,testId:"options_button"})},me=function e(){var t=l.useContext(R),a=t.hasMadeFirstCheck,n=t.selectedLanguageFilters,r=l.useContext(P).tourPlannerModel,c=l.useContext(y).dispatch,o=Object(A.useGARecorder)(),i=r&&r.productCode,s=l.useCallback(function(){i&&o(function e(t){return{module:"AttractionProductDetail",action:"click_language_availability_dropdown",context:t}}(L(Object($.getDecodedValue)(i))))},[i,o]),u=l.useCallback(function(e,t){var a=new Map(n);a.set(e,t),c({type:"CHANGE_LANGUAGE_FILTER",selectedLanguageFilters:a}),i&&o(function e(t){return{module:"AttractionProductDetail",action:"click_language_availability_select_value",context:t}}(L(Object($.getDecodedValue)(i))))},[c,i,n,o]),d=l.useCallback(function(){a&&c({type:"CHECK_AVAILABILITY"})},[c,a]);return r&&r.productLanguages&&r.productLanguages.length>1?l.createElement("div",{className:"_1zfkcY8G"},l.createElement(te.a,{productLanguages:r.productLanguages,selectedLanguageFilters:n,onLanguageFilterChange:u,onLanguageFilterClose:d,onClick:s})):null},_e=a("@ta/core-ui.merchandising-pill"),Ee=a.n(_e),pe=function e(t){var a=t.inModal,n=l.useContext(P).productHeaderModel,r=n&&n.productPromo||null;return!(!r||!r.promoText)&&l.createElement("div",{className:f()("_3tQL8P4V",a&&"_1SqVuRL3")},l.createElement("div",{className:f()("_2GaIjLJw",a&&"_1SqVuRL3")},l.createElement(Ee.a,{type:"secondary"},l.createElement("span",{className:"_2SqDjetK"},l.createElement(T.a,{id:"attractions.booking.flag.special_offer"})))),l.createElement("div",{className:"_1fEI0pv1"},null==r?void 0:r.promoText))};pe.defaultProps={inModal:!1};var ge=pe,fe=function e(t){var a=t.tag;return a?l.createElement(h.a,{productTag:a,margin:"none"}):null},Ce=function e(t){var a,n=t.inline,r=l.useContext(R),c=r.isExpanded,s=r.headerErrorMessage,u=r.priceCalendar,d=l.useContext(P).productHeaderModel,m="MOBILE"===l.useContext(o.Device).viewportCategory,_=Object(A.useGARecorder)(),E=Object(i.useProductActivity)(u,d).isInactive,g=d&&d.productPromo||null,b=!(!g||!g.promoText),D=d&&Object(x.getHighestPriorityTagExceptSpecialOffer)(d.productTags,b),h=!(!n&&c&&m),y=Object(C.featureIsEnabled)("attraction_recommended_tags_apr_en_pos_only")&&d&&(!Object(C.featureIsEnabled)("attractions_apd_social_proof_total_bookings")||Object(C.featureIsEnabled)("attractions_apd_social_proof_total_bookings")&&(d.totalBookings||0)<100)&&d.recommendedTravelerRating>=.8;return l.createElement("div",{className:f()("_230sICBn",(a={},p()(a,"rkRw0ZHB",!b),p()(a,"_2zFl2E4O",!n&&c),a))},h&&l.createElement(ge,null),l.createElement("div",{className:"_2Vq7neeH"},l.createElement("div",{className:"_1tlRu6XX"},E&&l.createElement("div",{className:"_1pH0bkiB"},l.createElement(O.a,null)),!E&&!b&&l.createElement(fe,{tag:D}),y&&l.createElement(v.HasBeenVisible,{onVisible:function e(){_({module:"Social Proof Message",action:"rec_tag_shown"})}},function(e){return l.createElement("div",{ref:e,className:"_1ksHaD-8"},l.createElement(T.a,{id:"exp_recommended_by_travelers_percent",args:{percent:Math.ceil(100*((null==d?void 0:d.recommendedTravelerRating)||0))}}))}),!E&&l.createElement("div",{className:"_14vgiYWb"},l.createElement(K,{inline:n}))),!E&&!n&&l.createElement(V,null)),Object(C.featureIsEnabled)("attractions_apd_show_unit_pricing_for_above_the_fold")&&(null==d?void 0:d.isTieredPricing)&&l.createElement("div",{className:"_2Y3zxUD_"},l.createElement(T.a,{id:"exp_price_varies_by_group_size"})),!h&&l.createElement(ge,null),!E&&!m&&l.createElement(ie,{dateButton:l.createElement(se,null),paxButton:l.createElement(ue,null),optionsButton:l.createElement(de,null),languageFilterButton:l.createElement(me,null)}),!n&&c&&s&&l.createElement("div",{className:"_2qtNPpSx",dangerouslySetInnerHTML:{__html:s}}))};Ce.defaultProps={inline:!1};var ve=Ce,be=a("@ta/attractions.reserve-now-pay-later"),Te=a.n(be),Ae=a("@ta/overlays.tooltip"),De=a.n(Ae),Oe=a("@ta/attractions.attraction-social-proof"),xe=a.n(Oe),he=a("@ta/attractions.free-cancellation"),Pe=a.n(he),Re=a("@ta/attractions.no-booking-fees"),ye=a.n(Re),ke=a("@ta/attractions.low-price-guarantee"),Se=a.n(ke),Me=function e(){return l.createElement("span",{className:"_166arABW"},l.createElement(ce.a,{name:"checkmark"}))},Ne=function e(){var t=l.useContext(P).tourPlannerModel,a=Object(be.useReserveNowPayLaterEnabled)(),n=Object(A.useGARecorder)();return l.useEffect(function(){n(function e(t){return{module:"AttractionProductDetail",action:"ExpABTestEligible:t11970_socialproof_apd_test",context:t}}("SOCIAL_PROOF_ELIGIBLE"))},[n]),l.createElement("div",{"data-automation":"tourPlannerMessaging"},t&&t.productCode&&l.createElement("div",{className:"_2kMkq7ub"},l.createElement(xe.a,{productCode:t.productCode})),!Object(C.featureIsEnabled)("highlight_free_cancellation_on_apr_and_checkout")&&t&&t.freeCancellationMessage&&l.createElement(Pe.a,{freeCancellationMessage:t.freeCancellationMessage,iconOverride:l.createElement(Me,null)}),t&&t.reserveNowPayLaterMessage&&a&&l.createElement("div",{className:"_2f2rhco2"},l.createElement(Me,null),l.createElement("span",{className:"_2bciaBDu"},l.createElement(Te.a,{type:"followingQuestionMark"}))),l.createElement("div",{className:"_2f2rhco2"},l.createElement(Me,null),l.createElement("span",{className:"_2bciaBDu"},l.createElement(Se.a,{type:"followingQuestionMark"}))),!t||!t.reserveNowPayLaterMessage&&l.createElement(ye.a,{styling:"tour-planner"}))},Le=function e(t){var a=t.inModal,n=l.useContext(P).productHeaderModel,r=l.useContext(R).selectedDate,c=n&&n.freeCancellationDurationInDays||null,o=!!c,i=function e(t,a){if(!t||!a)return null;var n=new Date(t);n.setDate(n.getDate()-a);var r=new Date,l=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),0,0,0,0);return n.getTime()>=l.getTime()?n:null}(r,c),s=Object(b.useIntlFormatter)(),u=i&&s.formatDate("date_medium_month",i);return o&&u&&l.createElement("div",{className:f()("_1UQEGhK3",a&&"_2HKNQ7nx")},l.createElement("div",{className:f()("Tm0WlYa6",a&&"_2HKNQ7nx")},l.createElement(Ee.a,{type:"promo"},l.createElement("span",{className:"_2ZdweFps"},l.createElement(T.a,{id:"attractions_free_cancellation"})))),l.createElement("div",{className:"_1ztpOHvp"},l.createElement(T.a,{id:"attractions_free_cancellation_refund_msg",args:{date:u}})))};Le.defaultProps={inModal:!1};var je=Le,Ie=function e(){var t=l.useContext(P).tourPlannerModel;return t&&Object(C.featureIsEnabled)("attractions_prominent_telesales_number")?l.createElement("div",{className:"_21wYnTU2"},l.createElement("span",{className:"_3f4FYCrj"},l.createElement(ce.a,{name:"phone"})),l.createElement("span",{className:"_123qY_Eq"},l.createElement(T.a,{id:"attractions.booking.24_7_support"})," ",l.createElement("span",{className:"_2Z-sP_Zd"}),l.createElement(T.a,{id:"crm_ib_cs_call"})," "),l.createElement(u.a,{serviceNumber:t.serviceNumber,productCode:Object($.getDecodedValue)(t.productCode),additionalProductAttr:"prominent_telesales",numberStyle:"TaGray3"})):null},Be=function e(t){var a=t.isTourGradeRNPL,n=l.useContext(R),r="MOBILE"===l.useContext(o.Device).viewportCategory,c=w();if("CHECKOUT"===n.planningStep||"VIEW_CART"===n.planningStep)return l.createElement(T.a,{id:"attractions.cart_view_cart"});if(!n.hasExpandedTray)return l.createElement(T.a,{id:"exp_check_availability"});var i=Object(C.featureIsEnabled)("attractions_cartless_checkout")?l.createElement(T.a,{id:"exp_book_now_apd"}):l.createElement(T.a,{id:"mob_cart_add_to"}),s=r?l.createElement(T.a,{id:"attraction.reserve.button"}):l.createElement(T.a,{id:"attractions.booking.reserve.now.pay.later"}),u=l.createElement(T.a,{id:"exp_tour_planner_change_my_date"});switch(n.planningStep){case"DATE":case"PAX":return n.hasMadeFirstCheck?l.createElement(T.a,{id:"exp_tour_planner_upate_results"}):l.createElement(T.a,{id:"exp_tour_planner_next_step"});case"CHECK_TOUR_GRADES":case"RESULTS":case"ADD_TO_CART":return c?u:a?s:i;case"ERROR":return l.createElement(T.a,{id:"exp_tour_planner_upate_results"});default:return l.createElement(T.a,{id:"exp_check_availability"})}},Ge=function e(t){var a=l.useContext(R),n=l.useContext(P),r=Object(b.useLocalize)().localize,c=Object(A.useGARecorder)(),s=l.useContext(y).dispatch,u="MOBILE"===l.useContext(o.Device).viewportCategory,d=w();return l.useCallback(function(){if(n.tourPlannerModel){var e,l,o=n.tourPlannerModel,m=o.productCode,_=o.tourGrades,E=a.selectedDate,p=a.selectedLanguageFilters,g=a.selectedAgeBands,f=a.selectedTourGrade,C=a.daysFromOriginalDate,v=Object(i.getSelectedLanguagesFromMap)(p),b=(f&&f.languageServices?f.languageServices:[]).map(function(e){return e&&e.locale?e.locale:""}),T=f?_.findIndex(function(e){return e.gradeCode===f.tourGradeCode})+1:0,A=null!=E?L(Object($.getDecodedValue)(m),Object(S.getDateFormat)(E,"YYYY-MM-DD"),M(g),N(v),N(b),T):Object($.getDecodedValue)(m);if(u&&!a.isExpanded)e=a.hasMadeFirstCheck?{type:"EXPAND"}:{type:"CHECK_AVAILABILITY"},l=Z.a.checkAvailabilityClick("".concat(L(Object($.getDecodedValue)(m)),"|tourplanner"));else if("CHECKOUT"===a.planningStep)e={type:"VIEW_CART"};else if(a.isExpanded||a.hasExpandedTray)switch(a.planningStep){case"CHECK_TOUR_GRADES":e={type:"CHECK_AVAILABILITY"};break;case"DATE":null==E?e={type:"SET_STEP_DATE",headerErrorMessage:r.string("attractions.booking.errors.no_date")}:a.hasMadeFirstCheck?(l=Z.a.postCheckAvailabilityUpdateClick(A),e={type:"CHECK_AVAILABILITY"}):(e={type:"SET_STEP_PAX"},l=function e(t){return{module:"AttractionProductDetail",action:"click_date_next",context:t}}(L(Object($.getDecodedValue)(m),Object(S.getDateFormat)(E,"YYYY-MM-DD"))));break;case"PAX":if(null==E){e={type:"SET_STEP_DATE",headerErrorMessage:r.string("attractions.booking.errors.no_date")};break}if(!n.tourPlannerModel){e={type:"EXPAND"};break}e={type:"CHECK_AVAILABILITY"},l=a.hasMadeFirstCheck?Z.a.postCheckAvailabilityUpdateClick(A):function e(t){return{module:"AttractionProductDetail",action:"click_check_availability_next",context:t}}(A);break;case"RESULTS":d?(e={type:"CHECK_AVAILABILITY"},E&&C&&(l=function e(t){return{module:"AttractionProductDetail",action:"click_change_my_date",context:t}}(j(Object(S.getDateFormat)(E,"YYYY-MM-DD"),C)))):(e=t?{type:"RESERVE_TO_CART"}:{type:"ADD_TO_CART"},null!=E&&(l=t?function e(t){return{module:"AttractionProductDetail",action:"ExpABTestEligible:314|click_reserve_to_cart",context:t}}(A):function e(t){return{module:"AttractionProductDetail",action:"click_add_to_cart",context:t}}(A)));break;case"ERROR":e={type:"SET_STEP_DATE"};break;default:e={type:"EXPAND"}}else e={type:"CHECK_AVAILABILITY"},l=Z.a.checkAvailabilityClick("".concat(L(Object($.getDecodedValue)(m)),"|tourplanner"));s(e),l&&c(l)}},[n.tourPlannerModel,a,u,s,t,r,c,d])},Fe=function e(){var t=Object(A.useGARecorder)(),a=l.useContext(R),n=Ge(!0),r=Ge(!1),c="RESULTS"===a.planningStep||"ADD_TO_CART"===a.planningStep||"CHECK_TOUR_GRADES"===a.planningStep,i="MOBILE"===l.useContext(o.Device).viewportCategory,s=a.selectedTourGrade&&a.selectedTourGrade.rnplEligibility&&!0===a.selectedTourGrade.rnplEligibility.eligible,u=s?null:function e(t){var a=t.selectedTourGrade&&t.selectedTourGrade.rnplEligibility&&t.selectedTourGrade.rnplEligibility.ineligibilityReasons;return a&&a.includes("TRAVEL_DATE_AFTER_MAX_DATE")?{message:l.createElement(T.a,{id:"attractions.booking.rnpl.error.over.max.date"}),enum:"TRAVEL_DATE_AFTER_MAX_DATE"}:a&&a.includes("TRAVEL_DATE_BEFORE_MIN_DATE")?{message:l.createElement(T.a,{id:"attractions.booking.rnpl.error.under.min.date"}),enum:"TRAVEL_DATE_BEFORE_MIN_DATE"}:{message:l.createElement(T.a,{id:"attractions.booking.rnpl.error.general"}),enum:"TOURGRADE_NOT_SUPPORTED"}}(a),d=u?u.enum:null;return l.useEffect(function(){"TRAVEL_DATE_AFTER_MAX_DATE"===d?t(I("TRAVEL_DATE_AFTER_MAX_DATE")):"TRAVEL_DATE_BEFORE_MIN_DATE"===d?t(I("TRAVEL_DATE_BEFORE_MIN_DATE")):"TOURGRADE_NOT_SUPPORTED"===d&&t(I("TOURGRADE_NOT_SUPPORTED"))},[t,d]),l.createElement(l.Fragment,null,l.createElement("div",{className:f()("yHgv7tts",c&&"PUjw1mG9"),"data-automation":"tourPlannerFooterButton"},c&&!s&&l.createElement("div",{className:f()("_12ztxV0i","fUQGTtCT")},l.createElement(De.a,{above:!0,toggleOnTouch:!0,message:u&&u.message,onShow:function e(){t(function e(t){return{module:"AttractionProductDetail",action:"ExpABTestEligible:314|click_tool_tip_rnpl_ineligible_tour_grade",context:t}}(null!=u?u.enum:""))}},function(e){return l.createElement("span",{ref:e},l.createElement(X.a,{fullWidth:!0,theme:"secondary",disabled:!0},l.createElement(Be,{isTourGradeRNPL:!0})))})),c&&s&&l.createElement("div",{className:f()("_12ztxV0i","fUQGTtCT")},l.createElement(X.a,{fullWidth:!0,theme:"secondary",onClick:n},l.createElement(Be,{isTourGradeRNPL:!0}))),l.createElement("div",{className:f()(c&&"_12ztxV0i")},l.createElement(X.a,{fullWidth:!0,theme:"original",onClick:r},l.createElement(Be,{isTourGradeRNPL:!1})))),!i&&c&&l.createElement("div",{className:"fdEEGsFo"},l.createElement(Te.a,{type:"learnMore"})))},we=function e(t){var a=t.inline,n="MOBILE"===l.useContext(o.Device).viewportCategory,c=l.useContext(R),s=l.useContext(R),u=s.isExpanded,d=s.priceCalendar,m=l.useContext(P),_=m.tourPlannerModel,E=m.productHeaderModel,g=Object(i.useProductActivity)(d,E).isInactive,b=Ge(!1),A=Object(be.useReserveNowPayLaterEnabled)(),D=w(),O=l.useState(!1),x=r()(O,2),h=x[0],y=x[1],k=l.useCallback(function(e){y(!e)},[]),S=Object(v.useVisibleEffect)(k),M=A&&_&&_.reserveNowPayLaterMessage&&!D,N=M&&("RESULTS"===c.planningStep||"ADD_TO_CART"===c.planningStep||"CHECK_TOUR_GRADES"===c.planningStep);return l.createElement("div",{className:f()("_1Y2aM2o4",p()({},"o_dAmH7t",!n))},a?l.createElement(l.Fragment,null,l.createElement("div",{className:f()("yHgv7tts",p()({},"_2TfXxxxR",u)),"data-automation":"tourPlannerFooterButton",ref:S},l.createElement(X.a,{fullWidth:!0,theme:"original",onClick:b},l.createElement(T.a,{id:"exp_check_availability"})," ")),h&&l.createElement("div",{className:"OyXMK0bQ"},l.createElement("div",{className:"_2TfXxxxR"},l.createElement(X.a,{fullWidth:!0,theme:"original",onClick:b},l.createElement(T.a,{id:"exp_check_availability"})," ")))):l.createElement(l.Fragment,null,!g&&M&&l.createElement(Fe,null),!g&&!M&&l.createElement("div",{className:"yHgv7tts","data-automation":"tourPlannerFooterButton"},l.createElement(X.a,{fullWidth:!0,theme:"original",onClick:b},l.createElement(Be,{isTourGradeRNPL:!1})))),!g&&Object(C.featureIsEnabled)("highlight_free_cancellation_on_apr_and_checkout")&&l.createElement(je,null),(a||!n&&!u)&&l.createElement(Ie,null),!N&&(!n||!u||a)&&l.createElement(Ne,null))};we.defaultProps={inline:!1};var He=we,Ue=a("@ta/attractions.datepicker"),Ve=a("@babel/runtime/helpers/esm/toConsumableArray"),Ye=a.n(Ve),Ke=new Date(1970,0,1),We=function e(t){var a,n=t.date,r=t.selected,c=t.onClickCallBack,o=t.visible,i=Object(b.useIntlFormatter)(),s=i.formatDate("date_weekday",n),u=i.formatDate("date_short_month",n);return l.createElement("div",{className:f()("_1mtMReb_",(a={},p()(a,"_3H7TISX9",r),p()(a,"_1VlGZzQG",!o),a)),onClick:c},l.createElement("div",null,l.createElement("div",{className:f()("_2Xyhd0Ks",p()({},"_2j1AqF9u",r))},s),l.createElement("div",{className:f()("_3itGEHcj",p()({},"_2j1AqF9u",r))},u)))};We.defaultProps={date:Ke,selected:!1,onClickCallBack:function e(){},visible:!1};var Xe=We,ze=function e(t,a){return!(!t||!a)&&t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate()},qe=function e(t,a){var n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),r=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate());return Math.floor(Math.abs((n-r)/864e5))},Qe=function e(t){var a=l.useContext(R),n=l.useContext(y).dispatch,r=a.availableDatesResult,c=a.selectedDate,o=a.selectedAgeBands,s=a.originalSelectedDate,u=Object(b.useLocalize)().localize,d=Object(A.useGARecorder)(),m=Object(i.getPAXText)(o,u),_=w(),E=u.string("attractions.booking.tour_grade_unavailable.next_available_dates_unescaped",{PAX:m});return l.useEffect(function(){if(r&&s&&c&&!r.some(function(e){return ze(e,c)})){var e=r[0];c&&!ze(s,e)&&n({type:"UPDATE_DATE",selectedDate:e})}},[n,r,s]),_&&r?l.createElement("div",{className:t.padding?"_3vQKAU_T":""},l.createElement("div",{className:f()("_3gRMomiC","_1B76W0f9")},E),l.createElement("div",{className:f()("_2sooV7Gk")},r&&s&&r.map(function(e){return l.createElement(Xe,{date:e,selected:null!=c&&ze(c,e),key:e.toDateString(),onClickCallBack:function t(){n({type:"UPDATE_DATE",selectedDate:e,daysFromOriginalDate:qe(e,s)}),d(function e(t){return{module:"AttractionProductDetail",action:"click_new_date",context:t}}(j(Object(S.getDateFormat)(e,"YYYY-MM-DD"),qe(e,s))))},visible:!0})}).concat(Ye()(Array(function e(t){return t>1&&t<4?5-t:0}(r.length))).map(function(e,t){return l.createElement(Xe,{key:t})})))):null};Qe.defaultProps={padding:!1};var Je,Ze=Qe,$e=function e(){var t=l.useContext(R).mainError;return t?l.createElement("div",{className:"_3kgfcwD6",dangerouslySetInnerHTML:{__html:t.message}}):l.createElement("div",{className:"_3kgfcwD6"},l.createElement(T.a,{id:"t4b_ib_error_sorry"}))},et=a("@babel/runtime/helpers/esm/extends"),tt=a.n(et),at=a("@ta/common.text"),nt=function e(t){var a=t.text,n=t.showOneLineOnly,r=t.onReadMoreClick;return l.createElement("div",{className:"IPMP9G-d"},l.createElement(at.ReadMore,{cta:function e(t){return l.createElement("span",{className:"_3-Qua2xJ",onClick:function e(a){r(),t(),a.stopPropagation()}},l.createElement("span",{className:"_3Gt46LxU"},l.createElement(T.a,{id:"common_Read_more"})," "),l.createElement(ce.a,{name:"caret-down"}))},ctaCollapse:l.createElement("span",{className:"_3-Qua2xJ"},l.createElement("span",{className:"_3Gt46LxU"},l.createElement(T.a,{id:"common_Readless"})," "),l.createElement(ce.a,{name:"caret-up"})),numLinesToShow:n?1:2,collapsible:!0,ctaNewline:!0},a))},rt=function e(t){var a=t.selected,n=t.available;return l.createElement("span",{className:f()(a?"_907MMtgQ":"_2GyAeQjC",n?"_AgoOYCJ":"qteRHbBI",p()({},"_11XMMkej",Object(C.featureIsEnabled)("cx_brand_refresh_degreen")))},l.createElement(ce.a,{name:a?"checkmark-circle-fill":"bubble-rating-empty"}))},lt=function e(t){var a=t.lineItem,n=Object(b.useIntlFormatter)();switch(a.ageBand){case"ADULT":return l.createElement(T.a,{id:"attraction_booking_age_band_count_plural_price_1",args:{sBand:a.numTravelers,sPrice:n.formatCurrency(a.price)}});case"CHILD":return l.createElement(T.a,{id:"attraction_booking_age_band_count_plural_price_2",args:{sBand:a.numTravelers,sPrice:n.formatCurrency(a.price)}});case"INFANT":return l.createElement(T.a,{id:"attraction_booking_age_band_count_plural_price_3",args:{sBand:a.numTravelers,sPrice:n.formatCurrency(a.price)}});case"YOUTH":return l.createElement(T.a,{id:"attraction_booking_age_band_count_plural_price_4",args:{sBand:a.numTravelers,sPrice:n.formatCurrency(a.price)}});case"SENIOR":return l.createElement(T.a,{id:"attraction_booking_age_band_count_plural_price_5",args:{sBand:a.numTravelers,sPrice:n.formatCurrency(a.price)}});default:return null}},ct=function e(t){var a=t.lineItems;return l.createElement("div",{className:"_2fp4R4tz"},a.filter(function(e){return!!e&&e.numTravelers>0}).map(function(e){return e&&l.createElement("div",{className:"GdHFmg05",key:e.ageBand},l.createElement(lt,{lineItem:e}))}))},ot=function e(t){var a,n=t.tourGrade,r=t.selected,c=t.tourGradeRef,s=t.showSelectedBG,u=t.showOneLineOnly,d=l.useContext(y).dispatch,m=Object(b.useLocalize)().localize,_=Object(A.useGARecorder)(),E=l.useContext(o.Device).viewportCategory,g=Object(b.useIntlFormatter)(),v="MOBILE"===E;return l.createElement("div",tt()({className:f()("_1M0GpbBt",n.available?"_3Bq2Jny0":"XMAsgLD1",(a={},p()(a,"_5z6NvLJK",s&&r),p()(a,"_3RoeuaTO",!v),a)),onClick:function e(){n.available&&d({type:"SELECT_TOUR_GRADE",selectedTourGrade:n}),_(function e(t){return{module:"AttractionProductDetail",action:"click_options_select_option",context:t}}(""))}},c?{ref:c}:null),l.createElement("div",{className:"_24M6d01S"},l.createElement("div",{className:"_13UB8WZM",dangerouslySetInnerHTML:{__html:"".concat(n.available?"":"".concat(m.string("exp_tour_unavailable")," - ")).concat(Object(i.getFormattedGradeTitle)(n,g,m))}}),n.descriptionText&&l.createElement(nt,{text:l.createElement("span",{dangerouslySetInnerHTML:{__html:n.descriptionText.text}}),showOneLineOnly:u,onReadMoreClick:function e(){d({type:"EXPAND"})}})),n.available&&l.createElement("div",{className:"_1iMzEWjK"},l.createElement("div",{className:"_2RP2Lwto"},l.createElement(T.a,{id:"exp_tour_planner_total_price"})," "),l.createElement("div",{className:"_17xZSTIo"},g.formatCurrency(n.totalPrice)),Object(C.featureIsEnabled)("attractions_apd_show_unit_pricing_for_tour_grade")&&n.maxTravelersPerUnit&&n.maxTravelersPerUnit>0?l.createElement(H,{groupSize:n.maxTravelersPerUnit}):l.createElement(ct,{lineItems:n.lineItems})),l.createElement(rt,{selected:r,available:n.available}))},it=function e(t){var a,n=t.children,c=l.useContext(R),i=function e(){var t=l.useState(null),a=r()(t,2),n=a[0],c=a[1],o=l.useState(null),i=r()(o,2),s=i[0],u=i[1];return l.useEffect(function(){s&&n&&n.scroll({top:s.offsetTop-100,behavior:"smooth"})},[s,n]),[c,u]}(),s=r()(i,2),u=s[0],d=s[1],m=l.useContext(o.Device).viewportCategory,_=null===(a=c.result)||void 0===a?void 0:a.allTourGrades,E=w();return l.createElement("div",{className:f()("_3E2lGZIg",p()({},"_25_JSopX","MOBILE"===m&&c.isExpanded)),ref:"MOBILE"!==m?u:null},n||null,"ERROR"===c.planningStep&&l.createElement($e,null),"ERROR"!==c.planningStep&&(_&&"CHECK_TOUR_GRADES"!==c.planningStep?_.filter(function(e){var t;return c.isExpanded&&"CHECKOUT"!==c.planningStep||e.tourGradeCode===(null===(t=c.selectedTourGrade)||void 0===t?void 0:t.tourGradeCode)}).map(function(e){var t,a,n=null;return(null===(t=c.selectedTourGrade)||void 0===t?void 0:t.tourGradeCode)===e.tourGradeCode&&(n=d),l.createElement(ot,{tourGrade:e,selected:(null===(a=c.selectedTourGrade)||void 0===a?void 0:a.tourGradeCode)===e.tourGradeCode,tourGradeRef:n,key:e.tourGradeCode,showSelectedBG:c.isExpanded&&_.length>1,showOneLineOnly:!c.isExpanded&&"TABLET"===m})}):l.createElement("div",{className:"_5h6kv9Xt"},l.createElement(Q.LoadingSpinner,null))),"ERROR"!==c.planningStep&&E&&l.createElement(Ze,null))},st=function e(){var t=l.useContext(P).tourPlannerModel,a=l.useContext(R),n=a.selectedDate,r=a.priceCalendar,c=a.isExpanded,o=l.useContext(y).dispatch,i=l.useCallback(function(){o({type:"COLLAPSE"})},[o]),s=G(r,o,Object($.getDecodedValue)((null==t?void 0:t.productCode)||{})),u=l.useCallback(function(e){return Object(S.isDateBlockedFromPriceCalendarMap)(e,r)},[r]);if(!t||!c)return null;var d=new Date;return l.createElement(l.Fragment,null,l.createElement("div",{className:"_2uLtnT2w"},l.createElement(K,null)),l.createElement("span",{className:"_1rn1eZ4c",onClick:i},l.createElement(ce.a,{name:"times"})),l.createElement(it,null,l.createElement(ge,{inModal:!0}),l.createElement("div",{"data-testid":"tour_planner_calendar",className:"_37pSjHr3"},l.createElement(Ue.MobileFlexibleDayPickerWrapper,{disabledDays:u,fromMonth:d,onDayClick:s,initialMonth:n||d,modifiers:{selected:n||d}})),l.createElement(ie,{paxButton:l.createElement(ue,null),dateButton:null,languageFilterButton:null,optionsButton:null})))},ut=a("@ta/platform.import").component.onUsage(((Je=function e(){return a.e("@ta/attractions.datepicker")}).__PACKAGE__="@ta/attractions.tour-planner-lithium",Je.__MODULE_ID__="@ta/attractions.datepicker",Je.__MODULE_NAME__="@ta/attractions.datepicker",Je.__BUNDLE_NAME__="@ta/attractions.datepicker",Je.__GET_SYNC__=function(){return a.m["@ta/attractions.datepicker"]?a("@ta/attractions.datepicker"):null},Je.__IS_LOADED__=function(){return void 0!==a.m["@ta/attractions.datepicker"]},Je),"DayPickerWrapper",l.createElement("div",{className:"_2t2cJ4uf"})),dt=function e(t){var a=t.children,n=t.paddingTop;return l.createElement("div",{className:f()("_1G5zNtV4",p()({},"_2HhAclOC",n))},a)},mt=function e(){var t=l.useContext(P).tourPlannerModel,a=l.useContext(R),n=l.useContext(y).dispatch,r=l.useContext(o.Device).viewportCategory,c="MOBILE"===r,i=G(a.priceCalendar,n,Object($.getDecodedValue)((null==t?void 0:t.productCode)||{})),s=w(),u=a.selectedDate;if(!a.isExpanded&&"RESULTS"!==a.planningStep&&"ADD_TO_CART"!==a.planningStep&&"ERROR"!==a.planningStep)return"DESKTOP"===r&&l.createElement(dt,null);if(!t)return null;var d=new Date;switch(a.planningStep){case"CHECK_TOUR_GRADES":case"ADD_TO_CART":case"VIEW_CART":return l.createElement("div",{className:"K_7ntlSh"},l.createElement(Q.LoadingSpinner,null));case"DATE":return a.priceCalendar?l.createElement("div",{"data-testid":"tour_planner_calendar",className:"_1CjRJMeJ"},l.createElement(ut,{numberOfMonths:2,disabledDays:function e(t){return Object(S.isDateBlockedFromPriceCalendarMap)(t,a.priceCalendar)},fromMonth:d,onDayClick:function e(t){return i(t)},initialMonth:u||d,modifiers:{selected:u||d}})):l.createElement("div",{className:"K_7ntlSh"},l.createElement(Q.LoadingSpinner,null));case"PAX":return l.createElement(dt,{paddingTop:c},l.createElement(re,null));case"CHECKOUT":case"RESULTS":return s?l.createElement(Ze,{padding:!1}):l.createElement(it,null);case"ERROR":return l.createElement(dt,null,l.createElement($e,null));default:return null}},_t=function e(){var t,a,n="MOBILE"===l.useContext(o.Device).viewportCategory,r=l.useContext(R),c=r.planningStep,i=r.isExpanded,s=l.useContext(P).tourPlannerModel,u=s&&s.isInactive||!1,d=w(),m=!n&&i&&s&&"RESULTS"===c&&!d;return l.createElement("div",{"data-testid":"desktop_tour_planner",className:f()("B_1sSdF-",p()({},"_1OoGKZTC",Object(C.featureIsEnabled)("cx_brand_refresh_degreen")))},(!n||!i)&&l.createElement("div",{className:f()("_12lEKbkD",(t={},p()(t,"Ga36r0Iq",m),p()(t,"_2q-B_cMv",i&&n),t))},l.createElement(ve,null)),!u&&(n?l.createElement(st,null):l.createElement("div",{className:"_1ti0Kbwk"},l.createElement(mt,null))),l.createElement("div",{className:f()("_12lEKbkD",(a={},p()(a,"Ga36r0Iq",m),p()(a,"_2q-B_cMv",i&&n),a))},l.createElement(He,null)))},Et=function e(){return l.createElement(l.Fragment,null,l.createElement(ve,{inline:!0}),l.createElement(He,{inline:!0}))},pt=function e(){var t=l.useContext(R).isExpanded,a=m()({in:t,timeout:300});Object(_.useBlockScroll)(t);var n="enter"===a||"entering"===a||"exiting"===a||"exited"===a,r={bottom:"0",left:"0",right:"0",transform:n?"translate3d(0, 100%, 0)":"translate3d(0, 0, 0)",height:n?"100vh":"unset",top:n?"unset":"0"};return l.createElement(l.Fragment,null,l.createElement("div",{style:r,className:"_3jQ1bDJw"},l.createElement(_t,null)),l.createElement(Et,null))},gt=function e(t){var a,n=l.useContext(R).isExpanded,r=m()({in:n,timeout:200});return l.createElement("div",{className:"_1Rzyon2l"},"exited"!==r&&l.createElement("div",{key:"backdrop-".concat(n?"enabled":"disabled"),className:f()("_1-hqTAYH",(a={},p()(a,"_1fDk-UcG","enter"===r),p()(a,"r1qW5ygJ","entering"===r),p()(a,"_1-6AQvC-","exit"===r),p()(a,"_2wyucSxM","exiting"===r),a)),onClick:t.onBackdropClick}))};function ft(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ct(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ft(a,!0).forEach(function(t){p()(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ft(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var vt=function e(t,a){switch(a.type){case"RESET":return Ct({},t,{tourPlannerModel:a.tourPlannerModel,selectedAgeBands:a.selectedAgeBands,travelerCount:a.travelerCount,selectedLanguageFilters:a.selectedLanguageFilters});case"UPDATE_DATE":return Ct({},t,{selectedDate:a.selectedDate,daysFromOriginalDate:a.daysFromOriginalDate});case"UPDATE_DATE_AND_ADVANCE":return Ct({},t,{planningStep:"PAX",selectedDate:a.selectedDate});case"COLLAPSE":return Ct({},t,{isExpanded:!1});case"EXPAND":return Ct({},t,{isExpanded:!0,hasExpandedTray:!0});case"SET_STEP_DATE":return Ct({},t,{isExpanded:!0,hasExpandedTray:!0,planningStep:"DATE",headerErrorMessage:a.headerErrorMessage});case"SET_PRICE_CALENDAR":return Ct({},t,{planningStep:a.priceCalendar.size&&t.checkAvailabilityAfterFetchingDates?"CHECK_TOUR_GRADES":"DATE",priceCalendar:a.priceCalendar},a.selectedDate?{selectedDate:a.selectedDate}:null,{},a.priceCalendar.size?null:{isExpanded:!1});case"SET_STEP_PAX":return Ct({},t,{isExpanded:!0,hasExpandedTray:!0,planningStep:"PAX",headerErrorMessage:a.headerErrorMessage});case"CHECK_AVAILABILITY":return Ct({},t,{planningStep:"CHECK_TOUR_GRADES",isExpanded:!0},a.selectedDate?{selectedDate:a.selectedDate}:null,{hasExpandedTray:!0,headerErrorMessage:null,checkAvailabilityAfterFetchingDates:!t.priceCalendar,availableDatesResult:null,originalSelectedDate:null});case"SHOW_RESULTS":var n,l,c=null;if((null===(n=a.result)||void 0===n?void 0:null===(l=n.availableTourGrades)||void 0===l?void 0:l.length)>0){var o=a.result.availableTourGrades.filter(function(e){var a;return e.tourGradeCode===(null===(a=t.selectedTourGrade)||void 0===a?void 0:a.tourGradeCode)});o.length>0&&(c=r()(o,1)[0]),null===c&&(c=r()(a.result.availableTourGrades,1)[0])}return Ct({},t,{isExpanded:!0,planningStep:"RESULTS",hasMadeFirstCheck:!0,result:a.result,selectedTourGrade:c,headerErrorMessage:null,availableDatesResult:a.availableDatesResult,originalSelectedDate:a.originalSelectedDate});case"SELECT_TOUR_GRADE":return Ct({},t,{isExpanded:!0,selectedTourGrade:a.selectedTourGrade});case"ADD_TO_CART":return Ct({},t,{planningStep:"ADD_TO_CART",isRNPL:!1});case"RESERVE_TO_CART":return Ct({},t,{planningStep:"ADD_TO_CART",isRNPL:!0});case"PROMPT_FOR_CHECKOUT":return Ct({},t,{isExpanded:!1,planningStep:"CHECKOUT",cartItemsCount:a.cart&&a.cart.summary&&a.cart.summary.itemCount||0});case"SHOW_ERROR":return Ct({},t,{planningStep:"ERROR",mainError:a.mainError});case"CHANGE_AGE_BAND_SELECTION":return Ct({},t,{selectedAgeBands:a.selectedAgeBands,travelerCount:a.travelerCount,hasChangedPax:!0});case"VIEW_CART":return Ct({},t,{planningStep:"VIEW_CART"});case"CHANGE_LANGUAGE_FILTER":return Ct({},t,{selectedLanguageFilters:a.selectedLanguageFilters});default:return t}},bt=a("@ta/events.window-scroll"),Tt=a.n(bt),At=a("@ta/attractions.scroll-util"),Dt=function e(){var t=l.useContext(R).isExpanded,a=l.useContext(y).dispatch,n=function e(t){var a=l.useContext(R).isExpanded,n=l.useRef(0),r=l.useRef(3e4),c=l.useRef(0);return[l.useCallback(function(e){e&&(a?t&&t(e):n.current=e.getBoundingClientRect().height,r.current=e.getBoundingClientRect().bottom+window.pageYOffset)},[a,t]),n,r,c]}(l.useCallback(function(e){Object(At.scrollToTopOf)(e,100,"smooth")},[])),c=r()(n,4),o=c[0],i=c[1],s=c[2],u=c[3];return l.createElement(l.Fragment,null,l.createElement("div",{className:f()("_17XtQSAa",p()({},"_3Y2NcKht",t)),ref:o},l.createElement(_t,null)),t&&i.current&&l.createElement("div",{style:{height:"".concat(i.current,"px")}}),l.createElement(Tt.a,{callback:function e(){var n=window.pageYOffset;t&&n>u.current&&s.current&&n>s.current&&a({type:"COLLAPSE"}),u.current=n},throttle:100}))},Ot=a("@ta/attractions.util-availability"),xt=function e(t){var a=t.tourPlannerModel,n=l.useContext(y).dispatch,r=Object(b.useLocalize)().localize,c=l.useContext(o.TravelInfo).attractions.singleDate,i=l.useMemo(function(){return Object($.getDecodedValue)(a.productCode)},[a.productCode]),s=Object(Ot.usePriceCalendar)(i),u=s.priceCalendar,d=s.fetching,m=s.error;return l.useEffect(function(){var e=Object(S.getPriceCalendarMap)(u);e?n({type:"SET_PRICE_CALENDAR",priceCalendar:e,selectedDate:Object(Ot.calculateDefaultDate)(c,e)}):!d&&m&&n({type:"SHOW_ERROR",mainError:new Error(r.string("t4b_ib_error_sorry"))})},[n,m,d,r,u]),null},ht=function e(){var t=l.useContext(P).tourPlannerModel;return null!=t&&l.createElement(xt,{tourPlannerModel:t})},Pt=a("@ta/platform.monikers"),Rt=function e(t){var a=t.productCode,n=t.travelDate,r=t.pax,c=l.useContext(y).dispatch,o=l.useContext(R),i=l.useContext(P),s=Object(A.useGARecorder)(),u=i.tourPlannerModel,d=F(),m=Object(Ot.useNearestAvailableDates)(a,n,r),_=m.availableDates,E=m.error;return l.useEffect(function(){if(_)if("COMPLETE"===_.status){var e=_.availableDates;if(e&&e.some(function(e){return e})){var t=e.filter(Boolean).map(S.getLocalDateFromString);u&&s(Z.a.availabilityCheckNoAvailability(function e(t,a){return"ProductCode:".concat(t,"|NumDatesShown:").concat(a)}(Object($.getDecodedValue)(u.productCode),e.length))),c({type:"SHOW_RESULTS",result:{availableTourGrades:[],allTourGrades:[]},availableDatesResult:t,originalSelectedDate:o.selectedDate})}else u&&s(Z.a.availabilityCheckNoAvailability(Object($.getDecodedValue)(u.productCode))),c({type:"SHOW_ERROR",mainError:new Error(d)})}else"ERROR"===_.status&&c({type:"SHOW_ERROR",mainError:new Error(d)});else E&&c({type:"SHOW_ERROR",mainError:new Error(d)})},[_,c,E,o.availableDatesResult,d,u,s,o.selectedDate]),null},yt=function e(t){var a=t.tourPlannerModel,n=t.selectedDate,c=t.selectedAgeBands,s=t.selectedLanguageFilters,u=l.useContext(y).dispatch,d=Object(A.useGARecorder)(),m=Object(b.useLocalize)().localize,_=Object(b.useIntlFormatter)(),E=l.useContext(o.Environment).locale,p=Object($.getDecodedValue)(a.productCode),g="MOBILE"===l.useContext(o.Device).viewportCategory,f=Object(Ot.useTourGradeSortByPopularity)(p).sortedTourGrades,v=l.useState(!1),T=r()(v,2),D=T[0],O=T[1],x=F(),h=l.useContext(o.TravelInfo).update.attractions.setSingleDate,P=Object(Ot.useDetailedPricingAndAvailability)(p,Object(Ot.getPaxFromAgeBands)(c),Object(S.getDateFormat)(n,"YYYY-MM-DD"),Object(i.getSelectedLanguagesFromMap)(s)),R=P.detailedPricingAndAvailability,k=P.error;l.useEffect(function(){if(R&&f)if("COMPLETE"===R.status){var e=R.response,t=e?e.tourGrades:[];if(t.filter(function(e){return e}).some(function(e){return e.available})){var n=[E.language],r=t.filter(function(e){return e});r.sort(function e(t,a){return function(e,n){var r=Object(i.applyLanguageFilter)(e,t),l=Object(i.applyLanguageFilter)(n,t);if(!r&&l)return 1;if(r&&!l)return-1;if(!e.available&&n.available)return 1;if(e.available&&!n.available)return-1;var c=Object(i.getTourGradeCodeWithoutTime)(e.tourGradeCode),o=Object(i.getTourGradeCodeWithoutTime)(n.tourGradeCode),s=a.indexOf(c),u=a.indexOf(o);return(s=s<0?a.length:s)-(u<0?a.length:u)}}(n,f));var l=r.filter(function(e){return e.available});u({type:"SHOW_RESULTS",result:{availableTourGrades:l,allTourGrades:r}}),d(Z.a.availabilityCheckSuccess(Object($.getDecodedValue)(a.productCode),M(c)))}else!function e(){return Object(C.featureIsEnabled)("attractions_apd_sold_out_nearest_available_date")}()||g?(u({type:"SHOW_ERROR",mainError:new Error(x)}),d(Z.a.availabilityCheckNoAvailability(Object($.getDecodedValue)(a.productCode)))):O(!0)}else"ERROR"===R.status&&u({type:"SHOW_ERROR",mainError:new Error(m.string("attractions.booking.errors.api_error"))});else k&&u({type:"SHOW_ERROR",mainError:new Error(m.string("attractions.booking.errors.api_error"))})},[u,m,_,d,c,n,a.productCode,R,k,s,f,E,g,x]),l.useEffect(function(){h(n)},[h,n]);var N=l.useMemo(function(){return{type:"CLICKOUT",payload:{attractionProductClickEventType:"checkAvailability",obfuscatedAttractionProductCode:a.productCode.encodedValue||"",attractionProductPrice:a.numericPrice||0}}},[a]),L=Object(Pt.usePixelCallback)(N);return l.useEffect(function(){L()},[L]),D?l.createElement(Rt,{productCode:p,travelDate:Object(S.getDateFormat)(n,"YYYY-MM-DD"),pax:Object(Ot.getPaxFromAgeBands)(c)}):null},kt=function e(){var t=l.useContext(P),a=l.useContext(R),n=l.useContext(y).dispatch,c=Object(b.useLocalize)().localize,o=Object(A.useGARecorder)(),s=t.tourPlannerModel,u=a.planningStep,d=a.selectedDate,m=a.selectedAgeBands,_=a.selectedLanguageFilters,E=l.useState(!1),p=r()(E,2),g=p[0],f=p[1];return l.useEffect(function(){if("CHECK_TOUR_GRADES"===u&&null!=d&&s){var e=s.ageBands;(function e(t,a,n,r,l){if(!t.doesNotRequireAdultForBooking&&!Object(i.validateAtLeastOneAdult)(a,n))return r({type:"SET_STEP_PAX",headerErrorMessage:l.string("attractions.booking.errors.no_travelers")}),!1;if(0===Object(i.getTotalPaxCount)(n))return r({type:"SET_STEP_PAX",headerErrorMessage:l.string("attractions.booking.select_travelers_to_see_availability")}),!1;if(t.doesNotRequireAdultForBooking&&!Object(i.validateNotOnlyInfants)(n))return r({type:"SET_STEP_PAX",headerErrorMessage:l.string("exp_booking_no_only_infants")}),!1;var c=Object(i.validateAgeBandRequirementsWithError)(a,n,l);return!c||(r({type:"SET_STEP_PAX",headerErrorMessage:c}),!1)})(s,e,m,n,c)&&(o(Z.a.availabilityCheck(Object($.getDecodedValue)(s.productCode),M(m))),f(!0))}"CHECK_TOUR_GRADES"!==u&&f(!1)},[c,o,s,u,d,m,n]),g&&s&&d?l.createElement(yt,{tourPlannerModel:s,selectedDate:d,selectedAgeBands:m,selectedLanguageFilters:_}):null},St=function e(t){var a=t.tourPlannerModel,n=t.selectedTourGrade,c=t.selectedDate,i=t.selectedAgeBands,s=t.selectedLanguageUrlParam,u=t.isRNPL,d=l.useContext(o.Route),m=r()(d,1)[0].params.geoId||0,_=l.useContext(y).dispatch,E=Object(A.useGARecorder)(),p=Object($.getDecodedValue)(a.productCode),g=Object(Ot.useAddToCartlessCart)(m,a.attractionId,p,n.tourGradeCode,Object(S.getDateFormat)(c,"YYYY-MM-DD"),i),f=g.status,C=g.error;return l.useEffect(function(){"SUCCESS"===f&&(E(Z.a.addToCartSuccess(p)),setTimeout(function(){window.location=u?function e(t){return"/ShoppingCartCheckout?isCartless=true&isRNPL=true".concat(t)}(s):function e(t){return"/ShoppingCartCheckout?isCartless=true".concat(t)}(s)},500)),C&&_({type:"SHOW_ERROR",mainError:new Error(C)})},[_,u,p,s,E,f,C]),null},Mt=function e(){var t=l.useContext(R),a=t.isRNPL,n=t.planningStep,r=t.selectedDate,c=t.selectedTourGrade,o=t.selectedAgeBands,s=t.selectedLanguageFilters,u=l.useContext(P).tourPlannerModel,d=Object(i.getSelectedLanguagesFromMap)(s),m=1===d.length?"&selectedLanguage=".concat(d[0]):"";return u&&c&&r&&"ADD_TO_CART"===n?l.createElement(St,{tourPlannerModel:u,selectedTourGrade:c,selectedDate:r,selectedAgeBands:o,selectedLanguageUrlParam:m,isRNPL:a}):null},Nt=a("react-dom"),Lt=a.n(Nt),jt=a("@ta/attractions.check-availability"),It=a.n(jt),Bt=function e(){var t=l.useState(null),a=r()(t,2),n=a[0],c=a[1],i="MOBILE"===l.useContext(o.Device).viewportCategory,s=l.useContext(P).tourPlannerModel,u=l.useContext(y).dispatch;l.useEffect(function(){c(document.getElementById("check-availability-block-portal-target"))},[]);var d=l.useCallback(function(){u({type:"CHECK_AVAILABILITY"})},[u]);return i&&n&&s?Lt.a.createPortal(l.createElement(It.a,{tourPlannerModel:s,onCTAClick:d}),n):null},Gt=function e(t){var a,n,u="MOBILE"===c.a.useContext(o.Device).viewportCategory,d=Object(i.getDefaultAgeBands)(null===(a=t.tourPlannerModel)||void 0===a?void 0:a.ageBands),m=Object(i.getTotalPaxCount)(d),_=c.a.useContext(o.Route),E=r()(_,1)[0],p=c.a.useMemo(function(){return E.params.filterLang||""},[E.params]).split(","),g=Object(i.getDefaultLanguageFilters)(null===(n=t.tourPlannerModel)||void 0===n?void 0:n.productLanguages,p);Object(s.useProminentTelesalesTracking)();var f={isExpanded:!1,planningStep:"DATE",isRNPL:!1,selectedDate:null,selectedAgeBands:d,travelerCount:m,selectedLanguageFilters:g,cartItemsCount:0,selectedTourGrade:null,result:null,hasMadeFirstCheck:!1,hasExpandedTray:!1,hasChangedPax:!1,priceCalendar:null,tourPlannerModel:t.tourPlannerModel,mainError:null,headerErrorMessage:null,checkAvailabilityAfterFetchingDates:!1},C=Object(l.useReducer)(vt,f),v=r()(C,2),b=v[0],T=v[1];Object(l.useEffect)(function(){var e=t.tourPlannerModel;if(e&&e!==b.tourPlannerModel){var a=Object(i.getDefaultAgeBands)(null==e?void 0:e.ageBands),n=Object(i.getDefaultLanguageFilters)(e.productLanguages,p);T({type:"RESET",tourPlannerModel:e,selectedAgeBands:a,travelerCount:Object(i.getTotalPaxCount)(a),selectedLanguageFilters:n})}});var A=c.a.useCallback(function(){T({type:"EXPAND"})},[]),D=t.setCheckAvailabilityCallback;return Object(l.useEffect)(function(){return D&&D(function(){return A}),function(){D&&D(function(){return null})}},[D,A]),c.a.createElement(k,{props:t,state:b,dispatch:T},u?c.a.createElement(pt,null):c.a.createElement(c.a.Fragment,null,c.a.createElement(gt,{onBackdropClick:function e(){return T({type:"COLLAPSE"})}}),c.a.createElement(Dt,null)),c.a.createElement(ht,null),c.a.createElement(kt,null),c.a.createElement(Mt,null),c.a.createElement(Bt,null))};a.d(t,"default",function(){return Gt})}}});
//# sourceMappingURL=attractions.tour-planner-lithium.2a2836b2c5.js.map