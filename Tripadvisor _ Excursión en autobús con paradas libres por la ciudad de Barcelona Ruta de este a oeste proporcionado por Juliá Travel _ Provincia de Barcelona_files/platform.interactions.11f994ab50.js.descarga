($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/platform.interactions",se:!0,d:["vendor-babel","vendor-react-libs","vendor-common","lithium-platform","vendor-urql"],e:["./packages/platform/interactions/interactions.jsx"],m:{"./packages/platform/interactions/interactions.jsx":function(e,t,n){"use strict";n.r(t);var i=n("@babel/runtime/helpers/esm/slicedToArray"),r=n.n(i),a=n("react"),o=n("fast-deep-equal"),c=n.n(o),u=n("@ta/lithium.context"),l=n("@babel/runtime/helpers/esm/defineProperty"),s=n.n(l),d=n("urql"),f=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"LogInteractions"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"interactions"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Impressions_InteractionInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"Impressions_postInteractions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"interactions"}}}],"directives":[]}]}}],"loc":{"start":0,"end":140}}');f.__key=0xfddc3e66a204,f.loc.source={body:"fddc3e66a204"};var m=f;function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}var p=!1,g=function e(t){var n=function e(){try{return JSON.parse(localStorage.getItem("interaction_mutation_buffer")||"[]")}catch(e){}return[]}();n.length>0&&!p?(p=!0,t({interactions:n}).then(function(){!function e(t){try{var n=JSON.parse(localStorage.getItem("interaction_mutation_buffer")||"[]");localStorage.setItem("interaction_mutation_buffer",JSON.stringify(n.filter(function(e){return t.every(function(t){return!c()(e,t)})})))}catch(e){}}(n)}).finally(function(){p=!1})):n.length>0&&p&&setTimeout(function(){return e(t)},1e3)},b=function e(){var t=Object(d.useMutation)(m),n=r()(t,2)[1],i=a.useContext(u.Route),o=r()(i,2)[1].uid;return a.useCallback(function(e){(function e(t){try{var n=JSON.parse(localStorage.getItem("interaction_mutation_buffer")||"[]");n.push(t),localStorage.setItem("interaction_mutation_buffer",JSON.stringify(n))}catch(e){}})(function t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach(function(t){s()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({pageUid:o,eventTimestampMs:(new Date).getTime()},e)),setTimeout(function(){return g(n)},1e3)},[n,o])},k=function e(){var t=Object(d.useMutation)(m),n=r()(t,2)[1];a.useEffect(function(){requestIdleCallback(function(){g(n)})},[n])},y=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"LogInteractionV4"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"interaction"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"InteractionV4Input"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"logInteractionV4"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"interaction"},"value":{"kind":"Variable","name":{"kind":"Name","value":"interaction"}}}],"directives":[]}]}}],"loc":{"start":0,"end":119}}');y.__key=0x790de86432c2,y.loc.source={body:"790de86432c2"};var h=y;n.d(t,"useGARecordCallback",function(){return x}),n.d(t,"useGARecorder",function(){return D}),n.d(t,"enqueue",function(){return T}),n.d(t,"useInteractionLogger",function(){return b}),n.d(t,"useSubmitInteractionBufferEffect",function(){return k}),n.d(t,"LogInteractionV4",function(){return h});var S=function e(t){if(0===t.length)return Promise.resolve();var n=new URLSearchParams("?batched=true");return t.forEach(function(e,t){e.forEach(function(e,i){void 0!==e&&n.append("data[".concat(t,"][").concat(i,"]"),e)})}),fetch("/GARecord",{method:"POST",body:n.toString(),credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"}}).catch(function(e){console.error(e)})},I=function e(t){var n=new URLSearchParams;return Object.entries(t).forEach(function(e){var t=r()(e,2),i=t[0],a=t[1];"eventId"!==i&&n.append(i,a)}),n},O=!1,N=function e(){if(O)w();else{O=!0;try{var t=localStorage.getItem("interaction_buffer"),n=t?JSON.parse(t):[];S(n.map(I)).then(function(){var e=localStorage.getItem("interaction_buffer"),t=e?JSON.parse(e):[];localStorage.setItem("interaction_buffer",JSON.stringify(t.filter(function(e){return n.every(function(t){return!c()(t,e)})})))}).finally(function(){O=!1})}catch(e){O=!1}}},_=null,w=function e(){null!==_&&clearTimeout(_),_=setTimeout(N,1e3)},P=function e(t){try{var n=localStorage.getItem("interaction_buffer"),i=n?JSON.parse(n):[];i.push(t),localStorage.setItem("interaction_buffer",JSON.stringify(i))}catch(e){return!1}return w(),!0},T=function e(t){var n={eventId:Math.random().toString()};t.forEach(function(e,t){n[t]=e}),P(n)||S([t])},j=function e(t){try{var n;return(null===(n=t.match(/^\/([a-zA-Z0-9_]+)/))||void 0===n?void 0:n[1])||"Home"}catch(e){return"Unknown"}},D=function e(){var t=a.useContext(u.Route),n=r()(t,2),i=n[0],o=i.page,c=i.params,l=n[1].uid,s=a.useContext(u.Visitor).userId;return a.useCallback(function(e){var t="Unknown"===o?function e(t){try{var n,i;return(null===(n=t.match(/-d([0-9]+)/))||void 0===n?void 0:n[1])||(null===(i=t.match(/-g([0-9]+)/))||void 0===i?void 0:i[1])||void 0}catch(e){return}}(window.location.pathname):c.detailId||c.geoId||void 0,n={gac:e.module,gaa:e.action,gal:e.context,gav:e.value,gani:e.nonInteraction,gasl:null!=e.location?e.location:t,gass:"Unknown"===o?j(window.location.pathname):o,gapu:l,gams:null!==s,eventId:Math.random().toString()};P(n)||S([I(n)])},[o,c,l,s])},x=function e(t){var n=D(),i=t||{},r=i.module,o=i.action,c=i.context,u=i.value,l=i.location,s=i.nonInteraction;return a.useCallback(function(){r&&o&&n({module:r,action:o,context:c,value:u,location:l,nonInteraction:s})},[n,r,o,c,u,l,s])};"undefined"!=typeof requestIdleCallback&&requestIdleCallback(w)}}});
//# sourceMappingURL=platform.interactions.11f994ab50.js.map