($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/login.auth-gate-lithium",d:["vendor-babel","vendor-react-libs","lithium-platform","@ta/platform.interactions","@ta/modal.styleguide","lithium-common","@ta/events.window"],e:["./packages/login/auth-gate-lithium/useAuthGated.jsx"],m:{"./packages/login/auth-gate-lithium/useAuthGated.jsx":function(e,t,r){"use strict";r.r(t);var o=r("@babel/runtime/helpers/esm/slicedToArray"),n=r.n(o),a=r("react"),i=r("@ta/lithium.portals"),l=r("@ta/platform.interactions"),s=r("@ta/lithium.context"),c=r("@ta/modal.styleguide"),u=r.n(c),d=r("@ta/styleguide.loading"),f=r("@babel/runtime/helpers/esm/defineProperty"),p=r.n(f),m=r("@ta/events.window"),h=r("@babel/runtime/helpers/esm/typeof"),g=r.n(h);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}var y=function e(t,r){var o=t.options,i=t.onReady,l=t.onShowOverlay,c=r.isFullWidthMobile,u=a.useState(),d=n()(u,2),f=d[0],h=d[1],y=a.useState(),O=n()(y,2),v=O[0],w=O[1],C=a.useState(!1),S=n()(C,2),k=S[0],P=S[1],j=o.onSuccess,x=a.useCallback(function(e){var t=e.resultData||"";if(t){var r=function e(t){var r={};try{r=JSON.parse(t)}catch(e){return console.error("Error parsing controller result data: ".concat(t)),null}return"object"!==g()(r)?(console.error("Parsed controller result is not an object."),null):{userId:r.user_id,hasCreatedMember:!!r.hasCreatedMember,hasAcceptedTermsOfUse:!!r.hasAcceptedTermsOfUse}}(t);null==r||r.hasCreatedMember,j&&j(r)}else j&&j(null);e.jsCallback&&function e(t){t&&console.error("Non-empty JSCallback is returned from RegController: ".concat(t))}(e.jsCallback)},[j]),I=a.useContext(s.Device).viewportCategory,E=a.useCallback(function(e){e>100&&h("MOBILE"===I&&c?"100%":e)},[I,c]),M=o.displayOnShowOverlay,R=o.onClose,N=a.useCallback(function(e){var t=e,r=function e(t){if(!t)return null;if(!t.origin||0!==t.origin.indexOf("https")||t.origin!==document.location.origin)return null;if(!t.data||!t.data.indexOf||-1===t.data.indexOf("action"))return null;try{var r=JSON.parse(t.data);return r.action?r:null}catch(e){return null}}(t);if(function e(t){t&&t.origin&&0===t.origin.indexOf("https://smartlock.google.com")&&t.data&&t.data.type&&t.source&&t.source.postMessage({type:"verifyAck",data:t.data.data},"https://smartlock.google.com")}(t),r)switch(r.action){case"successClose":x(r);break;case"reloadWindow":console.error("Unexpected reload window message is received from RegController iframe");break;case"fwdToRelativeUrl":var o=r.url||"";o||console.error("No url specified to forward to."),0!==o.indexOf("/")&&console.error("Cannot forward to absolute url: ".concat(o)),window.location=o;break;case"resizeFrame":E(r.width),r.height>100&&w(r.height);break;case"domReady":P(!0),i&&i();break;case"dismiss":R&&R();break;case"showOverlay":M&&l&&l()}},[x,M,l,R,i,E]);Object(m.useWindow)("message",N);var D=a.useMemo(function(){var e=new URLSearchParams(function t(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(r,!0).forEach(function(t){p()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({flow:o.flow,flowOrigin:o.flowOrigin,pid:"".concat(o.pid),hideNavigation:"true",userRequestedForce:"true",returnTo:""},o.extraQueryParams||{}));return o.mcid&&e.append("mcid","".concat(o.mcid)),o.locationId&&e.append("locationId","".concat(o.locationId)),o.stateToken&&e.append("stateToken",o.stateToken),void 0!==o.requireSecure&&e.append("requireSecure","".concat(String(!!o.requireSecure))),"/RegistrationController?".concat(e.toString())},[o.extraQueryParams,o.flow,o.flowOrigin,o.locationId,o.mcid,o.pid,o.requireSecure,o.stateToken]);return a.createElement("div",{className:"_8RLaCUf_",style:{width:f,height:v}},a.createElement("iframe",{className:"_30pzQStV",src:D,title:"regcontroller",style:{width:f,height:v,display:k?"block":"none"},scrolling:"no"}))},O=function e(t){var r=t.options,o=t.closeX,i=a.useState(!1),l=n()(i,2),s=l[0],c=l[1],f=a.useCallback(function(){r.displayOnShowOverlay||c(!0)},[r.displayOnShowOverlay]),p=a.useCallback(function(){c(!0)},[]),m=a.useMemo(function(){return a.createElement(y,{options:r,onReady:f,onShowOverlay:p})},[f,r,p]);return a.createElement(u.a,{onClose:r.onClose,containerProps:{backgroundColor:"transparent",disableBodyScroll:!0},bodyProps:{isFullBleed:!0},enableCloseIcon:s&&o},a.createElement("div",{style:{display:s?"block":"none"}},m),!s&&a.createElement("div",{className:"nUBQ6pZw"},a.createElement(d.LoadingSpinner,{size:"large",inverted:!0})))};t.default=function e(){var t=a.useContext(s.Visitor).userId,r=a.useContext(s.Route),o=n()(r,1)[0],c=a.useContext(s.Authenticate),u=o.params.geoId||void 0,d=a.useState({flow:"CORE_COMBINED",flowOrigin:"join",pid:-1,isFullWidthMobile:!0}),f=n()(d,2),p=f[0],m=f[1],h=a.useState({closeX:!0}),g=n()(h,2),b=g[0],y=g[1],v=Object(l.useGARecorder)(),w=a.useRef(void 0),C=Object(i.useVDOMPortal)(function(){return a.createElement(O,{options:p,closeX:b.closeX})},{},[p,b]);return a.useCallback(function(e){return t&&!e.forceLogin?Promise.resolve({userId:t,hasCreatedMember:null}):w.current?w.current:(w.current=new Promise(function(t){m({flow:e.flow||"CORE_COMBINED",flowOrigin:e.flowOrigin||"join",pid:e.pid||-1,extraQueryParams:e.extraQueryParams||{},displayOnShowOverlay:e.deferShowOverlay,locationId:u||-1,onSuccess:function r(o){var n={userId:(null==o?void 0:o.userId)||null,hasCreatedMember:!!(null==o?void 0:o.hasCreatedMember)};e.onSuccess&&e.onSuccess(n),C.close(),w.current=null,c({userId:n.userId}),t(n)},onClose:function t(){v({module:"regoverlay",action:"closed",context:[u||"",e.flow].join("|"),value:e.pid||void 0,nonInteraction:!1}),C.close(),w.current=null,e.onClose&&e.onClose()}}),y({closeX:!1!==e.closeX}),C.open()}),w.current)},[t,o.path,u,C,c,v])}}}});
//# sourceMappingURL=login.auth-gate-lithium.1cb42065af.js.map