($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/platform.rum",d:["vendor-babel","vendor-react-libs","lithium-platform"],e:["./packages/platform/rum/rum.jsx"],m:{"./packages/platform/rum/rum.jsx":function(e,t,n){"use strict";n.r(t);var r=n("@babel/runtime/helpers/esm/slicedToArray"),i=n.n(r),a=n("@babel/runtime/helpers/esm/toConsumableArray"),s=n.n(a),c=n("react"),u=n.n(c),o=n("@ta/platform.tti"),d=n("@ta/lithium.context"),f=n("@babel/runtime/helpers/esm/assertThisInitialized"),l=n.n(f),h=n("@babel/runtime/helpers/esm/typeof"),m=n.n(h),p=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),v=n.n(p),g=n("@babel/runtime/helpers/esm/getPrototypeOf"),y=n.n(g),b=n("@babel/runtime/helpers/esm/inherits"),w=n.n(b),_=n("@babel/runtime/helpers/esm/createClass"),E=n.n(_),k=n("@babel/runtime/helpers/esm/classCallCheck"),T=n.n(k),S=function e(t){T()(this,e),this.type=t},C=function(){function e(){T()(this,e),this._registry={}}return E()(e,[{key:"addEventListener",value:function e(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2],this._getRegistry(t).push(n)}},{key:"removeEventListener",value:function e(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r=this._getRegistry(t),i=r.indexOf(n);i>-1&&r.splice(i,1)}},{key:"dispatchEvent",value:function e(t){return t.target=this,Object.freeze(t),this._getRegistry(t.type).forEach(function(e){return e(t)}),!0}},{key:"_getRegistry",value:function e(t){return this._registry[t]=this._registry[t]||[]}}]),e}(),j=function(e){function t(e,n){var r;return T()(this,t),(r=v()(this,y()(t).call(this,e))).newState=n.newState,r.oldState=n.oldState,r.originalEvent=n.originalEvent,r}return w()(t,e),t}(S),O="active",z="passive",I="hidden",W="frozen",L="terminated",N="object"===("undefined"==typeof safari?"undefined":m()(safari))&&safari.pushNotification,B=["focus","blur","visibilitychange","freeze","resume","pageshow","undefined"!=typeof self&&"onpageshow"in self?"pagehide":"unload"],q=function e(t){return t.preventDefault(),t.returnValue="Are you sure?"},x=[[O,z,I,L],[O,z,I,W],[I,z,O],[W,I],[W,O],[W,z]].map(function e(t){return t.reduce(function(e,t,n){return e[t]=n,e},{})}),M=function e(){return"undefined"==typeof document?I:document.visibilityState===I?I:document.hasFocus()?O:z},P=new(function(e){function t(){var e;T()(this,t),e=v()(this,y()(t).call(this));var n=M();return e._state=n,e._unsavedChanges=[],e._handleEvents=e._handleEvents.bind(l()(e)),"undefined"!=typeof addEventListener&&(B.forEach(function(t){return addEventListener(t,e._handleEvents,!0)}),N&&addEventListener("beforeunload",function(t){e._safariBeforeUnloadTimeout=setTimeout(function(){t.defaultPrevented||t.returnValue.length>0||e._dispatchChangesIfNeeded(t,I)},0)})),e}return w()(t,e),E()(t,[{key:"addUnsavedChanges",value:function e(t){!this._unsavedChanges.indexOf(t)>-1&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",q),this._unsavedChanges.push(t))}},{key:"removeUnsavedChanges",value:function e(t){var n=this._unsavedChanges.indexOf(t);n>-1&&(this._unsavedChanges.splice(n,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",q))}},{key:"_dispatchChangesIfNeeded",value:function e(t,n){if(n!==this._state)for(var r=function e(t,n){for(var r,i=0;r=x[i];++i){var a=r[t],s=r[n];if(a>=0&&s>=0&&s>a)return Object.keys(r).slice(a,s+1)}return[]}(this._state,n),i=0;i<r.length-1;++i){var a=r[i],s=r[i+1];this._state=s,this.dispatchEvent(new j("statechange",{oldState:a,newState:s,originalEvent:t}))}}},{key:"_handleEvents",value:function e(t){switch(N&&clearTimeout(this._safariBeforeUnloadTimeout),t.type){case"pageshow":case"resume":this._dispatchChangesIfNeeded(t,M());break;case"focus":this._dispatchChangesIfNeeded(t,O);break;case"blur":this._state===O&&this._dispatchChangesIfNeeded(t,M());break;case"pagehide":case"unload":this._dispatchChangesIfNeeded(t,t.persisted?W:L);break;case"visibilitychange":this._state!==W&&this._state!==L&&this._dispatchChangesIfNeeded(t,M());break;case"freeze":this._dispatchChangesIfNeeded(t,W)}}},{key:"state",get:function e(){return this._state}},{key:"pageWasDiscarded",get:function e(){return"undefined"!=typeof document&&document.wasDiscarded||!1}}]),t}(C));n.d(t,"useRUM",function(){return J});var R=function e(t,n){return Object.create(PerformanceEntry.prototype,{name:{value:t},entryType:{value:"mark"},startTime:{value:function(){if(void 0!==n.startTime){if(n.startTime<0)throw new TypeError("Invalid startTime");return n.startTime}return performance.now()}()},duration:{value:0},detail:{value:n.detail}})},A=new Set(["time-to-interactive","first-paint","first-contentful-paint","cpm-hero-latency","first-input-delay","load","time-to-first-byte","time-to-last-byte","request-start","fetch-start"]),U=function e(t,n,r){n in t?t[n]+=r:t[n]=r},D=function e(t,n){return t+n},V=new TextEncoder,$=/\.(jpg|webp)\?((w|h|s|q|f)=){1,}/,F=!1,J=function e(t,n){var r=Object(c.useContext)(d.Environment),a=r.domainName,u=r.locale,f=r.version,l=r.cdnPrefix,h=Object(c.useContext)(d.Visitor).userId,m=Object(c.useContext)(d.Device),p=m.viewportCategory,v=m.isWebview,g=Object(c.useRef)(!1),y=Object(c.useRef)(!0),b=Object(c.useRef)({checksum:[n,t].map(function(e){return Array.from(V.encode(e)).reduce(D,0)}).reduce(D,0),pageLoad:{uid:n,page:t,locale:u.code,revision:f,is_logged_in:null!==h,viewport_category:p,is_webview:v,user_agent:"unknown",connection_type:"unknown"},timings:[],metrics:{},navigations:[]});Object(c.useEffect)(function(){if("undefined"!=typeof PerformanceObserver){var e=new Set;b.current.metrics={},b.current.timings=[],b.current.navigations=[];var t,n,r=function t(n){n.filter(function(e){return"mark"!==e.entryType||A.has(e.name)}).filter(function(e){return"measure"!==e.entryType||!(e.name.startsWith("⚛")||e.name.startsWith("⛔"))}).filter(function(t){return!e.has(t)}).forEach(function(t){e.add(t),b.current.timings.push([t.name,t.entryType,Math.round(t.startTime),Math.round(t.duration)])})},c=[[["navigation"],function t(n){if(n.length>0){var i=n[n.length-1];if(e.has(i))return;e.add(i);try{r([R("fetch-start",{startTime:i.fetchStart}),R("request-start",{startTime:i.requestStart}),R("time-to-first-byte",{startTime:i.responseStart-i.requestStart}),R("time-to-last-byte",{startTime:i.responseEnd-i.requestStart})])}catch(e){console.error(e)}i.transferSize&&(b.current.metrics["document-transferred-bytes"]=i.transferSize),b.current.navigations.push({puid:b.current.pageLoad.uid,name:i.name,dns:Math.round(i.domainLookupEnd-i.domainLookupStart),ttfb:Math.round(i.responseStart-i.requestStart),download:Math.round(i.responseEnd-i.responseStart),size:i.transferSize||0})}},!1],[["resource"],function t(n){g.current||n.filter(function(e){return e.decodedBodySize>0}).filter(function(t){return!e.has(t)}).forEach(function(t){e.add(t),t.name.includes(l)&&t.name.endsWith(".js")?(U(b.current.metrics,"js-cdn-transferred-bytes",t.transferSize),U(b.current.metrics,"js-cdn-encoded-bytes",t.encodedBodySize),U(b.current.metrics,"js-cdn-decoded-bytes",t.decodedBodySize)):t.name.includes(l)&&t.name.endsWith(".css")?(U(b.current.metrics,"css-cdn-transferred-bytes",t.transferSize),U(b.current.metrics,"css-cdn-encoded-bytes",t.encodedBodySize),U(b.current.metrics,"css-cdn-decoded-bytes",t.decodedBodySize)):t.name.endsWith(".jpg")||t.name.endsWith(".jpeg")||t.name.endsWith(".ico")||t.name.endsWith(".gif")||t.name.endsWith(".png")||t.name.endsWith(".svg")||$.test(t.name)||t.name.endsWith(".ts")||t.name.endsWith(".m3u8")?(U(b.current.metrics,"media-transferred-bytes",t.transferSize),U(b.current.metrics,"media-request-count",1)):t.name.includes(a)&&t.name.includes("/data/")?(U(b.current.metrics,"data-transferred-bytes",t.transferSize),U(b.current.metrics,"data-request-count",1)):(U(b.current.metrics,"other-transferred-bytes",t.transferSize),U(b.current.metrics,"other-request-count",1))})},!1],[["mark","measure"],r,!1],[["paint"],function e(t){performance.getEntriesByName("hidden").length>0&&(y.current=!1),r(t)},!0],[["longtask"],function e(t){t.forEach(function(e){U(b.current.metrics,"total-blocking-time",e.duration-50),U(b.current.metrics,"long-task-count",1),b.current.timings.push([["task",e.name].concat(s()(e.attribution.map(function(e){return e.containerName||e.containerId||e.containerSrc}).filter(Boolean))).join(" > "),e.entryType,Math.round(e.startTime),Math.round(e.duration)])})},!1],[["largest-contentful-paint"],function e(t){if(t.length>0){var n=t[t.length-1];n.renderTime&&(b.current.metrics["largest-contentful-paint"]=n.startTime)}},!0],[["element"],function e(t){t.forEach(function(e){b.current.timings.push(["".concat(e.identifier," ").concat(e.name),"element",Math.round(e.startTime),0])})},!0],[["layout-shift"],function e(t){t.forEach(function(e){var t=e.hadRecentInput,n=e.value;t||U(b.current.metrics,"layout-shift-score",n)})},!0],[["first-input"],function e(t,n){if(t.length>0){var i=t[0],a=i.processingStart,s=i.startTime;b.current.metrics["first-input-delay"]=a-s;try{r([R("first-input-delay",{startTime:a-s})])}catch(e){console.error(e)}n&&n.disconnect()}},!0]].map(function(e){var t=i()(e,3),n=t[0],r=t[1],a=t[2],s=null,c=requestIdleCallback(function(){s=new PerformanceObserver(function(e,t){return r(e.getEntries(),t)});var e=!a;try{s.observe(1===n.length&&a?{type:n[0],buffered:a}:{entryTypes:n})}catch(t){e=!0;try{s.observe({entryTypes:n})}catch(t){e=!1}}e&&n.forEach(function(e){"longtask"===e&&window.__tti&&Array.isArray(window.__tti.e)?r(window.__tti.e):r(performance.getEntriesByType(e))})});return function(){cancelIdleCallback(c),null!==s&&s.disconnect()}});return Object(o.requestTTICallback)(function(e){null!=e&&(g.current=!0,performance.getEntriesByName("hidden").length>0&&(y.current=!1),b.current.metrics["time-to-interactive"]=e,r([R("time-to-interactive",{startTime:e})]))}),"undefined"==typeof PerformanceEventTiming&&(null===(t=window.perfMetrics)||void 0===t||null===(n=t.onFirstInputDelay)||void 0===n||n.call(t,function(e){b.current.metrics["first-input-delay"]=e,r([R("first-input-delay",{startTime:e})])})),function(){c.forEach(function(e){return e()})}}},[l,a]),Object(c.useEffect)(function(){try{window.self!==window.top&&(y.current=!1)}catch(e){}window.location.hostname!==a&&(y.current=!1),performance.getEntriesByName("hidden").length>0&&(y.current=!1)},[a]),Object(c.useEffect)(function(){var e,t,n;b.current.pageLoad.user_agent=(null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||"unknown",b.current.pageLoad.connection_type=(null===(t=window.navigator)||void 0===t?void 0:null===(n=t.connection)||void 0===n?void 0:n.effectiveType)||"unknown"},[]),Object(c.useEffect)(function(){if(!F){F=!0;var e=!1,t=function t(n){!e&&"hidden"===n.newState&&y.current&&(b.current.metrics["document-dwell-time"]=performance.now(),Object.entries(b.current.metrics).forEach(function(e){var t=i()(e,2),n=t[0],r=t[1];b.current.metrics[n]=function e(t){return Math.round(1e4*t)/1e4}(r)}),(e=navigator.sendBeacon("/data/1.0/rum",JSON.stringify(b.current)))&&P.removeEventListener("statechange",t))};return P.addEventListener("statechange",t),function(){F=!1,P.removeEventListener("statechange",t)}}},[])};t.default=u.a.memo(function e(t){var n=t.page,r=t.puid;return J(null!=n?n:"Unknown",r||""),null})}}});
//# sourceMappingURL=platform.rum.1f45f8a483.js.map