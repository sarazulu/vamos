($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/trips.saver",d:["vendor-babel","vendor-react-libs","@ta/trips.trip-types","@ta/trips.graphql","vendor-urql","@ta/trips.trip-util","@ta/platform.monikers","@ta/common.localstorage","lithium-platform"],e:["./packages/trips/saver/index.jsx"],m:{"./packages/trips/saver/index.jsx":function(e,r,t){"use strict";t.r(r);var i=t("@babel/runtime/helpers/esm/slicedToArray"),n=t.n(i),o=t("react"),u=(t("@ta/trips.trip-types"),t("@ta/trips.graphql")),l=t("urql"),a=t("@ta/trips.trip-util"),d=t("@ta/platform.monikers"),c=function e(r){var t=Object(l.useMutation)(u.AddItemToTrip),i=n()(t,2)[1],c=o.useState({fetching:!1}),s=n()(c,2),v=s[0],p=s[1],f=Object(d.usePixelCallback)("SAVE_TO_TRIP");if(!r)return[v,function(){return Promise.resolve([null,null])}];var T=r;return[v,function e(r){return p({fetching:!0}),i({tripId:r,referenceId:"".concat(T.id),referenceType:T.type,allowDuplicates:!1}).then(function(e){var r,t,i,n,o,u,l=null==e?void 0:null===(r=e.data)||void 0===r?void 0:null===(t=r.addItemToTrip)||void 0===t?void 0:t.trip,d=null==e?void 0:null===(i=e.data)||void 0===i?void 0:null===(n=i.addItemToTrip)||void 0===n?void 0:null===(o=n.errors)||void 0===o?void 0:null===(u=o[0])||void 0===u?void 0:u.error;if(l){var c=Object(a.getItemByReference)(l,T);c?(f(),p({fetching:!1,result:{trip:l,tripItem:c}})):"bundleSave"===T.type?p({fetching:!1,result:{trip:l,tripItem:{__typename:"TripItem",id:0,comments:[]}}}):p({fetching:!1,error:{query:"ADD_ITEM_TO_TRIP",tripsError:d}})}else p({fetching:!1,error:{query:"ADD_ITEM_TO_TRIP",tripsError:d}});return[l,d]}).catch(function(e){return console.error(e),p({fetching:!1,error:{query:"ADD_ITEM_TO_TRIP"}}),[null,null]})}]},s=t("@ta/common.localstorage"),v=t.n(s),p=t("@ta/lithium.context"),f=new Set(["savesItem","bundleSave"]),T=function e(r,t,i){var u=c(r),l=n()(u,2),a=l[0],d=l[1],s=Object(o.useContext)(p.Visitor).userId;return[a,Object(o.useCallback)(function(){var e=function e(r){var t=v.a.get("mostRecentlyAddedToTrip");return t&&t.userId===r?t.tripId:null}(s);return t||!e||f.has(null==r?void 0:r.type)?(i(),Promise.resolve([null,null])):d(e)},[t,r,i,d,s]),function(e){return function e(r,t){t&&v.a.set("mostRecentlyAddedToTrip",{tripId:r,userId:t},144e5)}(e,s)}]},m=t("@babel/runtime/helpers/esm/defineProperty"),I=t.n(m);function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function g(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(t,!0).forEach(function(r){I()(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var y=function e(r,t,i){var a=o.useState({fetching:!1,saved:!!i}),d=n()(a,2),c=d[0],s=d[1],v=Object(l.useMutation)(u.AddItemWithFullTrip),p=n()(v,2)[1],f=Object(l.useMutation)(u.RemoveItemWithFullTrip),T=n()(f,2)[1];return[c,i?function e(){return i?(s(g({},c,{fetching:!0})),T({itemId:i.id,tripId:t}).then(function(e){var r,t=null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.tripsRemoveItem;return t?(s({fetching:!1,saved:!1,result:{trip:t}}),c):(s({fetching:!1,saved:!0,error:{query:"REMOVE_TRIP_ITEM",tripsError:void 0}}),c)}).catch(function(){return s({fetching:!1,saved:!0,error:{query:"REMOVE_TRIP_ITEM"}}),c})):Promise.resolve(c)}:function e(){return s(g({},c,{fetching:!0})),p({tripId:t,referenceId:"".concat(r.id),referenceType:r.type,allowDuplicates:!1}).then(function(e){var r,t,i,n,o,u,l,a,d,v=null==e?void 0:null===(r=e.data)||void 0===r?void 0:null===(t=r.addItemToTrip)||void 0===t?void 0:t.trip,p=null==e?void 0:null===(i=e.data)||void 0===i?void 0:null===(n=i.addItemToTrip)||void 0===n?void 0:null===(o=n.errors)||void 0===o?void 0:null===(u=o[0])||void 0===u?void 0:u.error;if(p||!v)return s({fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP",tripsError:p||void 0}}),c;var f=null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(a=l.addItemToTrip)||void 0===a?void 0:null===(d=a.items)||void 0===d?void 0:d[0];return s(f?{fetching:!1,saved:!0,result:{trip:v,tripItem:f}}:{fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP"}}),c}).catch(function(){return s({fetching:!1,saved:!1,error:{query:"ADD_ITEM_TO_TRIP"}}),c})}]};t.d(r,"useSave",function(){return c}),t.d(r,"useAutosave",function(){return T}),t.d(r,"useTripSaveToggle",function(){return y})}}});
//# sourceMappingURL=trips.saver.4a746a3d72.js.map