($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/cpm.gpt-ad",d:["vendor-babel","vendor-react-libs","@ta/common.object-util","vendor-urql","@ta/common.features","@ta/cpm.gpt-slots-controller","@ta/cpm.rubicon-header-bidding","lithium-platform","@ta/events.window-visibility","@ta/cpm.consent-mgmt","lithium-common","@ta/cpm.utils"],e:["./packages/cpm/gpt-ad/gpt-ad.jsx"],m:{"./packages/cpm/gpt-ad/gpt-ad.jsx":function(e,t,n){"use strict";n.r(t);var i=n("@babel/runtime/helpers/esm/objectWithoutProperties"),a=n.n(i),r=n("@babel/runtime/helpers/esm/defineProperty"),o=n.n(r),l=n("react"),d=n.n(l),s=n("@ta/common.object-util"),c=n("@babel/runtime/helpers/esm/slicedToArray"),u=n.n(c),g=n("urql"),m=n("@ta/common.features"),p=n("@ta/cpm.gpt-slots-controller"),v=n("@ta/cpm.rubicon-header-bidding"),f=n("@ta/lithium.context"),b=n("@ta/platform.import"),k=n("@ta/events.window-visibility"),y=n.n(k),O=n("@ta/cpm.consent-mgmt"),N=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"GptInfoQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Long"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"pageType"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"gptInfo"},"name":{"kind":"Name","value":"AdContext_getPageAdsBatch"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"requests"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"locationId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"pageType"},"value":{"kind":"Variable","name":{"kind":"Name","value":"pageType"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"adBase"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"pageConfig"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"skyAdEnabled"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"ppid"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":234}}');N.__key=0x78216385ad96,N.loc.source={body:"78216385ad96"};var h=N,j=function e(t,n){var i="#tearsheet"===location.hash?"https://".concat(location.hostname):"https://tpc.googlesyndication.com";window.addEventListener("message",function(e){e.origin===i&&e.data&&e.data.cpmMessageType===t&&n(e.data)})},T=!1,S=0,w=function e(t,n,i,a){googletag.cmd.push(function(){!0===a&&(googletag.taIsRdp=!0,googletag.pubads().setPrivacySettings({restrictDataProcessing:!0})),n&&googletag.pubads().setPublisherProvidedId(n),i&&googletag.pubads().disableInitialLoad(),googletag.pubads().setSafeFrameConfig({allowOverlayExpansion:!0,allowPushExpansion:!0,sandbox:"EDGE"!==t})})},E=function e(t,n){var i,a,r,o,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.freeze({}),s=arguments.length>3?arguments[3]:void 0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Object.freeze({}),k=l.useState(function(){return"slot-".concat(S++,"-").concat(t.replace("|","-"),"-").concat(n)}),N=u()(k,1)[0],j=l.useRef(void 0),E=l.useContext(f.Device),I=E.userAgentCategory,P=E.browser.family,D=l.useContext(f.Route),x=u()(D,1)[0],A=x.page,C=x.params,_=l.useContext(f.Environment).domainName,V=C.geoId?C.geoId:void 0,F=C.detailId?C.detailId:void 0,R=l.useRef(c),z=Object(g.useQuery)({query:h,variables:{locationId:F||V,pageType:A}}),L=u()(z,1)[0];if(null==L?void 0:null===(i=L.data)||void 0===i?void 0:null===(a=i.gptInfo)||void 0===a?void 0:a.length){var B=u()(L.data.gptInfo,1)[0];B&&(o=B.adBase?B.adBase:void 0,r=B.ppid?B.ppid:void 0)}o&&Object(m.featureIsEnabled)("enable_test_ads")&&(o=o.replace(/\.s\//,".test.s/"));var q=l.useRef((new Date).getTime());return y()(void 0,function e(){"visible"===document.visibilityState&&j.current&&(new Date).getTime()-q.current>1e4&&(Object(p.refreshSlotById)(N),q.current=(new Date).getTime())}),l.useEffect(function(){if(!s.current||L.fetching||!L.data)return function(){};var e=s.current,n=R.current||{},i=Object(m.featureIsEnabled)("lithium_rubicon_header_bidding");!function e(t,n,i,a){T||(T=!0,document.querySelector("script[src='".concat("//securepubads.g.doubleclick.net/tag/js/gpt.js","']"))||(Object(b.importScript)("//securepubads.g.doubleclick.net/tag/js/gpt.js","ADS"),window.googletag=window.googletag||{cmd:[]},Object(O.loadTrackerDeferred)(function(){w(t,n,i,!1)},function(){w(t,n,i,!0)},O.CategoriesEnum.ADVERTISER,a)))}(P,r,i,_),i&&Object(v.ensureRubiconLoaded)(I);var a=function e(t){var n=t.split("|").map(function(e){return e.split("x").map(Number)});return n.push("fluid"),n}(t);return googletag.cmd.push(function(){var t=googletag;if(j.current=function e(t,n,i,a){var r=googletag.defineSlot(t,n,i);return r&&(r.setForceSafeFrame(!0).addService(googletag.pubads()),Object.entries(a).forEach(function(e){var t=u()(e,2),n=t[0],i=t[1];return r.setTargeting(n,i)})),r}(o||"",a,N,d||{}),j.current){var r=j.current;Object(p.registerSlot)(N,r,e,n),n.shouldNotCollapse&&r.setCollapseEmptyDiv(!0),n.animationHeight&&(r.taAnimationHeight=n.animationHeight),t.enableServices(),t.display(N),r&&i&&(n.disableSlotPrebid?t.pubads().refresh([r]):Object(v.refreshWithRubicon)([r],{}))}else console.error("Could not load ad for page: ".concat(N),A)}),function(){Object(p.destroySlot)(N)}},[N,t,P,d,r,o,L.data,L.fetching,A,s,I,_]),N},I={default:"_3nY4zEvj",dataPixel:"_1AfZXyyU"};function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}var D=l.memo(function e(t){var n=t.size,i=t.position,a=t.slotTargeting,r=void 0===a?{}:a,d=t.slotConfig,s=void 0===d?{}:d,c=t.className,u=void 0===c?"":c,g=l.useRef(null),m=function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach(function(t){o()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({pos:i,fluid:{rail:"rail"}[i.replace(/[0-9]/,"")]},r),v=E(n,i,m,g,s);return l.createElement("div",{className:u||I.default,ref:g,id:v})},function x(e,t){var n=e.slotTargeting,i=a()(e,["slotTargeting"]),r=t.slotTargeting,o=a()(t,["slotTargeting"]);return Object(s.shallowEquals)(i,o)&&Object(s.shallowEquals)(n,r)}),A=n("@ta/common.error-handling"),C=n("@ta/common.is-visible"),_=function e(t){var n=t.size,i=t.position,a=t.slotTargeting,r=void 0===a?{}:a,o=t.className,d=l.useState(!1),s=u()(d,2),c=s[0],g=s[1],m=Object(C.useOnVisible)(function(){g(!0)}),p="slot-placeholder-".concat(n.replace("|","-"),"-").concat(i);return l.createElement(A.ErrorBoundary,null,l.createElement("div",{ref:m},c?l.createElement(D,{size:n,position:i,slotTargeting:r,className:o}):l.createElement("div",{id:p})))},V={disableSlotPrebid:!0,disableSlotRefresh:!0},F=function e(t){var n=t.size,i=t.position,a=t.slotTargeting,r=void 0===a?{}:a;return l.createElement(D,{size:n,position:i,slotTargeting:r,slotConfig:V})},R=function e(t){var n=t.size,i=t.position,a=t.slotTargeting,r=void 0===a?{}:a,o=t.className,d=l.useContext(f.Device).viewportCategory,s=n||"970x250|728x90";"TABLET"===d&&(s="728x90");var c={pos:i,fluidType:"banner"},u=Object.assign(c,r);return("DESKTOP"===d||"TABLET"===d)&&l.createElement("div",{className:"_1X_lAJoy"},l.createElement(_,{size:s,position:i,slotTargeting:u,className:o}))},z=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"BaseTargetingQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Long"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"pageType"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"drs"}},"type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"AdContext_DieRollSliceInput"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"urlParameters"}},"type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"AdContext_GlobalContextUrlParameterInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"gptInfo"},"name":{"kind":"Name","value":"AdContext_getPageAdsBatch"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"requests"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"locationId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"locationId"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"pageType"},"value":{"kind":"Variable","name":{"kind":"Name","value":"pageType"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"drs"},"value":{"kind":"Variable","name":{"kind":"Name","value":"drs"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"globalContextUrlParameters"},"value":{"kind":"Variable","name":{"kind":"Name","value":"urlParameters"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"pageLevelTargeting"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"key"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"value"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","alias":{"kind":"Name","value":"audId"},"name":{"kind":"Name","value":"AdContext_getAudiences"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":455}}');z.__key=0xd65f6b5c19f7,z.loc.source={body:"d65f6b5c19f7"};var L=z,B=function e(t){if(window.googletag&&window.googletag.apiReady){var n=googletag.pubads();Object.entries(t).forEach(function(e){var t=u()(e,2),i=t[0],a=t[1];n.setTargeting(i,a)})}},q=function e(){var t=l.useContext(f.Route),n=u()(t,2),i=n[0],a=i.page,r=i.params,o=n[1].uid,d=l.useContext(f.Device).viewportCategory,s=l.useContext(f.Visitor).sessionId,c=l.useContext(f.Debug).drsInfo,m=(r.geoId?r.geoId:void 0)||0,v=(r.detailId?r.detailId:void 0)||0,b=Object(g.useQuery)({query:L,variables:{locationId:v||m,pageType:a,drs:function e(t){return t.split("*").map(function(e){var t=e.split("."),n=u()(t,2),i=n[0],a=n[1];return{space:i,sliceNum:Number.parseInt(a,10)}})}(c),urlParameters:Object.entries(r).map(function(e){var t=u()(e,2),n=t[0],i=t[1];return{key:n,value:String(i)}})}}),k=u()(b,1)[0],y=k.fetching,O=k.data,N=l.useState({}),h=u()(N,2),j=h[0],T=h[1];l.useEffect(function(){if(!y&&O){var e,t,n=(null===(e=O.gptInfo)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.pageLevelTargeting)||[],i=[];O.audId&&O.audId.forEach(function(e){return!!e&&i.push(e)});var a={platform:d.toLowerCase(),pv_id:o,sess:s||void 0,aud_id:i};n.forEach(function(e){e&&e.key&&(a[e.key]=e.value)}),T(a)}},[O,y,o,s,d]),function e(t){var n=l.useRef(t);l.useEffect(function(){if(0===Object.keys(t).length)return function(){};n.current=t;var e=window.googletag;if(e&&e.apiReady)B(t),Object(p.refreshAllSlots)();else{window.googletag=window.googletag||{cmd:[]};var i=googletag.cmd;Array.isArray(i)?i.unshift(function(){return B(t)}):i.push(function(){return B(t)})}return function(){!function e(t){if(window.googletag&&window.googletag.apiReady){var n=googletag.pubads();Object.keys(t).forEach(function(e){n.clearTargeting(e)})}}(n.current)}},[t])}(j)},G=function e(t){var n=t.size,i=t.slotTargeting,a=void 0===i?{}:i,r=t.className,o=n||"728x90|970x66";return l.createElement(R,{size:o,position:"header",slotTargeting:a,className:r})},Q=function e(t){var n=t.size,i=t.slotTargeting,a=void 0===i?{}:i,r=t.className,o=n||"970x250|728x90";return l.createElement(R,{size:o,position:"footer",slotTargeting:a,className:r})},M=n("@ta/cpm.utils");function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}var H=function e(t){var n=t.slotTargeting,i=void 0===n?{}:n,a=t.className,r=void 0===a?"jR2-DkMQ":a,s=t.position,c=void 0===s?"inline1":s,u=Object(l.useRef)(null),g=Object(M.useElementSize)(u).width,m=void 0===g?0:g,p=Object(l.useContext)(f.Device).viewportCategory,v=function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach(function(t){o()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({pos:c,fluidType:"banner"},i),k=m>=728&&"MOBILE"!==p;return d.a.createElement("div",{ref:u,className:"_1X_lAJoy"},k?d.a.createElement(_,{size:"728x90",position:c,slotTargeting:v,className:r}):null)},J=new Map([[4,"inline1"],[9,"inline2"],[14,"inline3"],[19,"inline4"],[24,"inline5"]]);function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J;return e.reduce(function(e,n,i){if(t.has(i)){var a=t.get(i)||"inline1",r=d.a.createElement(H,{position:a,key:"ad_".concat(a)});return e.concat(r,n)}return e.concat(n)},[])}var X=H;n.d(t,"GptAd",function(){return D}),n.d(t,"adStyles",function(){return I}),n.d(t,"GptAdOnVisible",function(){return _}),n.d(t,"GptAdPixel",function(){return F}),n.d(t,"DesktopBannerAd",function(){return R}),n.d(t,"useGpt",function(){return E}),n.d(t,"useBasePageTargeting",function(){return q}),n.d(t,"GptInfoQuery",function(){return h}),n.d(t,"HeaderAd",function(){return G}),n.d(t,"FooterAd",function(){return Q}),n.d(t,"InlineBannerAd",function(){return X}),n.d(t,"DEFAULT_INLINE_POSITIONS",function(){return J}),n.d(t,"withInlineAds",function(){return U}),n.d(t,"listenToCpmMessage",function(){return j})}}});
//# sourceMappingURL=cpm.94k6dr.cd1726b780.js.map