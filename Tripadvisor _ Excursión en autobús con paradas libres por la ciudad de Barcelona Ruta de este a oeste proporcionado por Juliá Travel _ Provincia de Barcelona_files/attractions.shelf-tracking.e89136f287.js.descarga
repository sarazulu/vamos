($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.shelf-tracking",d:["vendor-babel","vendor-react-libs","@ta/common.features","vendor-urql","lithium-platform"],e:["./packages/attractions/shelf-tracking/ShelfTracking.jsx"],m:{"./packages/attractions/shelf-tracking/ShelfTracking.jsx":function(e,t,n){"use strict";n.r(t);var i=n("@babel/runtime/helpers/esm/defineProperty"),r=n.n(i),o=n("@babel/runtime/helpers/esm/slicedToArray"),a=n.n(o),c=n("react"),s=n("urql"),d=n("@ta/lithium.context"),l=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"LogImpressions"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"impressions"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Impressions_ImpressionInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"PostImpressions"},"name":{"kind":"Name","value":"Impressions_postImpressions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"impressions"}}}],"directives":[]}]}}],"loc":{"start":0,"end":152}}');l.__key=0x7ce03388fda1,l.loc.source={body:"7ce03388fda1"};var u=l,p=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"LogInteractionV4"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"interactions"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Impressions_InteractionInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"PostInteractions"},"name":{"kind":"Name","value":"Impressions_postInteractions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"interactions"}}}],"directives":[]}]}}],"loc":{"start":0,"end":159}}');p.__key=0x8a0621d91c80,p.loc.source={body:"8a0621d91c80"};var m=p,f=n("@ta/common.features"),v=function e(t){var n=c.useState({}),i=a()(n,2),r=i[0],o=i[1],s=c.useState({}),d=a()(s,2),l=d[0],u=d[1];return{serviceBasedTrackingEnabled:Object(f.featureIsEnabled)("attractions_shelf_tracking_load_management"),itemImpressionIdStore:r,tabImpressionIdStore:l,shelfType:t,update:{setItemImpressionIdStore:function e(t){o(t)},setTabImpressionIdStore:function e(t){u(t)}}}},b=c.createContext({serviceBasedTrackingEnabled:!1,itemImpressionIdStore:{},tabImpressionIdStore:{},shelfType:"",update:{setItemImpressionIdStore:function e(){},setTabImpressionIdStore:function e(){}}}),I=function e(t){return t.product&&"shelf_".concat(t.shelfIndex,"_item_").concat(t.product.placement,"_Product_").concat(t.product.productCode)||t.attraction&&"shelf_".concat(t.shelfIndex,"_item_").concat(t.attraction.placement,"_Attraction_").concat(t.attraction.id)||t.category&&"shelf_".concat(t.shelfIndex,"_item_").concat(t.category.itemIndex,"_Category_").concat(t.category.groupTagId)||t.destination&&"shelf_".concat(t.shelfIndex,"_item_").concat(t.destination.placement,"_Destination_").concat(t.destination.id)||t.taxonomy&&"shelf_".concat(t.shelfIndex,"_item_",0,"_Taxonomy_").concat(t.taxonomy.id)||""};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach(function(t){r()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function e(){var t=Object(s.useMutation)(u),n=a()(t,2)[1],i=Object(c.useContext)(d.Route),o=a()(i,2),l=o[0].page,p=o[1].uid,m=Object(c.useContext)(b),f=m.serviceBasedTrackingEnabled,v=m.itemImpressionIdStore,g=m.shelfType,h=m.update.setItemImpressionIdStore;return Object(c.useCallback)(function(e){if(f){var t=e.filter(function(e){return!v[I(e)]});if(t.length){var i=y({},v),o=function e(t,n,i,r){return t.length>0?{experiencesShelfItems:{pageviewUid:n,servlet:i,shelfType:r,shelfItems:t.map(function(e){return function e(t){var n,i,r,o,a,c,s,d,l,u,p,m,f;return t.product&&{itemType:"Product",itemId:null===(n=t.product)||void 0===n?void 0:n.productCode,itemIdType:"ProductCode",name:null===(i=t.product)||void 0===i?void 0:i.title,url:null===(r=t.product)||void 0===r?void 0:r.url,imageUrl:null===(o=t.product)||void 0===o?void 0:o.imgUrl,position:null===(a=t.product)||void 0===a?void 0:a.placement,tabIndex:t.shelfIndex,tabId:null===(c=t.product)||void 0===c?void 0:c.tabId,rating:null===(s=t.product)||void 0===s?void 0:s.rating,reviewCount:null===(d=t.product)||void 0===d?void 0:d.reviewCount,price:null===(l=t.product)||void 0===l?void 0:l.fromPrice.replace(/[^\d.,\s]+/g,"").replace(",","."),currency:null===(u=t.product)||void 0===u?void 0:u.currency,productLabelTag:null===(p=t.product)||void 0===p?void 0:null===(m=p.productLabelTag)||void 0===m?void 0:m.labelType}||t.category&&{itemType:"Category",itemId:"".concat(t.category.groupTagId),itemIdType:"CategoryId",name:t.category.title,url:t.category.encodedUrl,imageUrl:t.category.imgUrl,position:t.category.itemIndex,tabIndex:t.shelfIndex,tabId:"BROWSE_BY_CATEGORY"}||t.attraction&&{itemType:"Attraction",itemId:"".concat(t.attraction.id),itemIdType:"LocationId",name:t.attraction.name,url:t.attraction.detailUrl,position:t.attraction.placement,tabIndex:t.shelfIndex,rating:t.attraction.bubbleRating,reviewCount:t.attraction.numReviews}||t.destination&&{itemType:"Destination",itemId:"".concat(t.destination.id),itemIdType:"GeoId",name:t.destination.name,url:t.destination.url,imageUrl:null===(f=t.destination.photo)||void 0===f?void 0:f.photoSizes[0].url,position:t.destination.placement,tabIndex:t.shelfIndex}||null}(e)}).filter(function(e){return null!=e})}}:null}(t,p,l,g);null!=o&&n({impressions:[o]}).then(function(e){var t,n,o=!e.error&&(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(n=t.PostImpressions)||void 0===n?void 0:n[0]),a=e.operation.variables;if(o&&a){var c=function e(t){var n,i,r=null===(n=t.impressions)||void 0===n?void 0:null===(i=n[0])||void 0===i?void 0:i.experiencesShelfItems;return((null==r?void 0:r.shelfItems)||[]).map(function(e){return function e(t){return"shelf_".concat((null==t?void 0:t.tabIndex)||"0","_item_").concat((null==t?void 0:t.position)||"0","_").concat((null==t?void 0:t.itemType)||"0","_").concat((null==t?void 0:t.itemId)||"0")}(e)})}(a).reduce(function(e,t){return y({},e,r()({},t,o))},{});h(y({},i,{},c))}})}}},[n,f,v,h,p,l,g])},T=function e(t){var n=Object(s.useMutation)(m),i=a()(n,2)[1],r=Object(c.useContext)(d.Route),o=a()(r,2),l=o[0].page,u=o[1].uid,p=Object(c.useContext)(b),f=p.serviceBasedTrackingEnabled,v=p.itemImpressionIdStore,g=p.shelfType;return Object(c.useCallback)(function(e){if(f){var n=v[I(t)];if(n){var r=function e(t,n,i,r,o,a){return t.product&&{eventTimestampMs:0,pageUid:r,Experiences:{ShelfItemClick:{pageviewUid:r,actionPart:a,impressionId:o,servlet:i,shelfType:n,itemType:"Product",itemId:t.product.productCode,itemIdType:"ProductCode",position:t.product.placement,tabIndex:t.shelfIndex,tabId:t.product.tabId}}}||t.category&&{eventTimestampMs:0,pageUid:r,Experiences:{ShelfItemClick:{pageviewUid:r,actionPart:a,impressionId:o,servlet:i,shelfType:n,itemType:"Category",itemId:"".concat(t.category.groupTagId),itemIdType:"CategoryId",position:t.category.itemIndex,tabIndex:t.shelfIndex,tabId:"BROWSE_BY_CATEGORY"}}}||t.attraction&&{eventTimestampMs:0,pageUid:r,Experiences:{ShelfItemClick:{pageviewUid:r,actionPart:a,impressionId:o,servlet:i,shelfType:n,itemType:"Attraction",itemId:"".concat(t.attraction.id),itemIdType:"LocationId",position:t.attraction.placement,tabIndex:t.shelfIndex}}}||t.destination&&{eventTimestampMs:0,pageUid:r,Experiences:{ShelfItemClick:{pageviewUid:r,actionPart:a,impressionId:o,servlet:i,shelfType:n,itemType:"Destination",itemId:"".concat(t.destination.id),itemIdType:"GeoId",position:t.destination.placement,tabIndex:t.shelfIndex}}}}(t,g,l,u,n,e);r&&i({interactions:[r]})}}},[i,f,v,u,l,g,t])};function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(n,!0).forEach(function(t){r()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x=function e(t,n){return{itemType:"Tab",itemId:"".concat(t.trackingId||t.groupTagId||"0"),itemIdType:"CategoryId",tabIndex:n}},S=function e(t){return"shelf_tab_".concat(t)};function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach(function(t){r()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var C=function e(){var t=Object(s.useMutation)(u),n=a()(t,2)[1],i=Object(c.useContext)(d.Route),o=a()(i,2),l=o[0].page,p=o[1].uid,m=Object(c.useContext)(b),f=m.serviceBasedTrackingEnabled,v=m.tabImpressionIdStore,I=m.shelfType,g=m.update.setTabImpressionIdStore;return Object(c.useCallback)(function(e){if(f){var t=e.filter(function(e,t){return!v[S(t)]});if(t.length>0){var i=_({},v),o=function e(t,n,i,r){return t.length>0?{experiencesShelfTabs:{pageviewUid:n,servlet:i,shelfType:r,shelfTabs:t.map(function(e,t){return x(e,t)})}}:null}(t,p,l,I);null!=o&&n({impressions:[o]}).then(function(e){var t,n,o=!e.error&&(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(n=t.PostImpressions)||void 0===n?void 0:n[0]),a=e.operation.variables;if(o&&a){var c=function e(t){var n,i,r=null===(n=t.impressions)||void 0===n?void 0:null===(i=n[0])||void 0===i?void 0:i.experiencesShelfTabs;return((null==r?void 0:r.shelfTabs)||[]).map(function(e){return function e(t){return"shelf_tab_".concat((null==t?void 0:t.tabIndex)||"0")}(e)})}(a).reduce(function(e,t){return _({},e,r()({},t,o))},{});g(_({},i,{},c))}})}}},[n,f,v,g,p,l,I])},P=function e(){var t=Object(s.useMutation)(m),n=a()(t,2)[1],i=Object(c.useContext)(d.Route),r=a()(i,2),o=r[0].page,l=r[1].uid,u=Object(c.useContext)(b),p=u.serviceBasedTrackingEnabled,f=u.tabImpressionIdStore,v=u.shelfType;return Object(c.useCallback)(function(e,t){if(p){var i=f[S(t)];if(i){var r=function e(t,n,i,r,o,a){return{eventTimestampMs:0,pageUid:i,Experiences:{ShelfTabClick:k({pageviewUid:i,impressionId:r,servlet:o,shelfType:a},x(t,n))}}}(e,t,l,i,o,v);r&&n({interactions:[r]})}}},[n,p,f,l,o,v])},w=function e(){var t=Object(s.useMutation)(m),n=a()(t,2)[1],i=Object(c.useContext)(d.Route),r=a()(i,2),o=r[0].page,l=r[1].uid,u=Object(c.useContext)(b),p=u.serviceBasedTrackingEnabled,f=u.shelfType;return Object(c.useCallback)(function(e,t){if(p){var i=function e(t,n,i,r,o){return{eventTimestampMs:0,pageUid:i,Experiences:{ShelfShowMoreClick:k({pageviewUid:i,servlet:r,shelfType:o},x(t,n))}}}(e,t,l,o,f);n({interactions:[i]})}},[n,p,l,f,o])};n.d(t,"ShelfTrackingContext",function(){return b}),n.d(t,"useShelfItemsVisibleLogger",function(){return h}),n.d(t,"useShelfItemClickLogger",function(){return T}),n.d(t,"useShelfShowMoreClickLogger",function(){return w}),n.d(t,"useShelfTabClickLogger",function(){return P}),n.d(t,"useShelfTabsVisibleLogger",function(){return C}),n.d(t,"useShelfTrackingContext",function(){return v})}}});
//# sourceMappingURL=attractions.shelf-tracking.e89136f287.js.map