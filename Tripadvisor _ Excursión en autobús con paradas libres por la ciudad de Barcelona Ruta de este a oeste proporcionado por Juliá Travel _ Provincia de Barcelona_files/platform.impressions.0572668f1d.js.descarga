($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/platform.impressions",d:["vendor-babel","vendor-react-libs","lithium-platform","vendor-urql","vendor-common"],e:["./packages/platform/impressions/impressions.jsx"],m:{"./packages/platform/impressions/impressions.jsx":function(e,n,r){"use strict";r.r(n);var t=r("@babel/runtime/helpers/esm/defineProperty"),i=r.n(t),o=r("@babel/runtime/helpers/esm/objectWithoutProperties"),u=r.n(o),a=r("@babel/runtime/helpers/esm/slicedToArray"),s=r.n(a),l=r("react"),c=r("@ta/lithium.context"),d=r("urql"),f=r("fast-deep-equal"),p=r.n(f),m=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"LogImpressions"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"impressions"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"ImpressionInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"logImpressions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"impressions"},"value":{"kind":"Variable","name":{"kind":"Name","value":"impressions"}}}],"directives":[]}]}}],"loc":{"start":0,"end":114}}');m.__key=0xd4238cb95b19,m.loc.source={body:"d4238cb95b19"};var v=m;function b(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function y(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?b(r,!0).forEach(function(n){i()(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(r).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}r.d(n,"AddPageProperty",function(){return h}),r.d(n,"PageViewLogger",function(){return O}),r.d(n,"usePageProperty",function(){return w}),r.d(n,"Impression",function(){return E});var g=new TextEncoder,k=function e(n,r){return n+r},P=new Set,h=l.createContext(function(e){P.add(e)}),O=function e(n){var r=n.children,t=l.useContext(c.Route),i=s()(t,2),o=i[0].path,u=i[1].uid,a=l.useRef(new Set),f=l.useCallback(function(e){a.current.add(e)},[]),p=Object(d.useClient)().pvExchange;return l.useEffect(function(){var e=null,n=!1,r=function r(){if(!n){var t=[u,o].map(function(e){return Array.from(g.encode(e)).reduce(k,0)}).reduce(k,0);(n=navigator.sendBeacon("/PVLog",JSON.stringify({checksum:t,path:o,uid:u,pageProperties:Array.from(P.size>0?P:a.current),referrer:"undefined"!=typeof document?document.referrer:null})))&&(a.current=new Set,e&&cancelIdleCallback(e),window.removeEventListener("beforeunload",r))}};return p.allQueriesResolvedForPageView(u).then(function(){e=requestIdleCallback(r)}),window.addEventListener("beforeunload",r),r},[u]),l.createElement(h.Provider,{value:f},r)},w=function e(n){var r=l.useContext(h);l.useEffect(function(){return r(n)},[n,r])},j=l.createContext(null),E=function e(n){var r=n.children,t=u()(n,["children"]),i=l.useState(null),o=s()(i,2),a=o[0],c=o[1],f=Object(d.useMutation)(v),m=s()(f,2)[1],b=l.useContext(j);l.useEffect(function(){void 0!==b&&null===a&&(c(void 0),m({impressions:[y({},t,{parentId:b})]}).then(function(e){var n,r=e.data;c((null==r?void 0:null===(n=r.logImpressions)||void 0===n?void 0:n.length)>0?r.logImpressions[0]:null)}))},[b,a,m,t]);var g=l.useRef(t);return l.useEffect(function(){p()(g.current,t)||c(null),g.current=t},[t]),l.createElement(j.Provider,{value:null===a?void 0:a},r)};n.default=function e(){return l.createElement(O,null,null)}}}});
//# sourceMappingURL=platform.impressions.0572668f1d.js.map