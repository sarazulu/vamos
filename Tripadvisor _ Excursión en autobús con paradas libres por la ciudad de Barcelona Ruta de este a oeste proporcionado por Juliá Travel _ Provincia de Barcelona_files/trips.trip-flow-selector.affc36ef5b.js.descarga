($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/trips.trip-flow-selector",d:["vendor-babel","vendor-react-libs","@ta/social.login-gate","@ta/common.features","@ta/trips.trip-errors","@ta/trips.trip-types","@ta/trips.tracking","@ta/trips.trip-util","@ta/trips.trip-toasts","@ta/trips.saver","lithium-platform","@ta/platform.monikers","@ta/modal.styleguide","@ta/modal.headers","lithium-common","@ta/trips.impressions","@ta/trips.graphql","vendor-urql"],e:["./packages/trips/trip-flow-selector/index.jsx"],m:{"./packages/trips/trip-flow-selector/index.jsx":function(e,t,r){"use strict";r.r(t);var a,n=r("@babel/runtime/helpers/esm/extends"),i=r.n(n),o=r("@babel/runtime/helpers/esm/slicedToArray"),s=r.n(o),l=r("@babel/runtime/helpers/esm/objectWithoutProperties"),c=r.n(l),u=r("@babel/runtime/helpers/esm/defineProperty"),p=r.n(u),d=r("react"),v=r("@ta/social.login-gate"),m=r("@ta/common.features"),f=r("@ta/trips.trip-errors"),_=(r("@ta/trips.trip-types"),r("@ta/trips.tracking")),E=r("@ta/trips.trip-util"),b=r("@ta/trips.trip-toasts"),T=r.n(b),S=r("@ta/trips.saver"),C=r("@ta/lithium.context"),g=r("@ta/platform.monikers"),O=r("@ta/modal.styleguide"),I=r.n(O),y=r("@ta/modal.headers"),k=r("@ta/styleguide.loading"),j=r("@ta/platform.i18n"),M=r.n(j),h=r("@ta/platform.import"),A=r("@ta/trips.impressions"),P=r("@ta/core-ui.loading-error"),L=r.n(P),D=r("@babel/runtime/helpers/esm/toConsumableArray"),x=r.n(D),w=r("@ta/platform.urql"),R=r("@ta/trips.graphql"),N=r("urql"),V=function e(t,r){var a,n,i;if(!r)return t;var o=(null===(a=t.paginatedTrips)||void 0===a?void 0:a.trips)||[],s=(null===(n=r.paginatedTrips)||void 0===n?void 0:n.trips)||[];return{paginatedTrips:t.paginatedTrips?{trips:[].concat(x()(o),x()(s)),hasMore:!!(null===(i=r.paginatedTrips)||void 0===i?void 0:i.hasMore),__typename:t.paginatedTrips.__typename}:r.paginatedTrips,savedTrips:t.savedTrips}},U=function e(t){var r;return{__typename:t.__typename,id:t.id||0,title:t.title||void 0,status:t.status||void 0,photoId:t.photoId||void 0,photo:t.photo||{},route:{url:t.route&&t.route.url||void 0},actionPermissions:{canAddItem:!!(null===(r=t.actionPermissions)||void 0===r?void 0:r.canAddItem)}}},F=Object.freeze({DEFAULT:function e(t){return"bundleSave"!==t?d.createElement(M.a,{id:"stat_modal_save_to_trip_v2"}):d.createElement(M.a,{id:"save_all_items_modal_header"})},CREATE:function e(){return d.createElement(M.a,{id:"stat_modal_create_a_trip_v2"})},SELECT:function e(){return d.createElement(M.a,{id:"select_trip_header"})},SELECT_CREATE:function e(){return d.createElement(M.a,{id:"stat_modal_create_a_trip_v2"})}}),G=h.component.onUsage(((a=function e(){return r.e("@ta/trips.create-trip-modal")}).__PACKAGE__="@ta/trips.trip-flow-selector",a.__MODULE_ID__="@ta/trips.create-trip-modal",a.__MODULE_NAME__="@ta/trips.create-trip-modal",a.__BUNDLE_NAME__="@ta/trips.create-trip-modal",a.__GET_SYNC__=function(){return r.m["@ta/trips.create-trip-modal"]?r("@ta/trips.create-trip-modal"):null},a.__IS_LOADED__=function(){return void 0!==r.m["@ta/trips.create-trip-modal"]},a),"CreateTripWithAddItemModal",d.createElement("div",{className:"_1ZX8j9so"},d.createElement(k.LoadingSpinner,{size:"large"}))),q=h.component.onUsage(function(){var e=function e(){return r.e("@ta/trips.create-trip-modal")};return e.__PACKAGE__="@ta/trips.trip-flow-selector",e.__MODULE_ID__="@ta/trips.create-trip-modal",e.__MODULE_NAME__="@ta/trips.create-trip-modal",e.__BUNDLE_NAME__="@ta/trips.create-trip-modal",e.__GET_SYNC__=function(){return r.m["@ta/trips.create-trip-modal"]?r("@ta/trips.create-trip-modal"):null},e.__IS_LOADED__=function(){return void 0!==r.m["@ta/trips.create-trip-modal"]},e}(),"CreateTripWithMoveItemModal",d.createElement("div",{className:"_1ZX8j9so"},d.createElement(k.LoadingSpinner,{size:"large"}))),B=h.component.onUsage(function(){var e=function e(){return r.e("@ta/trips.save-to-trip-modal")};return e.__PACKAGE__="@ta/trips.trip-flow-selector",e.__MODULE_ID__="@ta/trips.save-to-trip-modal",e.__MODULE_NAME__="@ta/trips.save-to-trip-modal",e.__BUNDLE_NAME__="@ta/trips.save-to-trip-modal",e.__GET_SYNC__=function(){return r.m["@ta/trips.save-to-trip-modal"]?r("@ta/trips.save-to-trip-modal"):null},e.__IS_LOADED__=function(){return void 0!==r.m["@ta/trips.save-to-trip-modal"]},e}(),"SaveToTripContent",d.createElement("div",{className:"_1ZX8j9so"},d.createElement(k.LoadingSpinner,{size:"large"}))),W=function e(t){var r,a=t.saveObject,n=t.overlayState,i=t.validateTripName,o=t.lastSavedItem,l=t.trackingContext,u=t.trackingSource,p=c()(t,["saveObject","overlayState","validateTripName","lastSavedItem","trackingContext","trackingSource"]),v=d.useState(!0),f=s()(v,2),b=f[0],T=f[1],S=function e(t){var r,a,n,i,o,l,c,u=function e(r,a){return r&&a?a===t.type&&r===String(t.id)?"invalidateAndRefetch":"validate":"invalidateAndRefetch"},p={offset:0,limit:10,userId:d.useContext(C.Visitor).userId||"",reference:Object(E.toReference)(t),loadSavedTrips:!0},v=Object(w.usePaginatedQuery)({query:R.TripDetailStatQuery,variables:p,combineData:V,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:function e(){return"invalidateAndRefetch"},cloneTrip:function e(){return"invalidateAndRefetch"},tripsDelete:function e(){return"invalidateAndRefetch"},addItemToTrip:function e(t){var r=t.variables,a=r.referenceId,n=r.referenceType;return u(a,n)},moveTripItem:function e(t){var r=t.variables.reference;return u(null==r?void 0:r.id,null==r?void 0:r.type)},tripsRemoveItem:function e(t){var r=t.variables.reference;return u(null==r?void 0:r.id,null==r?void 0:r.type)},tripsRemoveReference:function e(t){var r=t.variables.reference;return u(null==r?void 0:r.id,null==r?void 0:r.type)}}}),f=s()(v,2),_=f[0],b=f[1],T=Object(m.featureIsEnabled)("trips_skip_check_whitelist_public_trips"),S=Object(N.useQuery)({query:R.GetUserAuthZInfo,variables:{},pause:T}),g=s()(S,1)[0],O=(null===(r=_.data)||void 0===r?void 0:null===(a=r.paginatedTrips)||void 0===a?void 0:a.trips)||[],I=O.slice().filter(Boolean).map(U),y=!!(null===(n=_.data)||void 0===n?void 0:null===(i=n.paginatedTrips)||void 0===i?void 0:i.hasMore),k=(null===(o=_.data)||void 0===o?void 0:o.savedTrips)||[],j=new Set(k.map(function(e){return null==e?void 0:e.id}).filter(Boolean)),M=y?function(){return b({offset:(null==O?void 0:O.length)||0,loadSavedTrips:!1})}:function(){return Promise.resolve()},h=T||(null===(l=g.data)||void 0===l?void 0:null===(c=l.authzInfo)||void 0===c?void 0:c.canMakePublicTrip);return{fetching:_.fetching||g.fetching,error:!!_.error,data:{tripList:I,saveSet:j,canMakePublicTrip:h},hasMore:y,loadMore:M}}(a),g=S.fetching,O=S.error,j=S.data,M=S.hasMore,h=S.loadMore;g?r=d.createElement(k.LoadingSpinner,{size:"large"}):O&&(r=d.createElement(L.a,{refetch:h})),d.useEffect(function(){g||T(!1)},[]);var P=Object(_.useTripInteraction)({source:u||"trips",trackingContext:l,pageAsContext:!0,withSaveSession:!0}),D=s()(P,1)[0],x=function e(){p.onClose(),T(!0)},W=F[n](a.type),Q=d.createElement(y.TitleBar,{iconName:Object(m.featureIsEnabled)("trips_heart_icon")?"heart":"suitcase",displayType:"LEFT_ALIGN_GRAY"},W);return d.createElement(A.TripsImpression,{element:"bundleSave"===a.type?"copyTripModal":"saveTripModal"},d.createElement(I.a,{header:Q,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:x},r&&b?d.createElement("div",{className:"_1ZX8j9so"},r):function e(){var t=o?Object(E.toSavesObject)(o):void 0,s=function e(){return d.createElement("div",{className:"_2VvuVGxR"},d.createElement(G,{gate:function e(){return Promise.resolve()},object:a,onMount:function e(){g||O||D({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:function e(t){p.statCallback("ADD","NEW",t,!0,!0),x()},onError:p.onError,canMakePublicTrip:j.canMakePublicTrip,validateTripName:i,trackingContext:l,trackingSource:u}))};switch(n){case"DEFAULT":return 0===j.tripList.length?s():d.createElement(B,{tripList:j.tripList,savedSet:j.saveSet,tripListBottom:r,onPaginate:h,hasMore:M,saveObject:a,onMount:function e(){p.preventInteractionInMountedComponents||D({elementClick:{element:"stat"}})},onCreateTrip:function e(){p.onCreateTripClicked&&p.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:function e(t,r,a){p.statCallback("REMOVE","EXISTING",t,r,a),x()},onSavedToTrip:function e(t,r,a){p.statCallback("ADD","EXISTING",t,r,a),x()},onError:p.onError,trackingContext:l,trackingSource:u});case"CREATE":return s();case"SELECT":return t?d.createElement(B,{tripList:j.tripList,savedSet:j.saveSet,tripListBottom:r,onPaginate:h,hasMore:M,saveObject:t,onMount:function e(){D({elementClick:{element:"stat"}})},onCreateTrip:function e(){p.onSelectCreateTripClicked&&p.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:function e(t,r,a){p.statCallback("MOVE","EXISTING",t,r,a),x()},onRemovedFromTrip:function e(t,r,a){p.statCallback("REMOVE","EXISTING",t,r,a),x()},onError:p.onError,trackingContext:l,trackingSource:u}):"";case"SELECT_CREATE":return o?d.createElement("div",{className:"_2VvuVGxR"},d.createElement(q,{gate:function e(){return Promise.resolve()},item:o,onMovedToCreatedTrip:function e(t){p.statCallback("MOVE","NEW",t,!0,!0),x()},canMakePublicTrip:j.canMakePublicTrip})):s();default:return""}}()))};function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(r,!0).forEach(function(t){p()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var z=["Profile","HomeFeed","Trips","Home"],Y=function e(t,r){switch(r.type){case"openModal":return X({},t,{statModalVisible:!0});case"closeModal":return X({},t,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!1,statModalVisible:!1});case"setOverlayState":return X({},t,{overlayState:r.state});case"openSelectModal":return X({},t,{overlayState:"SELECT",statModalVisible:!0});case"afterSave":return X({},t,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!0});default:throw new Error}},Z=function e(t){var r,a=t.allowPopStatModal,n=t.children,i=t.logInteraction,o=t.puid,l=t.object,u=t.active,p=t.preventInteractionPropagation,E=t.trackingContext,b=t.trackingSource,O=t.resaveTrip,I=t.saveObject,y=c()(t,["allowPopStatModal","children","logInteraction","puid","object","active","preventInteractionPropagation","trackingContext","trackingSource","resaveTrip","saveObject"]),k=d.useContext(C.Visitor).userId,j=d.useContext(C.Route),M=s()(j,1)[0],h=T()(),A=h.launchViewTripToast,P=h.launchRemoveFromTripToast,L=h.launchAutoSavedToTripToast,D=h.launchErrorTripToast,x=Object(f.useLocalizeTripError)().getTripErrorMessage,w=Object(g.usePixelCallback)("SAVE_TO_TRIP_INTENT"),R=Object(g.usePixelCallback)("SAVE_TO_TRIP"),N=Object(g.usePixelCallback)({type:"CREATE_TRIP",payload:{user_id:k||""}}),V=M.page,U=d.useContext(_.SaveSessionTrackingContext),F=d.useMemo(function(){return M.params.popStat||!1},[M.params]),G=d.useReducer(Y,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!1,statModalVisible:!1}),q=s()(G,2),B=q[0],Q=q[1],X=d.useCallback(function(){return Q({type:"openModal"})},[]),Z=d.useCallback(function(){return!!a&&F&&Object(m.featureIsEnabled)("trips_pop_stat_modal")},[a,F]),K=y.onComplete,$=d.useCallback(function(e){K&&K(e),U.resetSession()},[K,U]),H=d.useCallback(function(e,t){e&&!t?(A(e,"SAVED",function e(){i({elementClick:{element:"saved_viewTrip"}})}),$(!0)):t&&(D(t),$(!1)),Q({type:"setOverlayState",state:"DEFAULT"}),i({elementClick:{element:"unsave_undo"}})},[A,$,D,i]),J=d.useCallback(function(e){P(e,I,H)},[P,H,I]),ee=d.useCallback(function(e){D(e)},[D]),te=d.useCallback(function(){Q({type:"closeModal"}),U.resetSession()},[U]),re=Object(S.useAutosave)(I,u,X),ae=s()(re,3),ne=ae[0],ie=ae[1],oe=ae[2],se=d.useCallback(function(e,t){"CREATED"===t&&(R(),N()),Q({type:"afterSave"}),A(e,t,function(){i({elementClick:{element:"saved_viewTrip"}})}),oe(e.id),$(!0)},[R,A,$,oe,N,i]),le=d.useCallback(function(){i({elementClick:{element:"ITEM_SAVE_LOGIN",context:V&&Object(_.getInteractionsContext)(V)||void 0,puid:o,saveType:I.type,detailId:I.id?"".concat(I.id):"",tripId:null==O?void 0:O.id,sessionType:"SAVE",sessionUuid:U.sessionUuid,sessionOrder:U.sessionOrder}})},[i,V,o,O,I.id,I.type,U.sessionOrder,U.sessionUuid]),ce=d.useCallback(function(){i({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:V&&Object(_.getInteractionsContext)(V)||void 0,puid:o,saveType:I.type,detailId:I.id?"".concat(I.id):"",tripId:null==O?void 0:O.id,sessionType:"SAVE",sessionUuid:U.sessionUuid,sessionOrder:U.sessionOrder}})},[i,V,o,O,I.id,I.type,U.sessionOrder,U.sessionUuid]),ue=d.useMemo(function(){return{pid:V&&z.includes(M.page)?40439:39766,flow:"SAVES_COMBINED",onLogin:le,onSuccess:ce}},[le,ce,V,M.page]),pe=d.useRef(!1),de=Object(v.useSocialLoginGate)(ue);d.useEffect(function(){Z()&&!pe.current&&(pe.current=!0,i({elementClick:{element:"autoPopStat"}}),de().then(X))},[i,de,X,Z]);var ve=d.useCallback(function(){de().then(function(){return ie()}).then(function(e){var t=s()(e,2),r=t[0],a=t[1];a?ee({query:"ADD_ITEM_TO_TRIP",tripsError:a}):r&&(L(r,function e(){Q({type:"openSelectModal"}),i({elementClick:{element:"quickSave_change"}})}),i({modalSuccess:{element:"quickSave",tripId:null==O?void 0:O.id,context:V&&Object(_.getInteractionsContext)(V)||void 0,saveType:I.type,detailId:I.id?"".concat(I.id):""}}),Q({type:"setOverlayState",state:"DEFAULT"}),$(!0))})},[L,i,de,$,ee,ie,V,O,I.id,I.type]);return d.createElement("div",{className:"stat_wrapper",onClick:function e(t){t.stopPropagation(),t.preventDefault(),!p&&k&&i({elementClick:{element:"item_save",tripId:null==O?void 0:O.id}}),u||w()}},n(ve),B.statModalVisible&&k&&d.createElement(W,{saveObject:I,overlayState:B.overlayState,lastSavedItem:null===(r=ne.result)||void 0===r?void 0:r.tripItem,trackingContext:E,trackingSource:b,onCreateTripClicked:function e(){return Q({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:function e(){return Q({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:te,onError:ee,preventInteractionInMountedComponents:B.preventInteractionInMountedComponents,statCallback:function e(t,r,a,n,i){"REMOVE"===t?(J(a),$(i)):"NEW"===r?se(a,"CREATED"):n&&se(a,"SAVED")},validateTripName:function e(t){if("bundleSave"===I.type&&t.trim().toLowerCase()===l.title.trim().toLowerCase())return x("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}}))};Z.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1};var K=function e(t){return Object(m.featureIsEnabled)("trips_bookmark")?d.createElement(Z,t):null},$=function e(t){var r=d.useMemo(function(){return t.saveObject||Object(E.toSavesObject)(t.object,!0)},[t.saveObject,t.object]),a=d.useMemo(function(){return{source:t.trackingSource||"trips",saveObject:r,trackingContext:t.trackingContext,withSaveSession:!0,pageAsContext:!0}},[t.trackingContext,t.trackingSource,r]),n=Object(_.useTripInteraction)(a),o=s()(n,2),l=o[0],c=o[1];return r?d.createElement(_.SaveSessionProvider,null,d.createElement(K,i()({},t,{logInteraction:l,puid:c,saveObject:r}))):null},H=function e(t){var r,a,n,i,o=t.saveObject,l=t.object,c=t.queryObject,u=t.preventInteractionPropagation,p=t.trackingContext,v=t.trackingSource,m=t.children,f=t.trip,_=t.allowPopStatModal,E=d.useState((null==l?void 0:null===(r=l.object)||void 0===r?void 0:r.socialStatistics)?!!(null==l?void 0:null===(a=l.object)||void 0===a?void 0:null===(n=a.socialStatistics)||void 0===n?void 0:n.isSaved):!!(null==l?void 0:null===(i=l.socialStatistics)||void 0===i?void 0:i.isSaved)),b=s()(E,2),T=b[0],S=b[1],C=function e(t,r){return t&&r?r===c.type&&t===String(c.id)?"invalidateAndRefetch":"validate":"invalidateAndRefetch"},g=Object(w.useInvalidatableQuery)({query:c.query,variables:c.variables,executeWhen:(null==l?void 0:l.socialStatistics)?"afterInvalidation":"immediately"},{addItemToTrip:function e(t){var r=t.variables,a=r.referenceId,n=r.referenceType;return C(a,n)},tripsRemoveItem:function e(t){var r=t.variables.reference;return C(null==r?void 0:r.id,null==r?void 0:r.type)},tripsRemoveReference:function e(t){var r=t.variables.reference;return C(r.id,null==r?void 0:r.type)}}),O=s()(g,1)[0],I=O.fetching,y=O.data,k=O.error;return d.useEffect(function(){if(!I&&!k){var e=y&&y.savesObjects&&y.savesObjects[0];if(e){var t=e.id,r=e.socialStatistics,a=void 0===r?{}:r,n=(t===c.id||String(t)===c.id)&&!!a.isSaved;n!==T&&S(n)}}},[I,y,k]),d.createElement($,{saveObject:o,object:l,active:T,preventInteractionPropagation:u,trackingContext:p,trackingSource:v,resaveTrip:f,allowPopStatModal:_},function(e){return m(e,T,I)})},J=function e(t){if(!Object(m.featureIsEnabled)("trips_bookmark"))return null;var r=t.saveObject||Object(E.toSavesObject)(t.object,!0);if(!r)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var a=Object(E.objectStatisticQuery)(r);return a?d.createElement(H,i()({},t,{queryObject:a})):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};J.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1};var ee=J;r.d(t,"TripFlowSelector",function(){return $}),r.d(t,"QueriedTripFlowSelector",function(){return ee})}}});
//# sourceMappingURL=trips.trip-flow-selector.affc36ef5b.js.map