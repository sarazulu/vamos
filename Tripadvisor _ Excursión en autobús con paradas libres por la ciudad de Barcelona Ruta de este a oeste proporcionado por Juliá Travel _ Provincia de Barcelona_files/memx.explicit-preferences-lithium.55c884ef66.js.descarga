($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.explicit-preferences-lithium",d:["vendor-babel","vendor-react-libs","@ta/common.features","lithium-platform","@ta/memx.attr-promo-screen","@ta/onboarding.common","@ta/platform.interactions","vendor-urql","@ta/a11y.focus","lithium-common"],e:["./packages/memx/explicit-preferences-lithium/explicit-preferences-lithium.jsx"],m:{"./packages/memx/explicit-preferences-lithium/explicit-preferences-lithium.jsx":function(e,n,i){"use strict";i.r(n);var a=i("@babel/runtime/helpers/esm/slicedToArray"),t=i.n(a),l=i("react"),r=i.n(l),d=i("@ta/common.features"),s=i("@ta/lithium.context"),o=i("@ta/memx.attr-promo-screen"),c=i("@ta/onboarding.common"),u=i("@ta/platform.interactions"),m=i("@babel/runtime/helpers/esm/extends"),k=i.n(m),v=i("urql"),N=i("@ta/common.is-visible"),p=i("@ta/platform.i18n"),b=i.n(p),f=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"HometownShownMutationLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"cardId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"CardTypeEnumInput"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"cardState"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"CardStateEnumInput"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"updateInsightProfile"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"profile"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"uiCardsState"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"states"},"value":{"kind":"ListValue","values":[{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"id"},"value":{"kind":"Variable","name":{"kind":"Name","value":"cardId"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"state"},"value":{"kind":"Variable","name":{"kind":"Name","value":"cardState"}}}]}]}}]}}]}}]}}],"directives":[]}]}}],"loc":{"start":0,"end":231}}');f.__key=86937422431709,f.loc.source={body:"4f11b22e85dd"};var O=f,E=i("@babel/runtime/helpers/esm/defineProperty"),S=i.n(E),I=i("@ta/common.classnames"),_=i.n(I),D=function e(n){var i=n.titleText,a=n.subtitleText,t=n.withBackground,l=void 0!==t&&t;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:_()("zsCNJbxY",S()({},"_1dZje_Hf",l))},i),a&&r.a.createElement("div",{className:_()("_13Yq1ztW",S()({},"_1dZje_Hf",l))},a))},T=function e(n){var i=n.responses,a=n.setters,r=n.homeGeoName,d=n.setHideControls,s=Object(p.useLocalize)().localize,o=Object(v.useMutation)(O),u=t()(o,2)[1],m=Object(N.useOnVisible)(function(){return u({cardId:"ONBOARDING_HOMETOWN",cardState:"SHOWN"})});return l.createElement(l.Fragment,null,l.createElement(D,{titleText:l.createElement(b.a,{id:"cx_explicit_preferences_profile_header3"})}),l.createElement("div",{className:"_2rwiMAFq",ref:m},l.createElement(c.TextInput,{type:"OUTLINED",label:l.createElement(b.a,{id:"my_name_is"}),maxLength:40,value:i.firstName,onChange:a.setFirstName,cornersType:"TOP_ROUNDED",placeholder:s.string("explicit_preferences_account_screen_name"),helperText:s.string("cx_explicit_preferences_profile_name_help")}),l.createElement(c.GeoPicker,{placeholder:s.string("cx_explicit_preferences_profile_hometown"),closeOnSelection:!0,geoName:r,onChange:a.setHomeGeo,onShowHide:d,clearGeo:function e(){a.setHomeGeo(void 0)}},function(e){return l.createElement(c.TextInput,k()({},e,{type:"OUTLINED",label:s("cx_explicit_preferences_profile_hometown"),cornersType:"BOTTOM_ROUNDED",helperText:s.string("cx_explicit_preferences_profile_hometown_help2")}))})))},g=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"InteractionMutationLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"interaction"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"InteractionV4Input"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"logInteractionV4"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"interaction"},"value":{"kind":"Variable","name":{"kind":"Name","value":"interaction"}}}],"directives":[]}]}}],"loc":{"start":0,"end":129}}');g.__key=0xdc637872e883,g.loc.source={body:"dc637872e883"};var y=g,h=function e(n,i,a,r){var d=Object(l.useContext)(s.Route),o=t()(d,2)[1].uid,c=Object(v.useMutation)(y),u=t()(c,2)[1],m=Object(l.useRef)(function e(n,i){return"EDITING"===n?i?"EDITING":"ADDING":"GEOPILL"===n?"GEOPILL":"ONBOARDING"}(r,a)).current,k=function e(n){switch(n){case"HAS_DESTINATION":return"WELCOME_SCREEN";case"DESTINATION":return"DESTINATION";case"DATES":return"DATES";case"SEGMENT":return"COMPANION";case"INTERESTS":return"INTERESTS";case"PROFILE":return"ACCOUNT_SCREEN";case"END_SCREEN":return"END_SCREEN";default:throw new Error("Unknown step: ".concat(n))}}(n),N=function e(n,i){switch(n){case"HAS_DESTINATION":return i.hasDestination?"HAS_DESTINATION":"HAS_NO_DESTINATION";case"DESTINATION":return i.isInDestination?"NEARBY":"GEO_SELECTION";case"DATES":return i.flexibleDates?"FUZZY_DATES":"HARD_DATES";case"SEGMENT":var a=i.segment;return"FAMILY"===a||"FRIENDS"===a||"PARTNER"===a||"SOLO"===a?a:null;case"INTERESTS":return"INTERESTS_SELECTED";case"PROFILE":if(i.firstName&&i.homeGeoId)return"NAME_AND_HOMETOWN_INPUT";if(i.firstName)return"NAME_INPUT";if(i.homeGeoId)return"HOMETOWN_INPUT";break;case"END_SCREEN":return null;default:throw new Error("Unknown step: ".concat(n))}return null}(n,i),p=i.interests;return Object(l.useEffect)(function(){u({interaction:{explicitPreferences:{showQuestion:{context:m,question:k,uid:o}}}})},[m,o,k,u]),{trackRespondQuestion:Object(l.useCallback)(function(){u({interaction:{explicitPreferences:{respondQuestion:{context:m,question:k,response:N,uid:o,interestIds:"INTERESTS_SELECTED"===N?p:null}}}})},[o,k,N,p,m,u]),trackSkipQuestion:Object(l.useCallback)(function(){u({interaction:{explicitPreferences:{navigatesQuestion:{context:m,question:k,action:"SKIP",uid:o}}}})},[o,k,m,u]),trackGoBackQuestion:Object(l.useCallback)(function(){u({interaction:{explicitPreferences:{navigatesQuestion:{context:m,question:k,action:"BACK",uid:o}}}})},[o,k,m,u]),trackCloseModal:Object(l.useCallback)(function(){u({interaction:{explicitPreferences:{navigatesQuestion:{context:m,question:k,action:"CLOSE",uid:o}}}})},[o,k,m,u])}},x=i("@ta/a11y.focus"),j=["a[href]","button:not(:disabled)","input:not(:disabled)","select:not(:disabled)","textarea:not(:disabled)",'[tabindex="0"]:not([data-skip-focus])'].join(),F=function e(n){var i=n.children,a=n.onClose,t=void 0===a?function(){}:a,d=Object(x.useKeyboardNavigationMode)();Object(l.useLayoutEffect)(function(){var e=document.body;if(null!=e){var n=e.style.overflow;return e.style.overflow="hidden",function(){e.style.overflow=n}}},[]);var s=Object(l.useRef)(null),o=Object(l.useCallback)(function(){if(null!=s.current){var e=s.current.querySelectorAll(j);e.length>0&&e[e.length-1].focus()}},[]),c=Object(l.useCallback)(function(){if(null!=s.current){var e=s.current.querySelector(j);null!=e&&e.focus()}},[]);return Object(l.useEffect)(function(){var e=function e(n){27===n.keyCode&&null!=t&&t()};return document.addEventListener("keyup",e),function(){return document.removeEventListener("keyup",e)}},[t]),Object(l.useEffect)(c,[]),r.a.createElement("div",{className:"wLDnacAL"},r.a.createElement("div",{className:"_278i5vs1",onClick:t}),r.a.createElement("div",{className:"sGal_Dx5"},r.a.createElement("div",{className:_()("_9DIRjhAx",S()({},"_16IzsRdJ",d)),ref:s},r.a.createElement("div",{tabIndex:0,onFocus:o,"data-skip-focus":!0}),i,r.a.createElement("div",{tabIndex:0,onFocus:c,"data-skip-focus":!0}))))},P=function e(n){var i,a=n.displayName;return i=a?r.a.createElement(b.a,{id:"cx_explicit_preferences_profile_end_screen2",args:{displayName:a}}):r.a.createElement(b.a,{id:"cx_explicit_preferences_profile_end_screen_no_name"}),r.a.createElement("div",{className:"_3xtzGcHe"},r.a.createElement("div",{className:"GJO5eBVn"},r.a.createElement(D,{titleText:i}),r.a.createElement(c.LoadingSpinner,null)))},A=function e(n){return new Promise(function(e){return setTimeout(e,n)})},G=function e(n){var i=n.mode,a=n.state,m=a.steps,k=a.currentStepIndex,v=a.nextStep,N=a.canGoBack,p=a.canGoForward,b=a.canSkip,f=a.goBack,O=a.goForward,E=a.reset,S=a.save,I=a.triggerEmail,_=a.hasExistingResponses,D=a.homeGeoName,g=a.modified,y=a.responses,x=a.setters,j=n.onClose,G=n.onRefresh,C=r.a.useContext(s.Route),R=t()(C,1)[0],L=R.params.geoId||void 0,V=R.params.detailId||void 0,w=Object(l.useState)(!1),M=t()(w,2),B=M[0],H=M[1],Q="GEOPILL"===i,q=Object(l.useState)(Q),z=t()(q,2),Y=z[0],U=z[1],J=Object(l.useState)(!1),W=t()(J,2),Z=W[0],K=W[1],$=m[k],X=y.firstName.trim()||null,ee=null==V&&!0===y.hasDestination&&!y.isInDestination&&null!=y.destinationGeoId&&y.destinationGeoId!==L,ne=null==V&&!0===y.hasDestination&&!0===y.isInDestination,ie=!_||ee||ne,ae=Object(d.featureIsEnabled)("post_signup_attr_promo_explicit_preferences_control")||Object(d.featureIsEnabled)("post_signup_attr_promo_explicit_preferences")||Object(d.featureIsEnabled)("post_signup_attr_promo_masthead_join")||"PROFILE_ONLY"===i,te=Object(d.featureIsEnabled)("post_signup_attr_promo_explicit_preferences")||Object(d.featureIsEnabled)("post_signup_attr_promo_masthead_join"),le=Object(o.useAttrPromoScreen)(),re=Object(u.useGARecorder)(),de=r.a.useCallback(function(){re({module:"signup_promo_prompt",action:"eligible_promo_test_explicit_preferences"})},[re]),se=r.a.useCallback(function(){"ONETAP"!==i&&"PROFILE_ONLY"!==i||(ae&&de(),te&&le())},[te,le,ae,de,i]),oe=Object(d.featureIsEnabled)("ep_has_command_screen")&&("ONBOARDING"===i||"ONETAP"===i),ce=("ONBOARDING"===i||"ONETAP"===i)&&(oe||Object(d.featureIsEnabled)("ep_has_command_screen_control")),ue=Object(l.useCallback)(function(){ce&&re({module:"EP_ONB_COPY",action:"ONB_COMPLETE"})},[re,ce]),me=h($,y,_,i),ke=me.trackRespondQuestion,ve=me.trackSkipQuestion,Ne=me.trackGoBackQuestion,pe=me.trackCloseModal,be=Object(l.useCallback)(function(){K(!1),I(),E(),j(),window.location.hash="#preferences",se()},[E,I,j,se]),fe=Object(l.useCallback)(function(){if(!Z)if(g)if("ONBOARDING"!==i&&"ONETAP"!==i||"PROFILE"!==$){K(!0);var e=[S().then(function(e){return ee||ne||!G?e:G()})];ie?e.push(A(7e3)):!ie||ee||ne||e.push(A(2e3));var n=be;Promise.all(e).then(n,be)}else be();else be()},[g,be,G,S,Z,ee,ne,ie,$,i]),Oe=Object(l.useCallback)(function(){pe(),fe()},[fe,pe]),Ee=Object(l.useCallback)(function(){"END_SCREEN"!==v||ie?O():fe()},[ie,v,fe,O]),Se=Object(l.useCallback)(function(){ke(),Ee()},[Ee,ke]),Ie=Object(l.useCallback)(function(){ve(),Ee()},[Ee,ve]),_e=Object(l.useCallback)(function(){Ne(),f()},[Ne,f]),De=Object(l.useRef)($);Object(l.useEffect)(function(){Z||"END_SCREEN"!==$||$===De.current||fe(),De.current=$},[Z,$,fe]);var Te=Object(l.useCallback)(function(e){H(e>=12)},[]);return r.a.createElement(F,{onClose:Oe},!Y&&r.a.createElement(c.NavBar,{isFirstStep:0===k,canGoBack:N,canSkip:b,isScrolled:B,onClose:Oe,onBack:_e,onSkip:Ie}),r.a.createElement(c.StepsContainer,{steps:m,currentStepIndex:k,onScroll:Te},function(e){var n=e.step;switch(n){case"PROFILE":return r.a.createElement(T,{setHideControls:U,homeGeoName:D,responses:y,setters:x});case"END_SCREEN":return r.a.createElement(P,{displayName:X});case"HAS_DESTINATION":case"DESTINATION":case"DATES":case"SEGMENT":case"INTERESTS":default:throw new Error("Invalid step: ".concat(n))}}),r.a.createElement(c.NextButton,{iconName:"END_SCREEN"===v?"checkmark":"arrow-right",disabled:!p||Y,onClick:Object(l.useCallback)(function(){"END_SCREEN"===v&&ue(),Se()},[v,ue,Se])}),Z&&"END_SCREEN"!==$&&r.a.createElement("div",{className:"_3BSuIr7x"},r.a.createElement(c.LoadingSpinner,null)))},C=i("@ta/lithium.portals"),R=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"InitialExplicitPreferencesQueryLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"userId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoIds"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"locations"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"locationIds"},"value":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoIds"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"name"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"memberProfile"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"userId"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"id"},"value":{"kind":"Variable","name":{"kind":"Name","value":"userId"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"id"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"displayName"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"hometown"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"location"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"locationId"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"name"},"arguments":[],"directives":[]}]}}]}}]}},{"kind":"Field","alias":{"kind":"Name","value":"explicitPreferences"},"name":{"kind":"Name","value":"ExplicitPreferences_personalizationQuestions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"geoId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"where"},"name":{"kind":"Name","value":"whereFromQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"defaultLocation"},"arguments":[],"directives":[]}]}},{"kind":"Field","alias":{"kind":"Name","value":"segment"},"name":{"kind":"Name","value":"companionsQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"selected"},"arguments":[],"directives":[]}]}},{"kind":"Field","alias":{"kind":"Name","value":"dates"},"name":{"kind":"Name","value":"datesQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"defaultDates"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"startDate"},"name":{"kind":"Name","value":"checkIn"},"arguments":[],"directives":[]},{"kind":"Field","alias":{"kind":"Name","value":"endDate"},"name":{"kind":"Name","value":"checkOut"},"arguments":[],"directives":[]},{"kind":"Field","alias":{"kind":"Name","value":"flexibleDates"},"name":{"kind":"Name","value":"fuzzyDates"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","alias":{"kind":"Name","value":"interests"},"name":{"kind":"Name","value":"interestsQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"interests"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"type"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"value"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"selected"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"display"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"InlineFragment","typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ExplicitPreferences_InterestText"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"displayText"},"arguments":[],"directives":[]}]}},{"kind":"InlineFragment","typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ExplicitPreferences_InterestTextLocalizationObject"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"displayText"},"arguments":[],"directives":[]}]}}]}}]}}]}}]}}]}}],"loc":{"start":0,"end":1086}}');R.__key=52852438624267,R.loc.source={body:"3011aad4680b"};var L=R,V=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"ExplicitPreferencesQueryLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"explicitPreferences"},"name":{"kind":"Name","value":"ExplicitPreferences_personalizationQuestions"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"geoId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"where"},"name":{"kind":"Name","value":"whereFromQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"defaultLocation"},"arguments":[],"directives":[]}]}},{"kind":"Field","alias":{"kind":"Name","value":"segment"},"name":{"kind":"Name","value":"companionsQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"selected"},"arguments":[],"directives":[]}]}},{"kind":"Field","alias":{"kind":"Name","value":"dates"},"name":{"kind":"Name","value":"datesQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"defaultDates"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"startDate"},"name":{"kind":"Name","value":"checkIn"},"arguments":[],"directives":[]},{"kind":"Field","alias":{"kind":"Name","value":"endDate"},"name":{"kind":"Name","value":"checkOut"},"arguments":[],"directives":[]},{"kind":"Field","alias":{"kind":"Name","value":"flexibleDates"},"name":{"kind":"Name","value":"fuzzyDates"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","alias":{"kind":"Name","value":"interests"},"name":{"kind":"Name","value":"interestsQuestion"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"value"},"name":{"kind":"Name","value":"interests"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"type"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"value"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"selected"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"display"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"InlineFragment","typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ExplicitPreferences_InterestText"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"displayText"},"arguments":[],"directives":[]}]}},{"kind":"InlineFragment","typeCondition":{"kind":"NamedType","name":{"kind":"Name","value":"ExplicitPreferences_InterestTextLocalizationObject"}},"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"displayText"},"arguments":[],"directives":[]}]}}]}}]}}]}}]}}]}}],"loc":{"start":0,"end":819}}');V.__key=0x68818cda1bf2,V.loc.source={body:"68818cda1bf2"};var w=V,M=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"ExplicitPreferencesMutationLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"userId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"flexibleDates"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Boolean"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"startDate"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"endDate"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"segment"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"source"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"interests"}},"type":{"kind":"ListType","type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"ExplicitPreferencesInterestsInterestsInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"updateInsightProfile"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"id"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"userId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"userId"}}}]}},{"kind":"ObjectField","name":{"kind":"Name","value":"profile"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"explicitPreferencesTripSetup"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"checkIn"},"value":{"kind":"Variable","name":{"kind":"Name","value":"startDate"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"checkOut"},"value":{"kind":"Variable","name":{"kind":"Name","value":"endDate"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"companions"},"value":{"kind":"Variable","name":{"kind":"Name","value":"segment"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"fuzzyDates"},"value":{"kind":"Variable","name":{"kind":"Name","value":"flexibleDates"}}}]}},{"kind":"ObjectField","name":{"kind":"Name","value":"explicitPreferencesInterests"},"value":{"kind":"ListValue","values":[{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"geoId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"destinationGeoId"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"source"},"value":{"kind":"Variable","name":{"kind":"Name","value":"source"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"interests"},"value":{"kind":"Variable","name":{"kind":"Name","value":"interests"}}}]}]}}]}}]}}],"directives":[]}]}}],"loc":{"start":0,"end":675}}');M.__key=29297496192846,M.loc.source={body:"1aa55ada774e"};var B=M,H=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"PopulateGeoInformationLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"homeGeoIds"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"locations"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"locationIds"},"value":{"kind":"Variable","name":{"kind":"Name","value":"homeGeoIds"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"localizedName"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":132}}');H.__key=0xdbd4b6075fd3,H.loc.source={body:"dbd4b6075fd3"};var Q=H,q=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"ProfileMutationLithium"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"userId"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"firstName"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"homeGeoId"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"Int"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"updateMemberProfile"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"userId"},"value":{"kind":"Variable","name":{"kind":"Name","value":"userId"}}},{"kind":"Argument","name":{"kind":"Name","value":"displayName"},"value":{"kind":"Variable","name":{"kind":"Name","value":"firstName"}}},{"kind":"Argument","name":{"kind":"Name","value":"hometown"},"value":{"kind":"Variable","name":{"kind":"Name","value":"homeGeoId"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":202}}');q.__key=0xd5998315e55c,q.loc.source={body:"d5998315e55c"};var z=q;function Y(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,a)}return i}var U=function e(n){var i=(n||"").match(/([0-9]{4})-([0-9]{2})-([0-9]{2})/);return null==i?null:new Date(+i[1],+i[2]-1,+i[3])},J=function e(n){return null==n?null:n.toISOString().substr(0,10)},W=function e(n){return"".concat((null==n?void 0:n.type)||"","|").concat((null==n?void 0:n.value)||"")},Z=function e(n){var i=n.split("|"),a=t()(i,2);return{type:a[0],value:a[1]}},K=function e(n){var i,a,t,l,r,d,s,o,c,u,m,k,v,N,p,b,f,O={},E=U(null==n?void 0:null===(i=n.explicitPreferences)||void 0===i?void 0:null===(a=i.dates)||void 0===a?void 0:null===(t=a.value)||void 0===t?void 0:t.startDate),S=U(null==n?void 0:null===(l=n.explicitPreferences)||void 0===l?void 0:null===(r=l.dates)||void 0===r?void 0:null===(d=r.value)||void 0===d?void 0:d.endDate),I=null==n?void 0:null===(s=n.explicitPreferences)||void 0===s?void 0:null===(o=s.dates)||void 0===o?void 0:null===(c=o.value)||void 0===c?void 0:c.flexibleDates,_=null==n?void 0:null===(u=n.explicitPreferences)||void 0===u?void 0:null===(m=u.segment)||void 0===m?void 0:m.value,D=null==n?void 0:null===(k=n.explicitPreferences)||void 0===k?void 0:null===(v=k.interests)||void 0===v?void 0:v.value,T=null==n?void 0:null===(N=n.memberProfile)||void 0===N?void 0:N.displayName,g=null==n?void 0:null===(p=n.memberProfile)||void 0===p?void 0:null===(b=p.hometown)||void 0===b?void 0:null===(f=b.location)||void 0===f?void 0:f.locationId;null!=E&&(I?O.startMonth=E:O.startDate=E),null!=S&&(I?O.endMonth=S:O.endDate=S),null!=E&&null!=S&&null!=I&&(O.flexibleDates=I),null!=_&&(O.segment=_),null!=T&&(O.firstName=T),null!=g&&(O.homeGeoId=g);var y=(D||[]).filter(function(e){return null==e?void 0:e.selected}).map(W);return y.length>0&&(O.interests=y),O},$=function e(n,i,a){var o=r.a.useContext(s.Route),m=t()(o,1)[0],k=r.a.useContext(s.Route),N=t()(k,1)[0].page,p=m.params.geoId||void 0,b=Object(l.useMemo)(function(){switch(n){case"ONBOARDING":return Object(d.featureIsEnabled)("cx_explicit_preferences_onboarding");case"ONETAP":return Object(d.featureIsEnabled)("cx_explicit_preferences_onetap");case"EDITING":return(Object(d.featureIsEnabled)("cx_explicit_preferences_scoped_home_cta")||Object(d.featureIsEnabled)("cx_explicit_preferences_scoped_home_cta_always_edit"))&&"Home"===N&&null!=p;case"GEOPILL":return Object(d.featureIsEnabled)("cx_explicit_preferences_geopill");case"PROFILE_ONLY":return Object(d.featureIsEnabled)("account_screen_onb")||"MASTHEAD"===a;default:throw new Error("useExplicitPreferencesModal: invalid mode: ".concat(n))}},[n,N,p,a]),f=function e(n){var i,a,r,o,m,k,N,p,b=n.mode,f=n.scopedGeoId,O=n.pause,E=Object(l.useContext)(s.Visitor).userId,I=Object(v.useQuery)({query:L,variables:{userId:E,destinationGeoIds:null!=f?[f]:[],destinationGeoId:f},pause:O}),_=t()(I,1)[0].data,D=null==_?void 0:null===(i=_.memberProfile)||void 0===i?void 0:null===(a=i.hometown)||void 0===a?void 0:null===(r=a.location)||void 0===r?void 0:r.name,T=null==_?void 0:null===(o=_.explicitPreferences)||void 0===o?void 0:null===(m=o.where)||void 0===m?void 0:m.value,g="PROFILE_ONLY"===b||"ONBOARDING"===b||"ONETAP"===b,y=Object(v.useQuery)({query:Q,variables:{homeGeoIds:[T||-1]},pause:O||!g}),h=t()(y,1)[0].data,x=Object(u.useGARecorder)(),j=Object(l.useCallback)(function(e){g&&x({module:"autopop_home_location",action:e?"submitting_home_location":"no_home_location"})},[x,g]),F=Object(l.useContext)(s.Route),P=t()(F,1)[0].page,A=Object(l.useMemo)(function(){return"ONBOARDING"===b||"GEOPILL"===b||"ONETAP"===b||Object(d.featureIsEnabled)("t11209_mip_variant_b")||Object(d.featureIsEnabled)("t11208_variant_a_curated_broad_interest_categories")?["DATES","SEGMENT","INTERESTS"]:"PROFILE_ONLY"===b?[]:Object(d.featureIsEnabled)("t11210_mip_variant_c")?["SEGMENT","DATES","INTERESTS"]:["INTERESTS","SEGMENT","DATES"]},[b]),G=Object(l.useCallback)(function(e,n){var i=n.hasDestination,a=n.destinationGeoId;switch(e){case"PROFILE":return"PROFILE_ONLY"===b||Object(d.featureIsEnabled)("t11213_mip_2_account_screen")&&"ONETAP"===b||Object(d.featureIsEnabled)("t11216_mip_2_traditional_sign_up_ll")&&"ONBOARDING"===b&&"Home"!==P?"END_SCREEN":"HAS_DESTINATION";case"HAS_DESTINATION":return null!=i?i?"DESTINATION":"END_SCREEN":null;case"DESTINATION":return null!=a?"DATES":"END_SCREEN";case"DATES":case"SEGMENT":case"INTERESTS":var t=A.indexOf(e);return A[t+1]||"END_SCREEN";case"END_SCREEN":return null;default:throw new Error("Invalid step: ".concat(e))}},[A,P,b]),C="MOBILE"===Object(l.useContext)(s.Device).viewportCategory;p="ONBOARDING"===b||"ONETAP"===b&&!C||"PROFILE_ONLY"===b?"PROFILE":"ONETAP"===b&&C?"HAS_DESTINATION":"GEOPILL"===b?"DESTINATION":t()(A,1)[0];var R=Object(l.useMemo)(function(){var e={hasDestination:"ONBOARDING"!==b&&"ONETAP"!==b&&null!=f||"GEOPILL"===b||null,isInDestination:!1,destinationGeoId:f,flexibleDates:!1,startDate:null,endDate:null,startMonth:null,endMonth:null,segment:null,interests:[],firstName:"",homeGeoId:null};return Object.assign(e,K(_)),e},[b,f,_]),V=Object(c.useQuestionFlow)({initialStep:p,initialResponses:R,getNextStep:G}),M=V.steps,H=V.currentStepIndex,q=V.nextStep,U=V.responses,W=V.setResponses,$=V.goForward,X=Object(v.useQuery)({query:w,variables:{destinationGeoId:U.destinationGeoId},pause:O}),ee=t()(X,1)[0].data,ne=Object(l.useMemo)(function(){return K(ee)},[ee]);Object(l.useEffect)(function(){W(ne,!1)},[W,ne]);var ie=Object(l.useState)(!1),ae=t()(ie,2),te=ae[0],le=ae[1],re=te||Object.keys(ne).length>0,de=M[H],se=Object(l.useMemo)(function(){switch(de){case"PROFILE":return""!==U.firstName||null!=U.homeGeoId;case"HAS_DESTINATION":return!1;case"DESTINATION":return null!=U.destinationGeoId;case"DATES":return U.flexibleDates?null!=U.startMonth&&null!=U.endMonth:null!=U.startDate&&null!=U.endDate;case"SEGMENT":return null!=U.segment;case"INTERESTS":return U.interests.length>0;case"END_SCREEN":return!0;default:throw new Error("Invalid step: ".concat(de))}},[de,U]),oe=Object(l.useMemo)(function(){return A.includes(de)?{stepNumber:A.indexOf(de)+1,stepCount:A.length}:null},[de,A]),ce=Object(v.useMutation)(z),ue=t()(ce,2)[1],me=Object(v.useMutation)(B),ke=t()(me,2)[1],ve=Object(l.useCallback)(function(){var e=[];if("ONBOARDING"!==b&&"ONETAP"!==b&&"PROFILE_ONLY"!==b||null==E||(j(U.homeGeoId),e.push(ue({userId:E,homeGeoId:U.homeGeoId,firstName:U.firstName?U.firstName:void 0}))),U.hasDestination){var n=U.flexibleDates?U.startMonth:U.startDate,i=U.flexibleDates?U.endMonth:U.endDate;e.push(ke({userId:E,destinationGeoId:U.destinationGeoId,flexibleDates:U.flexibleDates,startDate:J(n),endDate:J(i),segment:U.segment,source:"ONBOARDING",interests:U.interests.map(Z)}))}return le(!0),Promise.all(e)},[E,b,U,ue,ke,j]),Ne=function e(n,i,a){var r=Object(l.useState)(i),d=t()(r,2),s=d[0],o=d[1],c=Object(l.useCallback)(function(e,n){a(e),o(n)},[a]);return Object(l.useEffect)(function(){o(i)},[i]),[s,c]}(g&&T||U.homeGeoId,g&&T?null==h?void 0:null===(k=h.locations)||void 0===k?void 0:null===(N=k[0])||void 0===N?void 0:N.localizedName:D,Object(l.useCallback)(function(e){return W({homeGeoId:e})},[W])),pe=t()(Ne,2),be=pe[0],fe=pe[1];Object(l.useEffect)(function(){g&&T&&fe(T)},[g,T,fe]);var Oe=Object(l.useCallback)(function(){"ONBOARDING"!==b&&"ONETAP"!==b||null==E||fetch("/data/1.0/memberEngagement/onboarding/explicit-preferences",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:E,homeGeoId:U.homeGeoId,firstName:U.firstName,destinationGeoId:U.destinationGeoId,segment:U.segment})})},[b,E,U]);return function Ee(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Y(i,!0).forEach(function(n){S()(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y(i).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}({},V,{progress:oe,canGoBack:"END_SCREEN"!==de,canGoForward:null!=q&&se&&"HAS_DESTINATION"!==de,canSkip:!(null==q||("ONBOARDING"!==b&&"ONETAP"!==b||"PROFILE"!==de)&&se||"HAS_DESTINATION"===de||"PROFILE_ONLY"===b),goForward:$,save:ve,triggerEmail:Oe,homeGeoName:be,hasExistingResponses:re,setters:{setFirstName:Object(l.useCallback)(function(e){return W({firstName:e})},[W]),setHomeGeo:fe}})}({mode:n,scopedGeoId:+p||null,pause:!b}),O=Object(C.useVDOMPortal)(function(e){var a=e.close;return r.a.createElement(G,{mode:n,state:f,onClose:a,onRefresh:i})}).open;return{open:Object(l.useCallback)(function(){b&&O()},[b,O]),isEnabled:b,state:f}};i.d(n,"ExplicitPreferencesLithiumUI",function(){return G}),i.d(n,"useExplicitPreferencesLithiumModal",function(){return $}),i.d(n,"useExplicitPreferencesLithiumInteraction",function(){return h})}}});
//# sourceMappingURL=memx.explicit-preferences-lithium.55c884ef66.js.map