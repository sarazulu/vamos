($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/attractions.util-availability",d:["vendor-babel","lithium-platform","vendor-react-libs","vendor-urql","@ta/attractions.util-datepicker"],e:["./packages/attractions/util-availability/util-availability.jsx"],m:{"./packages/attractions/util-availability/util-availability.jsx":function(e,i,a){"use strict";a.r(i);var n=a("@babel/runtime/helpers/esm/slicedToArray"),t=a.n(n),r=a("@ta/lithium.context"),d=a("react"),l=a("urql"),u=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"PriceCalendarQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"currency"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"priceCalendar"},"name":{"kind":"Name","value":"ExpPresentationService_getPriceCalendar"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ListValue","values":[{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"currency"},"value":{"kind":"Variable","name":{"kind":"Name","value":"currency"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"productCode"},"value":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}}}]}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"datesAndPrices"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"date"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"price"},"arguments":[],"directives":[]}]}}]}}]}}],"loc":{"start":0,"end":264}}');u.__key=0x8be84523713f,u.loc.source={body:"8be84523713f"};var s=u,c=function e(i){var a=d.useContext(r.Preference).currency,n=Object(l.useQuery)({query:s,variables:{productCode:i,currency:a},requestPolicy:"cache-and-network"}),u=t()(n,1)[0],c=u.data,o=u.fetching,m=u.error;return{priceCalendar:c&&c.priceCalendar&&c.priceCalendar.length>0&&c.priceCalendar[0]||null,fetching:o,error:m}},o=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"DetailedPricingAndAvailabilityQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"currency"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"pax"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"ExpPresentationService_AgeBandSelectionInput"}}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"travelDate"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"languageServiceFilter"}},"type":{"kind":"ListType","type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"detailedPricingAndAvailability"},"name":{"kind":"Name","value":"ExpPresentationService_getDetailedPricingAndAvailability"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"currency"},"value":{"kind":"Variable","name":{"kind":"Name","value":"currency"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"pax"},"value":{"kind":"Variable","name":{"kind":"Name","value":"pax"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"productCode"},"value":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"travelDate"},"value":{"kind":"Variable","name":{"kind":"Name","value":"travelDate"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"languageServiceFilter"},"value":{"kind":"Variable","name":{"kind":"Name","value":"languageServiceFilter"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"response"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"currency"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"specialOfferDetails"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"comparisonPrice"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"description"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"tourGrades"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"available"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"comparisonPrice"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"descriptionText"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"text"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"locale"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"originalLocale"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"translationInfo"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"isCurrent"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"source"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"vendor"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","name":{"kind":"Name","value":"languageServices"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"hasAudioGuide"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"hasHumanGuide"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"hasWrittenGuide"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"locale"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"titleText"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"text"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"locale"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"originalLocale"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"translationInfo"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"isCurrent"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"source"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"vendor"},"arguments":[],"directives":[]}]}}]}},{"kind":"Field","name":{"kind":"Name","value":"lineItems"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"ageBand"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"comparisonPrice"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"numTravelers"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"price"},"arguments":[],"directives":[]}]}},{"kind":"Field","name":{"kind":"Name","value":"maxTravelersPerUnit"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"startTime"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"totalPrice"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"tourGradeCode"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"rnplEligibility"},"arguments":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"eligible"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"ineligibilityReasons"},"arguments":[],"directives":[]}]}}]}}]}},{"kind":"Field","name":{"kind":"Name","value":"message"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":1498}}');o.__key=85286891787435,o.loc.source={body:"4d9166e394ab"};var m=o,v=function e(i){var a=i.query,n=i.variables,r=i.completeResponsePredicate,u=i.defaultTimeoutResponse,s=void 0===u?{fetching:!1}:u,c=i.pollInterval,o=void 0===c?1e3:c,m=i.maxTries,v=void 0===m?10:m,k=Object(d.useRef)(null),N=Object(d.useState)(!1),g=t()(N,2),p=g[0],b=g[1],y=Object(l.useQuery)({query:a,variables:n,pollInterval:p?void 0:o,pause:p,requestPolicy:"network-only"}),S=t()(y,1)[0];return Object(d.useEffect)(function(){return k.current&&clearTimeout(k.current),b(!1),k.current=setTimeout(function(){return b(!0)},o*v),function(){k.current&&clearTimeout(k.current)}},[Object(l.createRequest)(a,n).key,v,o]),Object(d.useEffect)(function(){!1===S.fetching&&(r(S)||S.error)&&k.current&&(b(!0),clearTimeout(k.current))},[r,S]),S.data||S.error||!p?S:s},k={data:{status:"ERROR",response:null,message:null},fetching:!1},N=function e(i){return i&&i.detailedPricingAndAvailability&&i.detailedPricingAndAvailability.length>0&&i.detailedPricingAndAvailability[0]||null},g=function e(i){var a=N(i.data);return!!a&&"IN_PROGRESS"!==a.status},p=function e(i,a,n,t){var l=d.useContext(r.Preference).currency,u=v({query:m,variables:{productCode:i,pax:a,travelDate:n,currency:l,languageServiceFilter:t},completeResponsePredicate:g,defaultTimeoutResponse:k,pollInterval:1e3,maxTries:30});return{detailedPricingAndAvailability:N(u.data),error:u.error}},b=a("@ta/platform.i18n"),y=function e(i){var a={};return i.forEach(function(e,i){a[i]=e}),a},S=function e(i,a,n,r,l,u){var s=d.useState(null),c=t()(s,2),o=c[0],m=c[1],v=d.useState(null),k=t()(v,2),N=k[0],g=k[1],p=d.useRef(null),S=Object(b.useLocalize)().localize;return d.useEffect(function(){m(null),g(null)},[i,a,n,r,l,u]),d.useEffect(function(){var e={geoId:i,attractionId:a,productCode:n,tourGradeCode:r,tourDate:l,passengerMix:y(u)},t=new AbortController;return o||N||function i(a){fetch("/ShoppingCartApi/cart/add?isCartless=true",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"same-origin",signal:t.signal}).then(function(e){if(e.ok)return e;throw Error(e.statusText)}).then(function(e){return e.json()}).then(function(e){if("COMPLETE"!==e.polling_state)"IN_PROGRESS"===e.polling_state&&a<30?p.current=setTimeout(function(){return i(a+1)},1e3):g(S.string("attractions.booking.errors.api_error"));else if(e.result)switch(e.result.status){case"SUCCESS":m("SUCCESS");break;case"DUPLICATE_ITEM":g(S.string("attractions.cart.item_already_added_with_link",{0:"/ShoppingCart"}));break;case"ITEM_NOT_AVAILABLE":g(S.string("attractions.cart.alert_not_available"));break;default:g(S.string("attractions.booking.errors.api_error"))}}).catch(function(e){"AbortError"!==e.name&&g(S.string("attractions.booking.errors.api_error"))})}(1),function(){clearTimeout(p.current),p.current=null,t.abort()}},[o,N]),{status:o,error:N}},f=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"TourGradeSortQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"sortingStrategy"}},"type":{"kind":"NamedType","name":{"kind":"Name","value":"ExpPresentationService_SortingStrategyEnum"}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"tourGradeSort"},"name":{"kind":"Name","value":"ExpPresentationService_getTourGradeSort"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"productCode"},"value":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"sortingStrategy"},"value":{"kind":"Variable","name":{"kind":"Name","value":"sortingStrategy"}}}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"sortedTourGrades"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":294}}');f.__key=0xf9808f299567,f.loc.source={body:"f9808f299567"};var F=f,T=function e(i){var a=Object(l.useQuery)({query:F,variables:{productCode:i,sortingStrategy:"POPULARITY"}}),n=t()(a,1)[0],r=n.data,d=n.fetching;return{sortedTourGrades:r&&r.tourGradeSort&&r.tourGradeSort.length>0&&r.tourGradeSort[0]&&r.tourGradeSort[0].sortedTourGrades&&Array.from(r.tourGradeSort[0].sortedTourGrades)||(d?null:[])}},D=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"NearestAvailableDatesQuery"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"travelDate"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"String"}}},"directives":[]},{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"pax"}},"type":{"kind":"NonNullType","type":{"kind":"ListType","type":{"kind":"NamedType","name":{"kind":"Name","value":"ExpPresentationService_AgeBandSelectionInput"}}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"nearestAvailableDates"},"name":{"kind":"Name","value":"ExpPresentationService_getNearestAvailableDates"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"ListValue","values":[{"kind":"ObjectValue","fields":[{"kind":"ObjectField","name":{"kind":"Name","value":"productCode"},"value":{"kind":"Variable","name":{"kind":"Name","value":"productCode"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"travelDate"},"value":{"kind":"Variable","name":{"kind":"Name","value":"travelDate"}}},{"kind":"ObjectField","name":{"kind":"Name","value":"pax"},"value":{"kind":"Variable","name":{"kind":"Name","value":"pax"}}}]}]}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"availableDates"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"message"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":358}}');D.__key=23883279518681,D.loc.source={body:"15b8c2644bd9"};var C=D,O={data:{availableDates:null,status:"ERROR",message:null},fetching:!1},A=function e(i){return i&&i.nearestAvailableDates&&i.nearestAvailableDates.length>0&&i.nearestAvailableDates[0]||null},P=function e(i){var a=A(i.data);return!!a&&"IN_PROGRESS"!==a.status},V=function e(i,a,n){var t=v({query:C,variables:{productCode:i,travelDate:a,pax:n},completeResponsePredicate:P,defaultTimeoutResponse:O,pollInterval:1e3,maxTries:30});return{availableDates:A(t.data),error:t.error}},h=a("@babel/runtime/helpers/esm/toConsumableArray"),x=a.n(h),j=a("@ta/attractions.util-datepicker"),_=function e(i){return[].concat(x()(i.get(1)?[{ageBand:"ADULT",count:i.get(1)}]:[]),x()(i.get(2)?[{ageBand:"CHILD",count:i.get(2)}]:[]),x()(i.get(3)?[{ageBand:"INFANT",count:i.get(3)}]:[]),x()(i.get(4)?[{ageBand:"YOUTH",count:i.get(4)}]:[]),x()(i.get(5)?[{ageBand:"SENIOR",count:i.get(5)}]:[]))},E=function e(i,a){return!i||Object(j.isDateBlockedFromPriceCalendarMap)(i,a)?Object(j.getFirstAvailableDateInPriceCalendarMap)(a):i},I=function e(i,a){return null==i?Object(j.getFirstAvailableDateInPriceCalendarMap)(a):E(i,a)};a.d(i,"usePriceCalendar",function(){return c}),a.d(i,"useDetailedPricingAndAvailability",function(){return p}),a.d(i,"useAddToCartlessCart",function(){return S}),a.d(i,"useTourGradeSortByPopularity",function(){return T}),a.d(i,"useNearestAvailableDates",function(){return V}),a.d(i,"getPaxFromAgeBands",function(){return _}),a.d(i,"getValidDate",function(){return E}),a.d(i,"calculateDefaultDate",function(){return I})}}});
//# sourceMappingURL=attractions.util-availability.697475840d.js.map